Requested labels: ubuntu-latest
Job defined at: n8n-io/n8n/.github/workflows/ci-postgres-mysql.yml@refs/pull/14468/merge
Waiting for a runner to pick up this job...
Job is waiting for a hosted runner to come online.
Job is about to start running on the hosted runner: GitHub Actions 55 (hosted)
Current runner version: '2.323.0'
##[group]Operating System
Ubuntu
24.04.2
LTS
##[endgroup]
##[group]Runner Image
Image: ubuntu-24.04
Version: 20250406.1.0
Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250406.1/images/ubuntu/Ubuntu2404-Readme.md
Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250406.1
##[endgroup]
##[group]Runner Image Provisioner
2.0.422.1
##[endgroup]
##[group]GITHUB_TOKEN Permissions
Actions: write
Attestations: <:*:>
Checks: <:*:>
Contents: <:*:>
Deployments: <:*:>
Discussions: <:*:>
Issues: <:*:>
Metadata: read
Models: read
Packages: <:*:>
Pages: <:*:>
PullRequests: <:*:>
RepositoryProjects: <:*:>
SecurityEvents: <:*:>
Statuses: <:*:>
##[endgroup]
Secret source: <:*:>
Prepare workflow directory
Prepare all required actions
Getting action download info
Download action repository <:*:> (SHA:<:SEQ:>)
Download action repository <:*:> (SHA:<:SEQ:>)
Download action repository <:*:> (SHA:<:SEQ:>)
Download action repository <:*:> (SHA:<:SEQ:>)
Download action repository <:*:> (SHA:<:SEQ:>)
Complete job name: <:*:>
##[group]Run <:*:>
with:
repository: <:*:>
token: ***
ssh-strict: true
persist-credentials: <:*:>
clean: true
sparse-checkout-cone-mode: true
fetch-depth: <:NUM:>
fetch-tags: false
show-progress: true
lfs: false
submodules: <:*:>
set-safe-directory: true
env:
DB_MYSQLDB_PASSWORD: password
##[endgroup]
Syncing repository: <:*:>
##[group]Getting Git version info
Working directory is <:*:>
[command]/usr/bin/git version
git version <:NUM:>.<:NUM:>.<:NUM:>
##[endgroup]
Temporarily overriding HOME='/home/runner/work/_temp/b8701e12-607b-42ce-ab85-842b2d3499bc' before making global git config changes
Adding repository directory to the temporary git global config as a safe directory
[command]/usr/bin/git config --global --add safe.directory /home/runner/work/n8n/n8n
Deleting the contents of <:*:>
##[group]Initializing the repository
[command]/usr/bin/git init <:*:>
hint: Using 'master' as the name for the initial branch. This default branch name
hint: is subject to change. To configure the initial branch name to use in all
hint: of your new repositories, which will suppress this warning, call:
hint:
hint: git config --global init.defaultBranch <name>
hint:
hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
hint: 'development'. The just-created branch can be renamed via this command:
hint:
hint: git branch -m <name>
Initialized empty Git repository in <:*:>
[command]/usr/bin/git remote add origin <:*:>
##[endgroup]
##[group]Disabling automatic garbage collection
[command]/usr/bin/git config --local gc.auto 0
##[endgroup]
##[group]Setting up auth
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
[command]/usr/bin/git config <:*:> http.https://github.com/.extraheader AUTHORIZATION: basic ***
##[endgroup]
##[group]Fetching the repository
[command]/usr/bin/git -c protocol.version=<:NUM:> fetch <:*:> <:*:> <:*:> <:*:> <:*:> <:*:>
From <:*:>
* [new ref] <:SEQ:>-> <:*:>
##[endgroup]
##[group]Determining the checkout info
##[endgroup]
##[group]Checking out the ref
[command]/usr/bin/git checkout --progress --force refs/remotes/pull/<:NUM:>/merge
Note: switching to 'refs/remotes/pull/<:NUM:>/merge'.
2025-04-15T08:22:41.2114299Z
You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.
2025-04-15T08:22:41.2117914Z
If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:
2025-04-15T08:22:41.2119194Z
git switch -c <new-branch-name>
2025-04-15T08:22:41.2119924Z
Or undo this operation with:
2025-04-15T08:22:41.2120241Z
git switch -
2025-04-15T08:22:41.2120485Z
Turn off this advice by setting config variable advice.detachedHead to false
2025-04-15T08:22:41.2121031Z
HEAD is now at <:*:> Merge <:SEQ:> into <:SEQ:>
##[endgroup]
[command]/usr/bin/git log <:NUM:> <:*:>
'<:SEQ:>'
##[group]Run <:*:>
with:
node-version: 20.x
always-auth: false
check-latest: false
token: ***
env:
DB_MYSQLDB_PASSWORD: password
##[endgroup]
Found in cache @ /opt/hostedtoolcache/node/20.19.0/x64
##[group]Environment details
node: v20.19.0
npm: 10.8.2
yarn: 1.22.22
##[endgroup]
##[group]Run npm i -g corepack@0.31
[36;1mnpm i -g corepack@0.31[0m
[36;1mcorepack enable[0m
shell: /usr/bin/bash -e {<:NUM:>}
env:
DB_MYSQLDB_PASSWORD: password
##[endgroup]
2025-04-15T08:22:42.5059734Z
changed 1 package in 647ms
##[group]Run pnpm install --frozen-lockfile
[36;1mpnpm install --frozen-lockfile[0m
shell: /usr/bin/bash -e {<:NUM:>}
env:
DB_MYSQLDB_PASSWORD: password
##[endgroup]
! Corepack is about to download https://registry.npmjs.org/pnpm/-/pnpm-10.2.1.tgz
Scope: all 29 workspace projects
.../sqlite3@5.1.7/node_modules/sqlite3 install$ prebuild-install -r napi || node-gyp rebuild
.../sqlite3@5.1.7/node_modules/sqlite3 install: Done
2025-04-15T08:23:10.2430245Z
devDependencies:
+ @biomejs/biome 1.9.0
+ @n8n/eslint-config 0.0.1 <- packages/@n8n/eslint-config
+ @types/jest 29.5.3
+ @types/node 18.16.16
+ @types/supertest 6.0.2
+ cross-env 7.0.3
+ jest 29.6.2
+ jest-environment-jsdom 29.6.2
+ jest-expect-message 1.1.3
+ jest-junit 16.0.0
+ jest-mock 29.6.2
+ jest-mock-extended 3.0.4
+ lefthook 1.7.15
+ nock 14.0.1
+ nodemon 3.0.1
+ npm-run-all2 7.0.2
+ p-limit 3.1.0
+ rimraf 5.0.1
+ run-script-os 1.1.6
+ supertest 7.0.0
+ ts-jest 29.1.1
+ tsc-alias 1.8.10
+ tsc-watch 6.2.0
+ turbo 2.3.3
+ typescript 5.8.2
+ zx 8.1.4
2025-04-15T08:23:10.2448710Z
Ignored build scripts: @biomejs/biome, @fortawesome/fontawesome-common-types, @fortawesome/fontawesome-svg-core, @fortawesome/free-regular-svg-icons, @fortawesome/free-solid-svg-icons, core-js, cpu-features, cypress, esbuild, eslint-plugin-n8n-nodes-base, lefthook, msgpackr-extract, protobufjs, sharp, ssh2, tree-sitter, tree-sitter-bash, vue-demi. Run "pnpm approve-builds" to pick which dependencies should be allowed to run scripts.
2025-04-15T08:23:10.2455598Z
. preinstall$ node scripts/block-npm-install.js
. preinstall: Done
. prepare$ node scripts/prepare.mjs
. prepare: Done
Done in 27.4s
##[group]Run <:*:>
with:
cache-prefix: turbogha_
env:
DB_MYSQLDB_PASSWORD: password
##[endgroup]
Cache version: turbogha_v2
Cache prefix: turbogha_
Launched child process: 1976
Server log file: /home/runner/work/_temp/turbogha.log
Server is now up and running.
The following environment variables are exported:
TURBOGHA_PORT=41230
TURBO_API=http://localhost:41230
TURBO_TOKEN=turbogha
TURBO_TEAM=turbogha
##[group]Run <:*:>
with:
path: <:*:>
key: b166e406461ce2a6532018d6e615f5a4bf8aef71:db-tests
enableCrossOsArchive: false
fail-on-cache-miss: false
lookup-only: false
env:
DB_MYSQLDB_PASSWORD: password
TURBOGHA_PORT: 41230
TURBO_API: http://localhost:41230
TURBO_TOKEN: turbogha
TURBO_TEAM: turbogha
##[endgroup]
Cache hit for: b166e406461ce2a6532018d6e615f5a4bf8aef71:db-tests
Received 46905400 of 46905400 (100.0%), 148.1 MBs/sec
Cache Size: ~45 MB (46905400 B)
[command]/usr/bin/tar -xf /home/runner/work/_temp/036a0f41-6aaa-40ee-a6a7-e4dd8226adf3/cache.tzst -P -C /home/runner/work/n8n/n8n --use-compress-program unzstd
Cache restored successfully
Cache restored from key: b166e406461ce2a6532018d6e615f5a4bf8aef71:db-tests
##[group]Run <:*:>
with:
compose-file: ./.github/docker-compose.yml
services: mariadb
cwd: /home/runner/work/n8n/n8n
env:
DB_MYSQLDB_PASSWORD: password
TURBOGHA_PORT: 41230
TURBO_API: http://localhost:41230
TURBO_TOKEN: turbogha
TURBO_TEAM: turbogha
##[endgroup]
2.27.1
docker-compose version: 2.27.1
mariadb Pulling
13b7e930469f Pulling fs layer
333f0c69df78 Pulling fs layer
8b4f3d191a1d Pulling fs layer
39925a082074 Pulling fs layer
06c2bf42d3da Pulling fs layer
f5df99d02de0 Pulling fs layer
23dfc5d6cd7e Pulling fs layer
329c81ca2d70 Pulling fs layer
39925a082074 Waiting
f5df99d02de0 Waiting
06c2bf42d3da Waiting
23dfc5d6cd7e Waiting
329c81ca2d70 Waiting
333f0c69df78 Downloading [====================>                              ]     720B/1.72kB
333f0c69df78 Downloading [==================================================>]   1.72kB/1.72kB
333f0c69df78 Verifying Checksum
333f0c69df78 Download complete
13b7e930469f Downloading [>                                                  ]  281.9kB/27.51MB
8b4f3d191a1d Downloading [>                                                  ]  73.09kB/7.189MB
8b4f3d191a1d Verifying Checksum
8b4f3d191a1d Download complete
39925a082074 Downloading [==================================================>]     116B/116B
39925a082074 Verifying Checksum
39925a082074 Download complete
13b7e930469f Downloading [================================================>  ]   26.8MB/27.51MB
13b7e930469f Verifying Checksum
13b7e930469f Download complete
13b7e930469f Extracting [>                                                  ]  294.9kB/27.51MB
06c2bf42d3da Downloading [==================================================>]     334B/334B
06c2bf42d3da Verifying Checksum
06c2bf42d3da Download complete
f5df99d02de0 Downloading [>                                                  ]  539.9kB/86.27MB
23dfc5d6cd7e Downloading [========>                                          ]     720B/4.022kB
23dfc5d6cd7e Downloading [==================================================>]  4.022kB/4.022kB
23dfc5d6cd7e Verifying Checksum
23dfc5d6cd7e Download complete
329c81ca2d70 Downloading [====>                                              ]     720B/8.196kB
329c81ca2d70 Downloading [==================================================>]  8.196kB/8.196kB
329c81ca2d70 Verifying Checksum
329c81ca2d70 Download complete
13b7e930469f Extracting [==========>                                        ]  5.898MB/27.51MB
f5df99d02de0 Downloading [========>                                          ]  15.05MB/86.27MB
13b7e930469f Extracting [=================>                                 ]  9.437MB/27.51MB
f5df99d02de0 Downloading [===============>                                   ]  27.36MB/86.27MB
13b7e930469f Extracting [=========================>                         ]  13.86MB/27.51MB
f5df99d02de0 Downloading [========================>                          ]  41.85MB/86.27MB
13b7e930469f Extracting [======================================>            ]  20.94MB/27.51MB
f5df99d02de0 Downloading [========================================>          ]  69.25MB/86.27MB
f5df99d02de0 Verifying Checksum
f5df99d02de0 Download complete
13b7e930469f Extracting [==========================================>        ]   23.3MB/27.51MB
13b7e930469f Extracting [================================================>  ]  26.54MB/27.51MB
13b7e930469f Extracting [==================================================>]  27.51MB/27.51MB
13b7e930469f Pull complete
333f0c69df78 Extracting [==================================================>]   1.72kB/1.72kB
333f0c69df78 Extracting [==================================================>]   1.72kB/1.72kB
333f0c69df78 Pull complete
8b4f3d191a1d Extracting [>                                                  ]   98.3kB/7.189MB
8b4f3d191a1d Extracting [====================================>              ]   5.21MB/7.189MB
8b4f3d191a1d Extracting [==========================================>        ]  6.095MB/7.189MB
8b4f3d191a1d Extracting [===========================================>       ]  6.291MB/7.189MB
8b4f3d191a1d Extracting [=============================================>     ]  6.488MB/7.189MB
8b4f3d191a1d Extracting [==================================================>]  7.189MB/7.189MB
8b4f3d191a1d Pull complete
39925a082074 Extracting [==================================================>]     116B/116B
39925a082074 Extracting [==================================================>]     116B/116B
39925a082074 Pull complete
06c2bf42d3da Extracting [==================================================>]     334B/334B
06c2bf42d3da Extracting [==================================================>]     334B/334B
06c2bf42d3da Pull complete
f5df99d02de0 Extracting [>                                                  ]  557.1kB/86.27MB
f5df99d02de0 Extracting [====>                                              ]  8.356MB/86.27MB
f5df99d02de0 Extracting [=========>                                         ]  16.71MB/86.27MB
f5df99d02de0 Extracting [==============>                                    ]  24.51MB/86.27MB
f5df99d02de0 Extracting [==================>                                ]  32.31MB/86.27MB
f5df99d02de0 Extracting [======================>                            ]  39.55MB/86.27MB
f5df99d02de0 Extracting [============================>                      ]  48.46MB/86.27MB
f5df99d02de0 Extracting [=================================>                 ]  58.49MB/86.27MB
f5df99d02de0 Extracting [====================================>              ]  62.39MB/86.27MB
f5df99d02de0 Extracting [======================================>            ]  66.85MB/86.27MB
f5df99d02de0 Extracting [=========================================>         ]  70.75MB/86.27MB
f5df99d02de0 Extracting [=============================================>     ]   79.1MB/86.27MB
f5df99d02de0 Extracting [===============================================>   ]  82.44MB/86.27MB
f5df99d02de0 Extracting [================================================>  ]  84.12MB/86.27MB
f5df99d02de0 Extracting [=================================================> ]  85.79MB/86.27MB
f5df99d02de0 Extracting [==================================================>]  86.27MB/86.27MB
f5df99d02de0 Pull complete
23dfc5d6cd7e Extracting [==================================================>]  4.022kB/4.022kB
23dfc5d6cd7e Extracting [==================================================>]  4.022kB/4.022kB
23dfc5d6cd7e Pull complete
329c81ca2d70 Extracting [==================================================>]  8.196kB/8.196kB
329c81ca2d70 Extracting [==================================================>]  8.196kB/8.196kB
329c81ca2d70 Pull complete
mariadb Pulled
Network github_default  Creating
Network github_default  Created
Container github-mariadb-1  Creating
Container github-mariadb-1  Created
Container github-mariadb-1  Starting
Container github-mariadb-1  Started
docker-compose is up
##[group]Run pnpm test:mariadb --testTimeout 30000
[36;1mpnpm test:mariadb --testTimeout 30000[0m
shell: /usr/bin/bash -e {<:NUM:>}
env:
DB_MYSQLDB_PASSWORD: password
TURBOGHA_PORT: 41230
TURBO_API: http://localhost:41230
TURBO_TOKEN: turbogha
TURBO_TEAM: turbogha
##[endgroup]
2025-04-15T08:23:25.5159352Z
> n8n@1.89.0 test:mariadb /home/runner/work/n8n/n8n/packages/cli
> N8N_LOG_LEVEL=silent DB_TYPE=mariadb DB_TABLE_PREFIX=test_ jest --no-coverage --testTimeout 30000
2025-04-15T08:23:25.5162451Z
/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/@n8n/typeorm/driver/mysql/MysqlQueryRunner.js:165
return fail(new QueryFailedError_1.QueryFailedError(query, parameters, err));
^
2025-04-15T08:23:39.2848138Z
QueryFailedError: Can't add new command when connection is in closed state
at Query.onResult (/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:246:33)
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:169:11)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
query: 'DELETE FROM `test_insights_by_period` WHERE `periodStart` < DATE_SUB(CURRENT_DATE, INTERVAL 10 DAY)',
parameters: [],
driverError: Error: Can't add new command when connection is in closed state
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:164:17)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
<:*:> true
},
<:*:> true
}
2025-04-15T08:23:39.2877934Z
Node.js v20.19.0
PASS test/integration/workflows/workflows.controller.ee.test.ts (16.413 s)
router should switch based on flag
✓ when sharing is disabled (133 ms)
✓ when sharing is enabled (53 ms)
PUT /workflows/:workflowId/share
✓ should save sharing with new users (38 ms)
✓ should succeed when sharing with invalid user-id (28 ms)
✓ should allow sharing with pending users (41 ms)
✓ should allow sharing with multiple users (28 ms)
✓ should override sharing (39 ms)
✓ should allow sharing by the owner of the workflow (29 ms)
✓ should allow sharing by the instance owner (46 ms)
✓ should not allow sharing by another shared member (30 ms)
✓ should not allow sharing with self by another non-shared member (25 ms)
✓ should not allow sharing by another non-shared member (27 ms)
✓ should not call internal hooks listener for email sent if emailing is disabled (34 ms)
✓ should ignore sharing with owner project (23 ms)
✓ should ignore sharing with project that already has it shared (26 ms)
GET /workflows/new
✓ should return an auto-incremented name, even when sharing is enabled (28 ms)
✓ should return an auto-incremented name, even when sharing is disabled (25 ms)
GET /workflows/:workflowId
✓ should fail with invalid id due to route rule (32 ms)
✓ should return 404 for non existing workflow (14 ms)
✓ project viewers can view workflows (37 ms)
✓ should return a workflow with owner (31 ms)
✓ should return tags (37 ms)
✓ should return shared workflow with user data (34 ms)
✓ should return all sharees (39 ms)
✓ should return workflow with credentials owned by user (39 ms)
✓ should return workflow with credentials saying owner does have access even when not shared (45 ms)
✓ should return workflow with credentials saying admin does have access even when not shared (63 ms)
✓ should return workflow with credentials for all users with or without access (87 ms)
✓ should return workflow with credentials for all users with access (72 ms)
✓ should return workflow credentials home project and shared with projects (52 ms)
POST /workflows
✓ project viewers cannot create workflows (42 ms)
✓ Should create a workflow that uses no credential (35 ms)
✓ Should save a new workflow with credentials (26 ms)
✓ Should not allow saving a workflow using credential you have no access (19 ms)
✓ Should allow owner to save a workflow using credential owned by others (35 ms)
✓ Should allow saving a workflow using a credential owned by others and shared with you (43 ms)
✓ Should create workflow history version when licensed (37 ms)
✓ Should not create workflow history version when not licensed (27 ms)
PATCH /workflows/:workflowId
✓ project viewers cannot update workflows (21 ms)
validate credential permissions to user
✓ Should succeed when saving unchanged workflow nodes (80 ms)
✓ Should allow owner to add node containing credential not shared with the owner (61 ms)
✓ Tamper proofing kicks in if the workflow is owned by the owner and shared with the member, the credentials is owned by the owner, and the member tries to use the credential in the workflow (38 ms)
✓ Tamper proofing kicks in if the workflow is owned by team 1, the credentials is owned by the member, and the member tries to use the credential in the workflow (31 ms)
✓ Tamper proofing kicks in if the workflow is owned by team 1, the credentials is owned by team 2, and the member tries to use the credential in the workflow (45 ms)
✓ Tamper proofing kicks in if the workflow is owned by the member, the credentials is owned by the owner, and the member tries to use the credential in the workflow (58 ms)
✓ Tamper proofing kicks in if the workflow is owned by the member, the credentials is owned by team 2, and the member tries to use the credential in the workflow (51 ms)
✓ Should succeed but prevent modifying node attributes other than position, name and disabled (105 ms)
validate interim updates
✓ should block owner updating workflow nodes on interim update by member (119 ms)
✓ should block member updating workflow nodes on interim update by owner (141 ms)
✓ should block owner activation on interim activation by member (117 ms)
✓ should block member activation on interim activation by owner (141 ms)
✓ should block member updating workflow settings on interim update by owner (109 ms)
✓ should block member updating workflow name on interim update by owner (113 ms)
workflow history
✓ Should create workflow history version when licensed (42 ms)
✓ Should not create workflow history version when not licensed (55 ms)
activate workflow
✓ should activate workflow without changing version ID (46 ms)
✓ should deactivate workflow without changing version ID (33 ms)
PUT /:workflowId/transfer
✓ cannot transfer into the same project (28 ms)
✓ cannot transfer somebody elses workflow (26 ms)
✓ cannot transfer if you're not a member of the destination project (29 ms)
✓ project:editors cannot transfer workflows (26 ms)
✓ project:viewers cannot transfer workflows (27 ms)
✓ global owners can transfer workflows from a team project to a team project (40 ms)
✓ global owners can transfer workflows from a team project to a personal project (38 ms)
✓ global owners can transfer workflows from a personal project to a team project (38 ms)
✓ global admins can transfer workflows from a team project to a team project (38 ms)
✓ global admins can transfer workflows from a team project to a personal project (48 ms)
✓ global admins can transfer workflows from a personal project to a team project (43 ms)
✓ removes and re-adds the workflow from the active workflow manager during the transfer (43 ms)
✓ should detach workflow from parent folder in source project (60 ms)
✓ deactivates the workflow if it cannot be added to the active workflow manager again and returns the WorkflowActivationError as data (66 ms)
✓ owner transfers workflow from project they are not part of, e.g. test global cred sharing scope (85 ms)
✓ admin transfers workflow from project they are not part of, e.g. test global cred sharing scope (76 ms)
✓ member transfers workflow from personal project to team project and wf contains a credential that they can use but not share (57 ms)
✓ member transfers workflow from their personal project to another team project in which they have editor role (50 ms)
✓ member transfers workflow from a team project as project admin to another team project in which they have editor role (65 ms)
✓ member transfers workflow from a team project as project admin to another team project in which they have editor role but cannot share the credential that is only shared into the source project (52 ms)
✓ member transfers workflow from a team project as project admin to another team project in which they have editor role but cannot share all the credentials (85 ms)
✓ returns a 500 if the workflow cannot be activated due to an unknown error (47 ms)
POST /workflows/:workflowId/run
✓ project viewers cannot run workflows (22 ms)
2025-04-15T08:23:43.2572968Z
PASS test/integration/workflows/workflows.controller.test.ts (17.339 s)
POST /workflows
✓ should store pin data for node in workflow (133 ms)
✓ should set pin data to null if no pin data (61 ms)
✓ should return scopes on created workflow (60 ms)
✓ should create workflow history version when licensed (56 ms)
✓ should not create workflow history version when not licensed (47 ms)
✓ create workflow in personal project by default (108 ms)
✓ creates workflow in a specific project if the projectId is passed (84 ms)
✓ does not create the workflow in a specific project if the user is not part of the project (75 ms)
✓ does not create the workflow in a specific project if the user does not have the right role to do so (48 ms)
✓ create link workflow with folder if one is provided (74 ms)
✓ create workflow without parent folder if no folder is provided (57 ms)
✓ create workflow without parent is provided folder does not exist in the project (54 ms)
GET /workflows/:workflowId
✓ should return pin data (69 ms)
✓ should return tags (54 ms)
GET /workflows
✓ should return zero workflows if none exist (35 ms)
✓ should return workflows (79 ms)
✓ should return workflows with scopes when ?includeScopes=true (138 ms)
filter
✓ should filter workflows by field: name (49 ms)
✓ should filter workflows by field: active (57 ms)
✓ should filter workflows by field: tags (AND operator) (101 ms)
✓ should filter workflows by projectId (67 ms)
✓ should filter workflows by parentFolderId (70 ms)
✓ should return homeProject when filtering workflows by projectId (63 ms)
select
✓ should select workflow field: name (48 ms)
✓ should select workflow field: active (50 ms)
✓ should select workflow field: tags (62 ms)
✓ should select workflow fields: createdAt and updatedAt (66 ms)
✓ should select workflow field: versionId (64 ms)
✓ should select workflow field: ownedBy (63 ms)
✓ should select workflow field: parentFolder (55 ms)
sortBy
✓ should fail when trying to sort by non sortable column (40 ms)
✓ should sort by createdAt column (73 ms)
✓ should sort by name column (71 ms)
✓ should sort by updatedAt column (62 ms)
pagination
✓ should fail when skip is provided without take (76 ms)
✓ should handle skip with take parameter (88 ms)
✓ should handle pagination with sorting (81 ms)
✓ should handle pagination with filtering (88 ms)
✓ should return empty array when pagination exceeds total count (70 ms)
✓ should return all results when no pagination parameters are provided (71 ms)
GET /workflows?includeFolders=true
✓ should return zero workflows and folders if none exist (35 ms)
✓ should return workflows and folders (66 ms)
✓ should return workflows with scopes and folders when ?includeScopes=true (130 ms)
filter
✓ should filter workflows and folders by field: name (59 ms)
✓ should filter workflows and folders by field: active (44 ms)
✓ should filter workflows and folders by field: tags (AND operator) (75 ms)
✓ should filter workflows by projectId (58 ms)
✓ should filter workflows by parentFolderId and its descendants when filtering by name (74 ms)
✓ should return homeProject when filtering workflows and folders by projectId (69 ms)
sortBy
✓ should fail when trying to sort by non sortable column (42 ms)
✓ should sort by createdAt column (90 ms)
✓ should sort by name column (119 ms)
✓ should sort by updatedAt column (73 ms)
pagination
✓ should fail when skip is provided without take (64 ms)
✓ should handle skip with take parameter (72 ms)
✓ should handle pagination with sorting (78 ms)
✓ should handle pagination with filtering (113 ms)
✓ should return empty array when pagination exceeds total count (86 ms)
✓ should return all results when no pagination parameters are provided (72 ms)
PATCH /workflows/:workflowId
✓ should create workflow history version when licensed (72 ms)
✓ should not create workflow history version when not licensed (63 ms)
✓ should activate workflow without changing version ID (60 ms)
✓ should deactivate workflow without changing version ID (60 ms)
✓ should update workflow meta (61 ms)
✓ should move workflow to folder (61 ms)
✓ should move workflow to project root (64 ms)
✓ should fail if trying update workflow parent folder with a folder that does not belong to project (67 ms)
POST /workflows/:workflowId/run
✓ should prevent tampering if sharing is enabled (47 ms)
✓ should skip tampering prevention if sharing is disabled (55 ms)
DELETE /workflows/:workflowId
✓ deletes a workflow owned by the user (44 ms)
✓ deletes a workflow owned by the user, even if the user is just a member (48 ms)
✓ does not delete a workflow that is not owned by the user (47 ms)
✓ allows the owner to delete workflows they don't own (51 ms)
2025-04-15T08:23:44.1490262Z
/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/@n8n/typeorm/driver/mysql/MysqlQueryRunner.js:165
return fail(new QueryFailedError_1.QueryFailedError(query, parameters, err));
^
2025-04-15T08:23:47.2042981Z
QueryFailedError: Can't add new command when connection is in closed state
at Query.onResult (/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:246:33)
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:169:11)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
query: 'DELETE FROM `test_insights_by_period` WHERE `periodStart` < DATE_SUB(CURRENT_DATE, INTERVAL 10 DAY)',
parameters: [],
driverError: Error: Can't add new command when connection is in closed state
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:164:17)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
<:*:> true
},
<:*:> true
}
2025-04-15T08:23:47.2123949Z
Node.js v20.19.0
PASS test/integration/credentials/credentials.api.test.ts (10.661 s)
GET /credentials
✓ should return all creds for owner (108 ms)
✓ should return only own creds for member (71 ms)
✓ should return scopes when ?includeScopes=true (104 ms)
✓ should return data when ?includeData=true (100 ms)
✓ should return data when ?includeData=true for owners (56 ms)
should return
✓ all credentials for owner (95 ms)
✓ only own credentials for member (63 ms)
filter
✓ should filter credentials by field: name - full match (57 ms)
✓ should filter credentials by field: name - partial match (50 ms)
✓ should filter credentials by field: type - full match (53 ms)
✓ should filter credentials by field: type - partial match (41 ms)
✓ should filter credentials by projectId (46 ms)
✓ should return homeProject when filtering credentials by projectId (61 ms)
✓ should return all credentials in a team project that member is part of (58 ms)
✓ should return no credentials in a team project that member not is part of (50 ms)
✓ should return only owned and explicitly shared credentials when filtering by any personal project id (58 ms)
✓ should not ignore the project filter when the request is done by an owner and also includes the scopes (69 ms)
select
✓ should select credential field: id (45 ms)
✓ should select credential field: name (42 ms)
✓ should select credential field: type (40 ms)
take
✓ should return n credentials or less, without skip (57 ms)
✓ should return n credentials or less, with skip (51 ms)
POST /credentials
✓ should create cred (54 ms)
✓ should fail with invalid inputs (55 ms)
✓ should ignore ID in payload (59 ms)
✓ creates credential in personal project by default (56 ms)
✓ creates credential in a specific project if the projectId is passed (62 ms)
✓ does not create the credential in a specific project if the user is not part of the project (69 ms)
DELETE /credentials/:id
✓ should delete owned cred for owner (56 ms)
✓ should delete non-owned cred for owner (49 ms)
✓ should delete owned cred for member (56 ms)
✓ should not delete non-owned cred for member (62 ms)
✓ should not delete non-owned but shared cred for member (64 ms)
✓ should fail if cred not found (62 ms)
PATCH /credentials/:id
✓ should update owned cred for owner (55 ms)
✓ should update non-owned cred for owner (50 ms)
✓ should update owned cred for member (69 ms)
✓ should not update non-owned cred for member (38 ms)
✓ should not update non-owned but shared cred for member (46 ms)
✓ should update non-owned but shared cred for instance owner (55 ms)
✓ should not allow to overwrite oauthTokenData (74 ms)
✓ should fail with invalid inputs (132 ms)
✓ should fail with a 404 if the credential does not exist and the actor has the global credential:update scope (44 ms)
✓ should fail with a 403 if the credential does not exist and the actor does not have the global credential:update scope (39 ms)
✓ should fail with a 400 is credential is managed (60 ms)
GET /credentials/new
✓ should return default name for new credential or its increment (133 ms)
✓ should return name from query for new credential or its increment (104 ms)
GET /credentials/:id
✓ should retrieve owned cred for owner (69 ms)
✓ should redact the data when `includeData:true` is passed (71 ms)
✓ should omit oauth data when `includeData:true` is passed (49 ms)
✓ should retrieve owned cred for member (74 ms)
✓ should retrieve non-owned cred for owner (49 ms)
✓ should not retrieve non-owned cred for member (50 ms)
✓ should return 404 if cred not found (44 ms)
POST /credentials/test
✓ should test a credential with unredacted data (39 ms)
✓ should test a credential with redacted data (47 ms)
2025-04-15T08:23:54.1888929Z
/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/@n8n/typeorm/driver/mysql/MysqlQueryRunner.js:165
return fail(new QueryFailedError_1.QueryFailedError(query, parameters, err));
^
2025-04-15T08:23:55.3407309Z
QueryFailedError: Can't add new command when connection is in closed state
at Query.onResult (/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:246:33)
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:169:11)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
query: 'DELETE FROM `test_insights_by_period` WHERE `periodStart` < DATE_SUB(CURRENT_DATE, INTERVAL 10 DAY)',
parameters: [],
driverError: Error: Can't add new command when connection is in closed state
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:164:17)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
<:*:> true
},
<:*:> true
}
2025-04-15T08:23:55.3431647Z
Node.js v20.19.0
PASS test/integration/public-api/workflows.test.ts (11.589 s)
GET /workflows
✓ should fail due to missing API Key (39 ms)
✓ should fail due to invalid API Key (16 ms)
✓ should return all owned workflows (1333 ms)
✓ should return all owned workflows with pagination (71 ms)
✓ should return all owned workflows filtered by tag (40 ms)
✓ should return all owned workflows filtered by tags (68 ms)
✓ for owner, should return all workflows filtered by `projectId` (53 ms)
✓ for member, should return all member-accessible workflows filtered by `projectId` (36 ms)
✓ should return all owned workflows filtered by name (45 ms)
✓ should return all workflows for owner (52 ms)
✓ should return all owned workflows without pinned data (37 ms)
GET /workflows/:id
✓ should fail due to missing API Key (13 ms)
✓ should fail due to invalid API Key (11 ms)
✓ should fail due to non-existing workflow (24 ms)
✓ should retrieve workflow (38 ms)
✓ should retrieve non-owned workflow for owner (27 ms)
✓ should retrieve workflow without pinned data (42 ms)
DELETE /workflows/:id
✓ should fail due to missing API Key (14 ms)
✓ should fail due to invalid API Key (11 ms)
✓ should fail due to non-existing workflow (39 ms)
✓ should delete the workflow (35 ms)
✓ should delete non-owned workflow when owner (49 ms)
POST /workflows/:id/activate
✓ should fail due to missing API Key (9 ms)
✓ should fail due to invalid API Key (11 ms)
✓ should fail due to non-existing workflow (23 ms)
✓ should fail due to trying to activate a workflow without any nodes (38 ms)
✓ should fail due to trying to activate a workflow without a trigger (35 ms)
✓ should set workflow as active (106 ms)
✓ should set non-owned workflow as active when owner (94 ms)
POST /workflows/:id/deactivate
✓ should fail due to missing API Key (11 ms)
✓ should fail due to invalid API Key (10 ms)
✓ should fail due to non-existing workflow (26 ms)
✓ should deactivate workflow (68 ms)
✓ should deactivate non-owned workflow when owner (69 ms)
POST /workflows
✓ should fail due to missing API Key (11 ms)
✓ should fail due to invalid API Key (10 ms)
✓ should fail due to invalid body (50 ms)
✓ should create workflow (35 ms)
✓ should create workflow history version when licensed (22 ms)
✓ should not create workflow history version when not licensed (20 ms)
✓ should not add a starting node if the payload has no starting nodes (22 ms)
PUT /workflows/:id
✓ should fail due to missing API Key (15 ms)
✓ should fail due to invalid API Key (16 ms)
✓ should fail due to non-existing workflow (42 ms)
✓ should fail due to invalid body (10 ms)
✓ should update workflow (29 ms)
✓ should create workflow history version when licensed (40 ms)
✓ should not create workflow history when not licensed (37 ms)
✓ should update non-owned workflow if owner (36 ms)
GET /workflows/:id/tags
✓ should fail due to missing API Key (12 ms)
✓ should fail due to invalid API Key (10 ms)
✓ should fail if N8N_WORKFLOW_TAGS_DISABLED (26 ms)
✓ should fail due to non-existing workflow (14 ms)
✓ should return all tags of owned workflow (40 ms)
✓ should return empty array if workflow does not have tags (33 ms)
PUT /workflows/:id/tags
✓ should fail due to missing API Key (12 ms)
✓ should fail due to invalid API Key (10 ms)
✓ should fail if N8N_WORKFLOW_TAGS_DISABLED (25 ms)
✓ should fail due to non-existing workflow (17 ms)
✓ should add the tags, workflow have not got tags previously (41 ms)
✓ should add the tags, workflow have some tags previously (45 ms)
✓ should fail to add the tags as one does not exist, workflow should maintain previous tags (73 ms)
PUT /workflows/:id/transfer
✓ should transfer workflow to project (84 ms)
✓ if no destination project, should reject (52 ms)
2025-04-15T08:23:55.9977336Z
PASS src/events/__tests__/telemetry-event-relay.test.ts
TelemetryEventRelay
init
✓ with diagnostics enabled, should init telemetry and register listeners (6 ms)
✓ with diagnostics disabled, should neither init telemetry nor register listeners (6 ms)
project events
✓ should track on `team-project-updated` event (2 ms)
✓ should track on `team-project-deleted` event (1 ms)
✓ should track on `team-project-created` event (1 ms)
source control events
✓ should track on `source-control-settings-updated` event
✓ should track on `source-control-user-started-pull-ui` event
✓ should track on `source-control-user-finished-pull-ui` event
✓ should track on `source-control-user-pulled-api` event (1 ms)
✓ should track on `source-control-user-started-push-ui` event (1 ms)
✓ should track on `source-control-user-finished-push-ui` event (1 ms)
license events
✓ should track on `license-renewal-attempted` event
variable events
✓ should track on `variable-created` event
external secrets events
✓ should track on `external-secrets-provider-settings-saved` event (1 ms)
public API events
✓ should track on `public-api-invoked` event
✓ should track on `public-api-key-created` event
✓ should track on `public-api-key-deleted` event (1 ms)
community package events
✓ should track on `community-package-installed` event (1 ms)
✓ should track on `community-package-updated` event
✓ should track on `community-package-deleted` event (1 ms)
credentials events
✓ should track on `credentials-created` event (1 ms)
✓ should track on `credentials-shared` event (1 ms)
✓ should track on `credentials-updated` event
✓ should track on `credentials-deleted` event (1 ms)
LDAP events
✓ should track on `ldap-general-sync-finished` event
✓ should track on `ldap-settings-updated` event
✓ should track on `ldap-login-sync-failed` event (1 ms)
✓ should track on `login-failed-due-to-ldap-disabled` event
workflow events
✓ should track on `workflow-created` event (4 ms)
✓ should track on `workflow-deleted` event (2 ms)
✓ should track on `workflow-post-execute` event (3 ms)
✓ should track on `workflow-saved` event (8 ms)
✓ should track on `workflow-sharing-updated` event
user events
✓ should track on `user-updated` event (1 ms)
✓ should track on `user-deleted` event
✓ should track on `user-invited` event (1 ms)
✓ should track on `user-signed-up` event
✓ should track on `user-submitted-personalization-survey` event (1 ms)
✓ should track on `user-changed-role` event
✓ should track on `user-retrieved-user` event (1 ms)
✓ should track on `user-retrieved-all-users` event
lifecycle events
✓ should track on `server-started` event (8 ms)
✓ should track on `session-started` event (1 ms)
✓ should track on `instance-stopped` event
✓ should track on `instance-owner-setup` event (1 ms)
workflow execution events
✓ should track on `first-production-workflow-succeeded` event (1 ms)
✓ should track on `first-workflow-data-loaded` event (1 ms)
email events
✓ should track on `email-failed` event (1 ms)
Community+ registered
✓ should track `license-community-plus-registered` event (1 ms)
workflow post execute events
✓ should not track when workflow has no id (2 ms)
✓ should track successful workflow execution (8 ms)
✓ should call telemetry.track when manual node execution finished (5 ms)
✓ should call telemetry.track when manual node execution finished with canceled error message (3 ms)
✓ should call telemetry.track when manual workflow execution finished (67 ms)
✓ should call telemetry.track when manual node execution finished with is_managed and credential_type properties (7 ms)
✓ should call telemetry.track when user ran out of free AI credits (5 ms)
2025-04-15T08:24:00.5049655Z
/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/@n8n/typeorm/driver/mysql/MysqlQueryRunner.js:165
return fail(new QueryFailedError_1.QueryFailedError(query, parameters, err));
^
2025-04-15T08:24:03.2309580Z
QueryFailedError: Can't add new command when connection is in closed state
at Query.onResult (/home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:246:33)
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:169:11)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
query: 'DELETE FROM `test_insights_by_period` WHERE `periodStart` < DATE_SUB(CURRENT_DATE, INTERVAL 10 DAY)',
parameters: [],
driverError: Error: Can't add new command when connection is in closed state
at PoolConnection._addCommandClosedState (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:164:17)
at PoolConnection.query (/home/runner/work/n8n/n8n/node_modules/.pnpm/mysql2@3.11.0/node_modules/mysql2/lib/connection.js:575:17)
at /home/runner/work/n8n/n8n/node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/driver/mysql/MysqlQueryRunner.ts:207:36
at processTicksAndRejections (node:internal/process/task_queues:95:5) {
<:*:> true
},
<:*:> true
}
2025-04-15T08:24:03.2365501Z
Node.js v20.19.0
FAIL src/modules/insights/__tests__/insights.service.test.ts
● Test suite failed to run
2025-04-15T08:24:03.3263479Z
Jest worker encountered 4 child process exceptions, exceeding retry limit
2025-04-15T08:24:03.3281763Z
at ChildProcessWorker.initialize (../../node_modules/.pnpm/jest-worker@29.6.2/node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)
2025-04-15T08:24:03.3284802Z
PASS test/integration/credentials/credentials.api.ee.test.ts (11.12 s)
POST /credentials
✓ project viewers cannot create credentials (181 ms)
GET /credentials
✓ should return all creds for owner (151 ms)
✓ should return only relevant creds for member (102 ms)
✓ should show credentials that the user has access to through a team project they are part of (71 ms)
GET /credentials/for-workflow
for team projects
✓ it will only return the credentials in that project if "workflowId" is used as the query parameter and the actor is a "member" (110 ms)
✓ it will only return the credentials in that project if "projectId" is used as the query parameter and the actor is a "member" (72 ms)
✓ it will only return the credentials in that project if "workflowId" is used as the query parameter and the actor is a "owner" (73 ms)
✓ it will only return the credentials in that project if "projectId" is used as the query parameter and the actor is a "owner" (79 ms)
for personal projects
✓ it returns only personal credentials for a members, if "projectId" is used as the query parameter (111 ms)
✓ it returns only personal credentials for a members, if "workflowId" is used as the query parameter (125 ms)
✓ if the actor is a global owner and the workflow has not been shared with them, it returns all credentials of all projects the workflow is part of (98 ms)
✓ if the actor is a global owner and the workflow has been shared with them, it returns all credentials of all projects the workflow is part of (86 ms)
✓ if the projectId is passed by a global owner it will return all credentials in that project (86 ms)
✓ if the global owner owns the workflow it will return all credentials of all personal projects, when using "workflowId" as the query parameter (81 ms)
✓ if the global owner owns the workflow it will return all credentials of all personal projects, when using "projectId" as the query parameter (87 ms)
GET /credentials/:id
✓ project viewers can view credentials (72 ms)
✓ should retrieve owned cred for owner (95 ms)
✓ should redact the data when `includeData:true` is passed (77 ms)
✓ should retrieve non-owned cred for owner (105 ms)
✓ should retrieve owned cred for member (145 ms)
✓ should not retrieve non-owned cred for member (56 ms)
✓ should return 404 if cred not found (57 ms)
PATCH /credentials/:id
✓ project viewer cannot update credentials (62 ms)
PUT /credentials/:id/share
✓ should share the credential with the provided userIds and unshare it for missing ones (100 ms)
✓ should share the credential with the provided userIds (83 ms)
✓ should respond 403 for non-existing credentials (47 ms)
✓ should respond 403 for non-owned credentials for shared members (51 ms)
✓ should respond 403 for non-owned credentials for non-shared members sharing with self (58 ms)
✓ should respond 403 for non-owned credentials for non-shared members sharing (60 ms)
✓ should respond 200 for non-owned credentials for owners (46 ms)
✓ should not ignore pending sharee (66 ms)
✓ should ignore non-existing sharee (52 ms)
✓ should ignore sharing with owner project (62 ms)
✓ should ignore sharing with project that already has it shared (50 ms)
✓ should respond 400 if invalid payload is provided (42 ms)
✓ should unshare the credential (59 ms)
✓ should not call internal hooks listener for email sent if emailing is disabled (64 ms)
✓ member should be able to share from personal project to team project that member has access to (61 ms)
✓ member should be able to share from team project to personal project (61 ms)
✓ member should be able to share from team project to team project that member has access to (55 ms)
✓ admins should be able to share from any team project to any team project  (79 ms)
✓ admins should be able to share from any team project to any user's personal project  (52 ms)
✓ admins should be able to share from any personal project to any team project  (56 ms)
PUT /:credentialId/transfer
✓ cannot transfer into the same project (59 ms)
✓ cannot transfer somebody elses credential (68 ms)
✓ cannot transfer if you're not a member of the destination project (51 ms)
✓ project:editors cannot transfer credentials (63 ms)
✓ project:viewers cannot transfer credentials (46 ms)
✓ owners can always transfer from a team project to a team project (52 ms)
✓ owners can always transfer from a team project to a personal project (42 ms)
✓ owners can always transfer from a personal project to a team project (59 ms)
✓ admins can always transfer from a team project to a team project (57 ms)
✓ admins can always transfer from a team project to a personal project (56 ms)
✓ admins can always transfer from a personal project to a team project (61 ms)
2025-04-15T08:24:05.5851352Z
PASS src/ldap.ee/__tests__/ldap.service.test.ts
LdapService
init()
✓ should load the LDAP configuration (9 ms)
✓ should set expected configuration variables from LDAP config if LDAP is enabled (3 ms)
✓ should set expected configuration variables from LDAP config if LDAP is disabled (1 ms)
✓ should show logger warning if authentication method is not ldap or email (2 ms)
✓ should schedule syncing if config has enabled synchronization (2 ms)
✓ should throw an error if config has enabled synchronization but no synchronizationInterval is set (43 ms)
loadConfig()
✓ should retrieve the LDAP configuration from the settings repository (1 ms)
✓ should throw an expected error if the LDAP configuration is not found (1 ms)
✓ should decipher the LDAP configuration admin password (1 ms)
✓ should return the expected LDAP configuration (1 ms)
updateConfig()
✓ should throw expected error if the LDAP configuration is invalid (4 ms)
✓ should throw expected error if login is enabled and the current authentication method is "saml" (2 ms)
✓ should encrypt the binding admin password (2 ms)
✓ should delete all ldap identities if login is disabled and ldap users exist (2 ms)
✓ should not delete ldap identities if login is disabled and there are no ldap identities (2 ms)
✓ should update the LDAP configuration in the settings repository (1 ms)
✓ should update the LDAP login label in the config (2 ms)
setConfig()
✓ should stop synchronization if the timer is running and the config is disabled (1 ms)
✓ should schedule synchronization if the timer is not running and the config is enabled (1 ms)
✓ should throw an error if the timer is not running and the config is enabled but the synchronizationInterval is not set (2 ms)
✓ should restart synchronization if the timer is running and the config is enabled (2 ms)
searchWithAdminBinding()
✓ should bind admin client (1 ms)
✓ should call client search with expected parameters (1 ms)
✓ should call client search with expected parameters when searchPageSize is 0 (1 ms)
✓ should unbind client after search (1 ms)
✓ should return expected search entries
validUser()
✓ should throw expected error if no configuration has been set
✓ should bind the ldap client with the expected distinguished name and password
✓ should throw expected error if binding fails (1 ms)
✓ should unbind the client binding (1 ms)
findAndAuthenticateLdapUser()
✓ should search for expected admin login ID (1 ms)
✓ should emit expected error if admin search fails (1 ms)
✓ should return undefined if no user is found (1 ms)
✓ should validate found user (1 ms)
✓ should validate last user if more than one is found
✓ should return undefined if invalid user is found (1 ms)
✓ should resolve binary attributes for found user (1 ms)
✓ should return found user (1 ms)
testConnection()
✓ should throw expected error if init() is not called first
✓ should create a new client without TLS if connectionSecurity is set to "none" (1 ms)
✓ should create a new client with TLS enabled if connectionSecurity is set to "tls" and allowing unauthorized certificates (1 ms)
✓ should create a new client with TLS enabled if connectionSecurity is set to "tls" and not allowing unauthorized certificates
✓ should create a new client and start TLS if connectionSecurity is set to "startTls" (1 ms)
✓ should not create a new client if one has already been created (1 ms)
runSync()
✓ should search for users with expected parameters (1 ms)
✓ should resolve binary attributes for users (1 ms)
✓ should throw expected error if search fails (1 ms)
✓ should process expected users if mode is "live" (1 ms)
✓ should sync expected LDAP data when no errors (1 ms)
✓ should sync expected LDAP data when users fail to process (1 ms)
✓ should emit expected event if synchronization is enabled (6 ms)
✓ should emit expected event if synchronization is disabled (1 ms)
✓ should emit expected event with error message if processUsers fails (2 ms)
stopSync()
✓ should clear the scheduled timer
2025-04-15T08:24:07.6933789Z
PASS test/integration/folder/folder.controller.test.ts (10.457 s)
POST /projects/:projectId/folders
✓ should not create folder when project does not exist (119 ms)
✓ should not create folder when name is empty (41 ms)
✓ should not create folder if user has project:viewer role in team project (45 ms)
✓ should not allow creating folder in another user's personal project (31 ms)
✓ should create folder if user has project:editor role in team project (41 ms)
✓ should create folder if user has project:admin role in team project (38 ms)
✓ should not allow creating folder with parent that exists in another project (66 ms)
✓ should create folder in root of specified project (43 ms)
✓ should create folder in specified project within another folder (46 ms)
✓ should create folder in personal project (48 ms)
GET /projects/:projectId/folders/:folderId/tree
✓ should not get folder tree when project does not exist (55 ms)
✓ should not get folder tree when folder does not exist (36 ms)
✓ should not get folder tree if user has no access to project (39 ms)
✓ should not allow getting folder tree from another user's personal project (32 ms)
✓ should get nested folder structure (39 ms)
PATCH /projects/:projectId/folders/:folderId
✓ should not update folder when project does not exist (32 ms)
✓ should not update folder when folder does not exist (31 ms)
✓ should not update folder when name is empty (40 ms)
✓ should not update folder if user has project:viewer role in team project (39 ms)
✓ should not allow updating folder in another user's personal project (29 ms)
✓ should update folder if user has project:editor role in team project (53 ms)
✓ should update folder if user has project:admin role in team project (41 ms)
✓ should update folder in personal project (42 ms)
✓ should update folder tags (49 ms)
✓ should replace existing folder tags with new ones (61 ms)
✓ should update folder parent folder ID (55 ms)
✓ should not update folder parent when target folder does not exist (37 ms)
✓ should not update folder parent when target folder is in another project (44 ms)
✓ should allow moving a folder to root level by setting parentFolderId to "0" (44 ms)
✓ should not update folder parent if user has project:viewer role in team project (43 ms)
✓ should update folder parent folder if user has project:editor role in team project (50 ms)
✓ should not allow setting a folder as its own parent (50 ms)
DELETE /projects/:projectId/folders/:folderId
✓ should not delete folder when project does not exist (31 ms)
✓ should not delete folder when folder does not exist (41 ms)
✓ should not delete folder if user has project:viewer role in team project (38 ms)
✓ should not allow deleting folder in another user's personal project (34 ms)
✓ should delete folder if user has project:editor role in team project (38 ms)
✓ should delete folder if user has project:admin role in team project (36 ms)
✓ should delete folder in personal project (37 ms)
✓ should delete folder, all child folders, and contained workflows when no transfer folder is specified (57 ms)
✓ should transfer folder contents when transferToFolderId is specified (74 ms)
✓ should not transfer folder contents when transfer folder does not exist (38 ms)
✓ should not transfer folder contents when transfer folder is in another project (41 ms)
✓ should not allow transferring contents to the same folder being deleted (41 ms)
✓ should transfer folder contents to project root when transferToFolderId is "0" (65 ms)
GET /projects/:projectId/folders
✓ should not list folders when project does not exist (43 ms)
✓ should not list folders if user has no access to project (33 ms)
✓ should not allow listing folders from another user's personal project (25 ms)
✓ should list folders if user has project:viewer role in team project (51 ms)
✓ should list folders from personal project (41 ms)
✓ should filter folders by name (36 ms)
✓ should filter folders by parent folder ID (47 ms)
✓ should filter root-level folders when parentFolderId=0 (36 ms)
✓ should filter folders by tag (58 ms)
✓ should filter folders by multiple tags (AND operator) (47 ms)
✓ should filter folders by excludeFolderIdAndDescendants (43 ms)
✓ should apply pagination with take parameter (71 ms)
✓ should apply pagination with skip parameter (44 ms)
✓ should apply combined skip and take parameters (40 ms)
✓ should sort folders by name ascending (39 ms)
✓ should sort folders by name descending (42 ms)
✓ should sort folders by updatedAt (36 ms)
✓ should select specific fields when requested (41 ms)
✓ should combine multiple query parameters correctly (44 ms)
✓ should filter by projectId automatically based on URL (36 ms)
GET /projects/:projectId/folders/content
✓ should not list folders when project does not exist (30 ms)
✓ should not return folder content if user has no access to project (31 ms)
✓ should not return folder content if folder does not belong to project (32 ms)
✓ should return folder content if user has project:viewer role in team project (60 ms)
✓ should return folder content (89 ms)
2025-04-15T08:24:11.1905336Z
PASS src/evaluation.ee/test-runner/__tests__/test-runner.service.ee.test.ts (5.355 s)
TestRunnerService
✓ should create an instance of TestRunnerService (9 ms)
✓ should create and run test cases from past executions (26 ms)
✓ should run both workflow under test and evaluation workflow (18 ms)
✓ should properly count passed and failed executions (14 ms)
✓ should properly count failed test executions (26 ms)
✓ should properly count failed evaluations (35 ms)
✓ should specify correct start nodes when running workflow under test (34 ms)
✓ should properly choose trigger and start nodes (2 ms)
✓ should properly choose trigger and start nodes 2 (1 ms)
✓ should properly run test when nodes were renamed (50 ms)
✓ should properly choose trigger when it was renamed (2 ms)
✓ should create proper execution data for queue mode in runTestCase (6 ms)
✓ should create proper execution data for regular mode in runTestCase (5 ms)
✓ should run workflow with metrics defined in the middle of the workflow (12 ms)
✓ should properly override metrics from earlier nodes with later ones (10 ms)
Test Run cancellation
✓ should cancel test run (20 ms)
2025-04-15T08:24:13.2866366Z
PASS test/integration/project.api.test.ts (8.808 s)
GET /projects/
✓ member should get all personal projects and team projects they are apart of (142 ms)
✓ owner should get all projects (54 ms)
GET /projects/count
✓ should return correct number of projects (36 ms)
GET /projects/my-projects
✓ member should get all projects they are apart of (80 ms)
✓ owner should get all projects they are apart of (64 ms)
GET /projects/personal
✓ should return the user's personal project (18 ms)
✓ should return 404 if user doesn't have a personal project (34 ms)
POST /projects/
✓ should create a team project (26 ms)
✓ should allow to create a team projects if below the quota (26 ms)
✓ should fail to create a team project if at quota (22 ms)
✓ should fail to create a team project if above the quota (19 ms)
PATCH /projects/:projectId
✓ should update a team project name (27 ms)
✓ should not allow viewers to edit team project name (21 ms)
✓ should not allow owners to edit personal project name (29 ms)
member management
✓ should add or remove users from a project (86 ms)
✓ `project:viewer`s should not be able to add, update or remove users from a project (33 ms)
✓ `project:editor`s should not be able to add, update or remove users from a project (44 ms)
✓ should not be able to add a user with the role project:viewer if it's not licensed (28 ms)
✓ should not be able to add a user with the role project:editor if it's not licensed (29 ms)
✓ should not edit a relation of a project when changing a user's role to an unlicensed role (44 ms)
✓ should  edit a relation of a project when changing a user's role to an licensed role but unlicensed roles are present (42 ms)
✓ should not add or remove users from a personal project (28 ms)
GET /project/:projectId
✓ should get project details and relations (54 ms)
DELETE /project/:projectId
✓ allows the project:owner to delete a project (86 ms)
✓ allows the instance owner to delete a team project their are not related to (34 ms)
✓ does not allow instance members to delete their personal project (13 ms)
✓ does not allow instance owners to delete their personal projects (16 ms)
✓ does not allow users with the role project:editor to delete a project (18 ms)
✓ does not allow users with the role project:viewer to delete a project (17 ms)
✓ deletes all workflows and credentials it owns as well as the sharings into other projects (99 ms)
✓ unshares all workflows and credentials that were shared with the project (80 ms)
✓ deletes the project relations (48 ms)
✓ should fail if the project to delete does not exist (11 ms)
✓ should fail to delete if project to migrate to and the project to delete are the same (21 ms)
✓ does not migrate credentials and projects if the user does not have the permissions to create workflows or credentials in the target project (27 ms)
✓ migrates folders, workflows and credentials to another project if `migrateToProject` is passed (70 ms)
✓ should upgrade a projects role if the workflow/credential is already shared with it (51 ms)
2025-04-15T08:24:14.6931675Z
PASS src/task-runners/task-broker/__tests__/task-broker.service.test.ts
TaskBroker
expireTasks
✓ should remove expired task offers and keep valid task offers (8 ms)
✓ should not expire non-expiring task offers (6 ms)
registerRunner
✓ should add a runner to known runners (2 ms)
✓ should send node types to runner (1 ms)
registerRequester
✓ should add a requester to known requesters (1 ms)
deregisterRunner
✓ should remove a runner from known runners
✓ should remove any pending offers for that runner
✓ should fail any running tasks for that runner (1 ms)
deregisterRequester
✓ should remove a requester from known requesters (1 ms)
taskRequested
✓ should match a pending offer to an incoming request (1 ms)
taskOffered
✓ should match a pending request to an incoming offer (1 ms)
settleTasks
✓ should match task offers with task requests by task type (2 ms)
✓ should not match a request whose acceptance is in progress (2 ms)
✓ should expire tasks before settling
onRunnerMessage
✓ should handle `runner:taskaccepted` message (3 ms)
✓ should handle `runner:taskrejected` message (1 ms)
✓ should handle `runner:taskdone` message (1 ms)
✓ should handle `runner:taskerror` message (1 ms)
✓ should handle `runner:taskdatarequest` message (1 ms)
✓ should handle `runner:rpc` message
✓ should handle `runner:nodetypesrequest` message
✓ should handle `runner:taskoffer` message with expiring offer (2 ms)
✓ should handle `runner:taskoffer` message with non-expiring offer (1 ms)
onRequesterMessage
✓ should handle `requester:nodetypesresponse` message (1 ms)
task timeouts
✓ on sending task, we should set up task timeout (2 ms)
✓ on task completion, we should clear timeout
✓ on task error, we should clear timeout
✓ [internal mode] on timeout, we should emit `runner:timed-out-during-task` event and send error to requester (2 ms)
✓ [external mode] on timeout, we should instruct the runner to cancel and send error to requester (2 ms)
2025-04-15T08:24:17.9559481Z
PASS src/events/__tests__/log-streaming-event-relay.test.ts (5.625 s)
LogStreamingEventRelay
workflow events
✓ should log on `workflow-created` event (7 ms)
✓ should log on `workflow-deleted` event
✓ should log on `workflow-saved` event (1 ms)
✓ should log on `workflow-pre-execute` event (1 ms)
✓ should log on `workflow-post-execute` for successful execution (1 ms)
✓ should log on `workflow-post-execute` event for failed execution (1 ms)
user events
✓ should log on `user-updated` event
✓ should log on `user-deleted` event (1 ms)
✓ should log on `user-invited` event (1 ms)
✓ should log on `user-reinvited` event (6 ms)
✓ should log on `user-signed-up` event
✓ should log on `user-logged-in` event (1 ms)
click events
✓ should log on `user-password-reset-request-click` event
✓ should log on `user-invite-email-click` event
✓ should log on `user-password-reset-email-click` event (1 ms)
node events
✓ should log on `node-pre-execute` event
✓ should log on `node-post-execute` event
credentials events
✓ should log on `credentials-shared` event
✓ should log on `credentials-created` event (1 ms)
✓ should log on `credentials-deleted` event
✓ should log on `credentials-updated` event (1 ms)
auth events
✓ should log on `user-login-failed` event
community package events
✓ should log on `community-package-updated` event (4 ms)
✓ should log on `community-package-installed` event (1 ms)
✓ should log on `community-package-deleted` event
email events
✓ should log on `email-failed` event
public API events
✓ should log on `public-api-key-created` event (1 ms)
✓ should log on `public-api-key-deleted` event (1 ms)
execution events
✓ should log on `execution-started-during-bootup` event (1 ms)
✓ should log on `execution-throttled` event
AI events
✓ should log on `ai-messages-retrieved-from-memory` event
✓ should log on `ai-message-added-to-memory` event (1 ms)
✓ should log on `ai-output-parsed` event (1 ms)
✓ should log on `ai-documents-retrieved` event
✓ should log on `ai-document-embedded` event (1 ms)
✓ should log on `ai-query-embedded` event
✓ should log on `ai-document-processed` event
✓ should log on `ai-text-split` event (1 ms)
✓ should log on `ai-tool-called` event
✓ should log on `ai-vector-store-searched` event (1 ms)
✓ should log on `ai-llm-generated-output` event
✓ should log on `ai-llm-errored` event (1 ms)
✓ should log on `ai-vector-store-populated` event (1 ms)
✓ should log on `ai-vector-store-updated` event
2025-04-15T08:24:19.1749813Z
PASS test/integration/users.api.test.ts (8.238 s)
GET /users
✓ should return all users (78 ms)
list query options
filter
✓ should filter users by field: email (24 ms)
✓ should filter users by field: firstName (16 ms)
✓ should filter users by field: lastName (16 ms)
✓ should filter users by computed field: isOwner (18 ms)
select
✓ should select user field: id (9 ms)
✓ should select user field: email (7 ms)
✓ should select user field: firstName (8 ms)
✓ should select user field: lastName (8 ms)
take
✓ should return n users or less, without skip (27 ms)
✓ should return n users or less, with skip (15 ms)
auxiliary fields
✓ should support options that require auxiliary fields (8 ms)
GET /users/:id/password-reset-link
✓ should allow owners to generate password reset links for admins and members (33 ms)
✓ should allow admins to generate password reset links for admins and members, but not owners (46 ms)
✓ should not allow members to generate password reset links for anyone (16 ms)
DELETE /users/:id
✓ should delete user and their resources (110 ms)
✓ should delete user and team relations and transfer their personal resources to user (137 ms)
✓ should delete user and transfer their personal resources to team project (70 ms)
✓ should fail to delete self (13 ms)
✓ should fail to delete the instance owner (15 ms)
✓ should fail to delete a user that does not exist (7 ms)
✓ should fail to transfer to a project that does not exist (15 ms)
✓ should fail to delete if user to delete is transferee (15 ms)
PATCH /users/:id/role
✓ should clear credential external secrets usability cache when changing a user's role (59 ms)
unauthenticated user
✓ should receive 401 (3 ms)
Invalid payload should return 400 when newRoleName
✓ is missing (6 ms)
✓ is `owner` (3 ms)
✓ is an array (4 ms)
member
✓ should fail to demote owner to member (5 ms)
✓ should fail to demote owner to admin (5 ms)
✓ should fail to demote admin to member (6 ms)
✓ should fail to promote other member to owner (7 ms)
✓ should fail to promote other member to admin (5 ms)
✓ should fail to promote self to admin (6 ms)
✓ should fail to promote self to owner (5 ms)
admin
✓ should receive 404 on unknown target user (6 ms)
✓ should fail to demote owner to admin (10 ms)
✓ should fail to demote owner to member (6 ms)
✓ should fail to promote member to admin if not licensed (11 ms)
✓ should be able to demote admin to member (25 ms)
✓ should be able to demote self to member (19 ms)
✓ should be able to promote member to admin if licensed (20 ms)
owner
✓ should fail to demote self to admin (6 ms)
✓ should fail to demote self to member (6 ms)
✓ should fail to promote member to admin if not licensed (4 ms)
✓ should be able to promote member to admin if licensed (18 ms)
✓ should be able to demote admin to member (21 ms)
2025-04-15T08:24:19.6569324Z
PASS src/execution-lifecycle/__tests__/execution-lifecycle-hooks.test.ts
Execution Lifecycle Hooks
getLifecycleHooksForRegularMain
✓ should setup the correct set of hooks (2 ms)
workflowExecuteBefore
✓ should emit workflow-pre-execute events (6 ms)
✓ should run workflow.preExecute hook (1 ms)
✓ should send executionStarted push event (1 ms)
✓ should run workflow.preExecute external hook (1 ms)
workflowExecuteAfter
✓ should emit workflow-post-execute events (2 ms)
✓ should not emit workflow-post-execute events for waiting executions (1 ms)
✓ should run workflow.postExecute hook (1 ms)
✓ should send executionFinished push event (1 ms)
✓ should send executionWaiting push event (1 ms)
✓ should restore binary data IDs after workflow execution for webhooks (1 ms)
saving static data
✓ should skip saving static data for manual executions (1 ms)
✓ should save static data for prod executions (2 ms)
✓ should handle static data saving errors (1 ms)
saving execution data
✓ should update execution with proper data (2 ms)
✓ should not delete unfinished executions (2 ms)
✓ should not delete waiting executions (1 ms)
✓ should soft delete manual executions when manual saving is disabled (9 ms)
✓ should not soft delete manual executions with waitTill (1 ms)
error workflow
✓ should not execute error workflow for manual executions (1 ms)
✓ should execute error workflow for failed non-manual executions (2 ms)
nodeExecuteBefore
✓ should emit node-pre-execute event
✓ should send nodeExecuteBefore push event (1 ms)
nodeExecuteAfter
✓ should emit node-post-execute event (1 ms)
✓ should send nodeExecuteAfter push event (3 ms)
✓ should save execution progress when enabled (1 ms)
✓ should not save execution progress when disabled (1 ms)
statistics events
✓ workflowExecuteAfter should emit workflowExecutionCompleted statistics event (1 ms)
✓ nodeFetchedData should handle nodeFetchedData statistics event
when pushRef isn't set
✓ should not setup any push hooks (2 ms)
getLifecycleHooksForScalingMain
✓ should setup the correct set of hooks (1 ms)
workflowExecuteBefore
✓ should emit workflow-pre-execute events
✓ should run workflow.preExecute hook
✓ should run the workflow.preExecute external hook
workflowExecuteAfter
✓ should emit workflow-post-execute events
✓ should not emit workflow-post-execute events for waiting executions (1 ms)
✓ should run workflow.postExecute hook
✓ should delete successful executions when success saving is disabled (1 ms)
✓ should delete failed executions when error saving is disabled (1 ms)
getLifecycleHooksForScalingWorker
✓ should setup the correct set of hooks (1 ms)
nodeExecuteBefore
✓ should emit node-pre-execute event (1 ms)
nodeExecuteAfter
✓ should emit node-post-execute event
workflowExecuteBefore
✓ should run workflow.preExecute hook (1 ms)
workflowExecuteAfter
✓ should run workflow.postExecute hook (1 ms)
statistics events
✓ workflowExecuteAfter should emit workflowExecutionCompleted statistics event (1 ms)
✓ nodeFetchedData should handle nodeFetchedData statistics event (1 ms)
saving static data
✓ should skip saving static data for manual executions (1 ms)
✓ should save static data for prod executions (1 ms)
✓ should handle static data saving errors (1 ms)
error workflow
✓ should not execute error workflow for manual executions (1 ms)
✓ should execute error workflow for failed non-manual executions (2 ms)
getLifecycleHooksForSubExecutions
✓ should setup the correct set of hooks (2 ms)
workflowExecuteBefore
✓ should emit workflow-pre-execute events (1 ms)
✓ should run workflow.preExecute hook (1 ms)
workflowExecuteAfter
✓ should emit workflow-post-execute events (1 ms)
✓ should not emit workflow-post-execute events for waiting executions (1 ms)
✓ should run workflow.postExecute hook (1 ms)
nodeExecuteBefore
✓ should emit node-pre-execute event (1 ms)
nodeExecuteAfter
✓ should emit node-post-execute event
statistics events
✓ workflowExecuteAfter should emit workflowExecutionCompleted statistics event (1 ms)
✓ nodeFetchedData should handle nodeFetchedData statistics event
2025-04-15T08:24:24.0408900Z
PASS src/scaling/__tests__/pubsub-handler.test.ts (5.61 s)
PubSubHandler
in webhook process
✓ should set up handlers in webhook process (9 ms)
✓ should reload license on `reload-license` event (8 ms)
✓ should restart event bus on `restart-event-bus` event (1 ms)
✓ should reload providers on `reload-external-secrets-providers` event (1 ms)
✓ should install community package on `community-package-install` event (1 ms)
✓ should update community package on `community-package-update` event (1 ms)
✓ should uninstall community package on `community-package-uninstall` event (1 ms)
in worker process
✓ should set up handlers in worker process (1 ms)
✓ should reload license on `reload-license` event (1 ms)
✓ should restart event bus on `restart-event-bus` event (1 ms)
✓ should reload providers on `reload-external-secrets-providers` event (1 ms)
✓ should install community package on `community-package-install` event (1 ms)
✓ should update community package on `community-package-update` event
✓ should uninstall community package on `community-package-uninstall` event (1 ms)
✓ should generate status on `get-worker-status` event (1 ms)
in main process
✓ should set up command and worker response handlers in main process (2 ms)
✓ should reload license on `reload-license` event
✓ should restart event bus on `restart-event-bus` event (1 ms)
✓ should reload providers on `reload-external-secrets-providers` event
✓ should install community package on `community-package-install` event
✓ should update community package on `community-package-update` event (1 ms)
✓ should uninstall community package on `community-package-uninstall` event
multi-main setup
✓ if leader, should handle `add-webhooks-triggers-and-pollers` event (4 ms)
✓ if follower, should skip `add-webhooks-triggers-and-pollers` event (11 ms)
✓ if leader, should handle `remove-triggers-and-pollers` event (18 ms)
✓ if follower, should skip `remove-triggers-and-pollers` event (14 ms)
✓ should handle `display-workflow-activation` event (3 ms)
✓ should handle `display-workflow-deactivation` event (4 ms)
✓ should handle `display-workflow-activation-error` event (1 ms)
✓ should handle `relay-execution-lifecycle-event` event (1 ms)
✓ should handle `clear-test-webhooks` event (8 ms)
✓ should handle `response-to-get-worker-status event (7 ms)
2025-04-15T08:24:25.5353328Z
PASS test/integration/execution.service.integration.test.ts (7.899 s)
ExecutionService
findRangeWithCount
✓ should return execution summaries (65 ms)
✓ should limit executions (60 ms)
✓ should retrieve executions before `lastId`, excluding it (38 ms)
✓ should retrieve executions after `firstId`, excluding it (22 ms)
✓ should filter executions by `status` (32 ms)
✓ should filter executions by `workflowId` (28 ms)
✓ should filter executions by `startedBefore` (24 ms)
✓ should filter executions by `startedAfter` (16 ms)
✓ should filter executions by `metadata` (16 ms)
✓ should filter executions by `projectId` (39 ms)
✓ should filter executions by `projectId` and expected `status` (31 ms)
✓ should filter executions by `projectId` and expected `waitTill` (28 ms)
✓ should filter executions by `projectId` and expected `metadata` (31 ms)
✓ should filter executions by `projectId` and expected `startedAfter` (27 ms)
✓ should filter executions by `projectId` and expected `startedBefore` (23 ms)
✓ should exclude executions by inaccessible `workflowId` (20 ms)
✓ should support advanced filters (16 ms)
findLatestCurrentAndCompleted
✓ should return latest current and completed executions (80 ms)
✓ should handle zero current executions (26 ms)
✓ should handle zero completed executions (28 ms)
✓ should handle zero executions (15 ms)
✓ should prioritize `running` over `new` executions (36 ms)
annotation
✓ should add and retrieve annotation (36 ms)
✓ should update annotation (23 ms)
✓ should filter by annotation tags (33 ms)
✓ should filter by annotation vote (28 ms)
2025-04-15T08:24:26.0882474Z
PASS src/sso.ee/saml/__tests__/saml-validator.test.ts
saml-validator
validateMetadata
✓ successfully validates metadata containing ws federation tags (169 ms)
✓ rejects invalid metadata (186 ms)
✓ rejects malformed XML metadata (178 ms)
✓ rejects metadata missing SingleSignOnService (198 ms)
✓ rejects metadata with invalid X.509 certificate (152 ms)
validateResponse
✓ successfully validates response (221 ms)
✓ rejects invalid response (148 ms)
✓ rejects expired SAML response (139 ms)
2025-04-15T08:24:28.4814486Z
PASS src/concurrency/__tests__/concurrency-control.service.test.ts
ConcurrencyControlService
constructor
✓ should be enabled if production cap is positive (8 ms)
✓ should be enabled if evaluation cap is positive (1 ms)
✓ should throw if production cap is 0 (2 ms)
✓ should throw if evaluation cap is 0 (1 ms)
✓ should be disabled if both production and evaluation caps are -1 (1 ms)
✓ should be disabled if production cap is lower than -1
✓ should be disabled if evaluation cap is lower than -1
✓ should be disabled on queue mode (1 ms)
if enabled
throttle
✓ should do nothing on cli mode (1 ms)
✓ should do nothing on error mode (1 ms)
✓ should do nothing on integrated mode
✓ should do nothing on internal mode
✓ should do nothing on manual mode (1 ms)
✓ should do nothing on retry mode (1 ms)
✓ should enqueue on webhook mode
✓ should enqueue on trigger mode
✓ should enqueue on evaluation mode (1 ms)
release
✓ should do nothing on cli mode (1 ms)
✓ should do nothing on error mode (1 ms)
✓ should do nothing on integrated mode
✓ should do nothing on internal mode (1 ms)
✓ should do nothing on manual mode (1 ms)
✓ should do nothing on retry mode
✓ should dequeue on webhook mode (1 ms)
✓ should dequeue on trigger mode
✓ should dequeue on evaluation mode (1 ms)
remove
✓ should do nothing on cli mode
✓ should do nothing on error mode (1 ms)
✓ should do nothing on integrated mode
✓ should do nothing on internal mode (1 ms)
✓ should do nothing on manual mode
✓ should do nothing on retry mode
✓ should remove an execution on webhook mode
✓ should remove an execution on trigger mode (1 ms)
✓ should remove an execution on evaluation mode (1 ms)
removeAll
✓ should remove all executions from the production queue (2 ms)
✓ should remove all executions from the evaluation queue (1 ms)
get queue
✓ should choose the production queue
✓ should choose the evaluation queue (1 ms)
if disabled
throttle
✓ should do nothing
✓ should do nothing for evaluation executions (1 ms)
release
✓ should do nothing
✓ should do nothing for evaluation executions (1 ms)
remove
✓ should do nothing
✓ should do nothing for evaluation executions
telemetry
on cloud
✓ for capacity 5, should report temp cloud threshold if reached (1 ms)
✓ for capacity 10, should report temp cloud threshold if reached (1 ms)
✓ for capacity 20, should report temp cloud threshold if reached
✓ for capacity 50, should report temp cloud threshold if reached (1 ms)
✓ for capacity 100, should report temp cloud threshold if reached
✓ for capacity 200, should report temp cloud threshold if reached (1 ms)
✓ for capacity 4, should not report temp cloud threshold if not reached
✓ for capacity 9, should not report temp cloud threshold if not reached (1 ms)
✓ for capacity 19, should not report temp cloud threshold if not reached
✓ for capacity 49, should not report temp cloud threshold if not reached (1 ms)
✓ for capacity 99, should not report temp cloud threshold if not reached
✓ for capacity 199, should not report temp cloud threshold if not reached (1 ms)
✓ for capacity 6, should not report temp cloud threshold if exceeded
✓ for capacity 11, should not report temp cloud threshold if exceeded (1 ms)
✓ for capacity 21, should not report temp cloud threshold if exceeded
✓ for capacity 51, should not report temp cloud threshold if exceeded
✓ for capacity 101, should not report temp cloud threshold if exceeded
✓ for capacity 201, should not report temp cloud threshold if exceeded
2025-04-15T08:24:32.4667480Z
PASS src/databases/repositories/__tests__/folder.repository.test.ts (6.134 s)
FolderRepository
getMany
filters
✓ should return all folders if not filter is provided (27 ms)
✓ should filter folders by IDs (25 ms)
✓ should filter folders by project ID (25 ms)
✓ should filter folders by name case-insensitively (16 ms)
✓ should filter folders by parent folder ID (25 ms)
✓ should filter folders by a single tag (22 ms)
✓ should filter folders by multiple tags (AND operator) (25 ms)
✓ should apply multiple filters together (22 ms)
select
✓ should select only id and name when specified (15 ms)
✓ should return id, name and tags when specified (14 ms)
✓ should return id, name and project when specified (12 ms)
✓ should return id, name and parentFolder when specified (15 ms)
✓ should return id, name and workflowCount when specified (17 ms)
✓ should return id, name and subFolderCount when specified (15 ms)
✓ should return timestamps when specified (12 ms)
✓ should return all properties when no select is specified (13 ms)
pagination
✓ should limit results when take is specified (43 ms)
✓ should skip results when skip is specified (19 ms)
✓ should handle skip and take together (17 ms)
✓ should handle take larger than remaining items (12 ms)
✓ should handle zero take by returning all results (12 ms)
sorting
✓ should sort by default (updatedAt:desc) (12 ms)
✓ should sort by name:asc (13 ms)
✓ should sort by name:desc (12 ms)
✓ should sort by name:desc when select does not include the name (14 ms)
✓ should sort by createdAt:asc (21 ms)
✓ should sort by createdAt:desc (16 ms)
✓ should sort by updatedAt:asc (14 ms)
✓ should sort by updatedAt:desc (17 ms)
✓ should default to asc if order not specified (10 ms)
2025-04-15T08:24:32.4863072Z
PASS test/integration/ldap/ldap.api.test.ts (8.577 s)
✓ Member role should not be able to access ldap routes (95 ms)
✓ GET /ldap/config route should retrieve current configuration (28 ms)
✓ GET /ldap/sync should return paginated synchronizations (27 ms)
PUT /ldap/config
✓ route should validate payload (52 ms)
✓ route should update model (23 ms)
✓ route should fail due to trying to enable LDAP login with SSO as current authentication method (15 ms)
✓ should apply "Convert all LDAP users to email users" strategy when LDAP login disabled (40 ms)
POST /ldap/test-connection
✓ route should success (21 ms)
✓ route should fail (14 ms)
POST /ldap/sync
dry mode
✓ should detect new user but not persist change in model (29 ms)
✓ should detect updated user but not persist change in model (32 ms)
✓ should detect disabled user but not persist change in model (29 ms)
live mode
✓ should detect new user and persist change in model (42 ms)
✓ should detect updated user and persist change in model (67 ms)
✓ should detect disabled user and persist change in model (46 ms)
✓ should remove user instance access once the user is disabled during synchronization (38 ms)
POST /login
✓ should allow new LDAP user to login and synchronize data (50 ms)
✓ should allow existing LDAP user to login and synchronize data (191 ms)
✓ should allow instance owner to sign in with email/password when LDAP is enabled (161 ms)
✓ should transform email user into LDAP user when match found (142 ms)
Instance owner should able to delete LDAP users
✓ don't transfer workflows (22 ms)
✓ transfer workflows and credentials (18 ms)
2025-04-15T08:24:34.4062530Z
PASS src/services/__tests__/community-packages.service.test.ts (5.099 s)
CommunityPackagesService
parseNpmPackageName()
✓ should fail with empty package name (43 ms)
✓ should fail with invalid package prefix name (1 ms)
✓ should parse valid package name (1 ms)
✓ should parse valid package name and version (1 ms)
✓ should parse valid package name, scope and version (1 ms)
executeCommand()
✓ should call command with valid options (2 ms)
✓ should make sure folder exists (1 ms)
✓ should try to create folder if it does not exist (12 ms)
✓ should throw especial error when package is not found (2 ms)
crossInformationPackage()
✓ should return same list if availableUpdates is undefined (2 ms)
✓ should correctly match update versions for packages (1 ms)
✓ should correctly match update versions for single package (1 ms)
matchMissingPackages()
✓ should not match failed packages that do not exist (1 ms)
✓ should match failed packages that should be present
✓ should match failed packages even if version is wrong
checkNpmPackageStatus()
✓ should call axios.post (1 ms)
✓ should not fail if request fails
✓ should warn if package is banned (1 ms)
hasPackageLoadedSuccessfully()
✓ should return true when failed package list does not exist
✓ should return true when package is not in the list of missing packages
✓ should return false when package is in the list of missing packages (1 ms)
removePackageFromMissingList()
✓ should do nothing if key does not exist
✓ should remove only correct package from list
✓ should not remove if package is not in the list (1 ms)
updateNpmModule
✓ should call `exec` with the correct command and registry (3 ms)
✓ should throw when not licensed (1 ms)
2025-04-15T08:24:39.7426045Z
PASS test/integration/public-api/executions.test.ts (8.597 s)
GET /executions/:id
✓ should fail due to missing API Key (43 ms)
✓ should fail due to invalid API Key (14 ms)
✓ owner should be able to get an execution owned by him (201 ms)
✓ owner should be able to read executions of other users (32 ms)
✓ member should be able to fetch his own executions (29 ms)
✓ member should not be able to fetch custom data when includeData is not set (28 ms)
✓ member should be able to fetch custom data when includeData=true (66 ms)
✓ member should not get an execution of another user without the workflow being shared (28 ms)
✓ member should be able to fetch executions of workflows shared with him (36 ms)
DELETE /executions/:id
✓ should fail due to missing API Key (11 ms)
✓ should fail due to invalid API Key (10 ms)
✓ should delete an execution (58 ms)
GET /executions
✓ should fail due to missing API Key (11 ms)
✓ should fail due to invalid API Key (9 ms)
✓ should retrieve all successful executions (43 ms)
✓ should paginate two executions (55 ms)
✓ should retrieve all error executions (35 ms)
✓ should return all waiting executions (52 ms)
✓ should retrieve all executions of specific workflow (53 ms)
✓ should return executions filtered by project ID (46 ms)
✓ owner should retrieve all executions regardless of ownership (84 ms)
✓ member should not see executions of workflows not shared with him (74 ms)
✓ member should also see executions of workflows shared with him (78 ms)
2025-04-15T08:24:41.3165863Z
PASS test/integration/evaluation/test-definitions.api.test.ts (8.642 s)
GET /evaluation/test-definitions
✓ should retrieve empty test definitions list (83 ms)
✓ should retrieve test definitions list (44 ms)
✓ should retrieve test definitions list with pagination (61 ms)
✓ should retrieve test definitions list for a workflow (56 ms)
✓ should return error if user has no access to the workflowId specified in filter (58 ms)
GET /evaluation/test-definitions/:id
✓ should retrieve test definition (38 ms)
✓ should return 404 for non-existent test definition (27 ms)
✓ should retrieve test definition with evaluation workflow (40 ms)
✓ should not retrieve test definition if user does not have access to workflow under test (38 ms)
POST /evaluation/test-definitions
✓ should create test definition (38 ms)
✓ should create test definition with evaluation workflow (36 ms)
✓ should create test definition with all fields (34 ms)
✓ should return error if name is empty (37 ms)
✓ should return error if user has no access to the workflow (31 ms)
✓ should return error if user has no access to the evaluation workflow (36 ms)
PATCH /evaluation/test-definitions/:id
✓ should update test definition (46 ms)
✓ should return 404 if user has no access to the workflow (33 ms)
✓ should update test definition with evaluation workflow (46 ms)
✓ should return error if user has no access to the evaluation workflow (50 ms)
✓ should disallow workflowId (32 ms)
✓ should update annotationTagId (49 ms)
✓ should return error if annotationTagId is invalid (61 ms)
✓ should update pinned nodes (60 ms)
✓ should return error if pinned nodes are invalid (61 ms)
✓ should return error if pinned nodes are not in the workflow (30 ms)
DELETE /evaluation/test-definitions/:id
✓ should delete test definition (43 ms)
✓ should return 404 if test definition does not exist (38 ms)
✓ should return 404 if user has no access to the workflow (39 ms)
POST /evaluation/test-definitions/:id/run
✓ should trigger the test run (34 ms)
2025-04-15T08:24:41.3412852Z
PASS src/auth/__tests__/auth.service.test.ts
AuthService
createJWTHash
✓ should generate unique hashes (6 ms)
authMiddleware
✓ should 401 if no cookie is set (1 ms)
✓ should 401 and clear the cookie if the JWT is expired (4 ms)
✓ should 401 and clear the cookie if the JWT has been invalidated (2 ms)
✓ should refresh the cookie before it expires (3 ms)
issueCookie
✓ should issue a cookie with the correct options (2 ms)
✓ should allow changing cookie options (1 ms)
issueJWT
when not setting userManagement.jwtSessionDuration
✓ should default to expire in 7 days (2 ms)
when setting userManagement.jwtSessionDuration
✓ should apply it to tokens (2 ms)
resolveJwt
✓ should throw on invalid tokens (35 ms)
✓ should throw on expired tokens (3 ms)
✓ should throw on tampered tokens (2 ms)
✓ should throw on hijacked tokens (2 ms)
✓ should throw if no user is found (2 ms)
✓ should throw if the user is disabled (2 ms)
✓ should throw if user password does not match the one on the token (2 ms)
✓ should throw if user email does not match the one on the token (1 ms)
✓ should refresh the cookie before it expires (4 ms)
✓ should refresh the cookie only if less than 1/4th of time is left (3 ms)
✓ should not refresh the cookie if jwtRefreshTimeoutHours is set to -1 (2 ms)
generatePasswordResetUrl
✓ should generate a valid url (2 ms)
generatePasswordResetToken
✓ should generate valid password-reset tokens (1 ms)
resolvePasswordResetToken
✓ should not return a user if the token in invalid (1 ms)
✓ should not return a user if the token in expired (2 ms)
✓ should not return a user if the user does not exist in the DB (2 ms)
✓ should not return a user if the password sha does not match (2 ms)
✓ should not return the user if all checks pass (3 ms)
invalidateToken
✓ should invalidate the token (1 ms)
2025-04-15T08:24:44.9127367Z
PASS test/integration/deduplication/deduplication-helper.test.ts (5.518 s)
Deduplication.DeduplicationHelper
✓ Deduplication (mode: entries): DeduplicationHelper should record and check data correctly (25 ms)
✓ Deduplication (mode: entries): DeduplicationHelper different contexts should not interfere with each other (15 ms)
✓ Deduplication (mode: entries): DeduplicationHelper check maxEntries (11 ms)
✓ removeProcessed should throw error for latest modes (28 ms)
✓ clearAllProcessedItems should delete all processed items for workflow scope (5 ms)
✓ clearAllProcessedItems should delete all processed items for node scope (4 ms)
✓ clearAllProcessedItems should not clear workflow processed items when clearing node scope (7 ms)
✓ clearAllProcessedItems should not clear node processed items when clearing workflow scope (8 ms)
✓ getProcessedDataCount should return correct count for different modes (4 ms)
Deduplication (mode: latestIncrementalKey): DeduplicationHelper should record and check data correctly
✓ dates (35 ms)
✓ numbers (8 ms)
2025-04-15T08:24:45.5713204Z
PASS test/integration/controllers/invitation/invitation.controller.integration.test.ts (7.775 s)
InvitationController
POST /invitations/:id/accept
✓ should fill out a member shell (208 ms)
✓ should fill out an admin shell (110 ms)
✓ should fail with invalid payloads (33 ms)
✓ should fail with already accepted invite (124 ms)
POST /invitations
✓ should fail with invalid payloads (55 ms)
✓ should return 200 on empty payload (13 ms)
✓ should return 200 if emailing is not set up (17 ms)
✓ should create member shell (16 ms)
✓ should create personal project for shell account (23 ms)
✓ should create admin shell when advanced permissions is licensed (16 ms)
✓ should reinvite member when sharing is licensed (29 ms)
✓ should reinvite admin when advanced permissions is licensed (27 ms)
✓ should return 403 on creating admin shell when advanced permissions is unlicensed (9 ms)
✓ should email invites and create user shells, without inviting existing users (35 ms)
✓ should return 200 and surface error when invite method throws error (23 ms)
2025-04-15T08:24:49.3556499Z
PASS src/controllers/oauth/__tests__/oauth2-credential.controller.test.ts (5.479 s)
OAuth2CredentialController
getAuthUri
✓ should throw a BadRequestError when credentialId is missing in the query (41 ms)
✓ should throw a NotFoundError when no matching credential is found for the user (2 ms)
✓ should return a valid auth URI (9 ms)
handleCallback
✓ should render the error page when required query params are missing (2 ms)
✓ should render the error page when `state` query param is invalid (1 ms)
✓ should render the error page when credential is not found in DB (1 ms)
✓ should render the error page when csrfSecret on the saved credential does not match the state (2 ms)
✓ should render the error page when state is older than 5 minutes (2 ms)
✓ should render the error page when code exchange fails (92 ms)
✓ should exchange the code for a valid token, and save it to DB (26 ms)
✓ merges oauthTokenData if it already exists (25 ms)
✓ overwrites oauthTokenData if it is a string (25 ms)
2025-04-15T08:24:50.6465496Z
PASS src/__tests__/load-nodes-and-credentials.test.ts
LoadNodesAndCredentials
resolveIcon
✓ should return undefined if the loader for the package is not found (9 ms)
✓ should return undefined if the resolved file path is outside the loader directory (4 ms)
✓ should return the file path if the file is within the loader directory (1 ms)
✓ should return undefined if the URL is outside the package directory (1 ms)
convertNodeToAiTool
✓ should modify the name and displayName correctly
✓ should update inputs and outputs (2 ms)
✓ should remove the usableAsTool property
✓ should add toolDescription property if it doesn't exist (1 ms)
✓ should set codex categories correctly (1 ms)
✓ should preserve existing properties
✓ should handle nodes with resource property (1 ms)
✓ should handle nodes with operation property (1 ms)
✓ should handle nodes with both resource and operation properties (1 ms)
✓ should handle nodes with empty properties (2 ms)
✓ should handle nodes with existing codex property (1 ms)
✓ should handle nodes with existing codex with tool subcategory overwrite
✓ should handle nodes with very long names (1 ms)
✓ should handle nodes with special characters in name and displayName
resolveSchema
✓ should return undefined if the node is not known (1 ms)
✓ should return the correct path if the node is known (1 ms)
✓ should return the correct path if there is no resource or operation (1 ms)
createAiTools
✓ should create AI tools for nodes marked as usableAsTool (2 ms)
✓ should duplicate supportedNodes for AI tools (1 ms)
✓ should not modify nodes without usableAsTool property
✓ should handle nodes with usableAsTool as an object with replacements (1 ms)
2025-04-15T08:24:52.2357737Z
PASS test/integration/variables.test.ts (7.403 s)
GET /variables
✓ should return an empty array if there is nothing in the cache (58 ms)
✓ should return all variables for an owner (20 ms)
✓ should return all variables for a member (18 ms)
state:empty
✓ only return empty variables (13 ms)
GET /variables/:id
✓ should return a single variable for an owner (15 ms)
✓ should return a single variable for a member (12 ms)
POST /variables
✓ should create a new variable and return it for an owner (10 ms)
✓ should not create a new variable and return it for a member (8 ms)
✓ should not create a new variable and return it if the instance doesn't have a license (6 ms)
✓ should fail to create a new variable and if one with the same key exists (77 ms)
✓ should not fail if variable limit not reached (16 ms)
✓ should fail if variable limit reached (36 ms)
✓ should fail if key too long (9 ms)
✓ should fail if value too long (7 ms)
✓ should fail if key contain's prohibited characters (8 ms)
PATCH /variables/:id
✓ should modify existing variable if use is an owner (15 ms)
✓ should modify existing variable if use is an owner (12 ms)
✓ should not modify existing variable if use is a member (11 ms)
✓ should not modify existing variable if one with the same key exists (16 ms)
DELETE /variables/:id
✓ should delete a single variable for an owner (15 ms)
✓ should not delete a single variable for a member (14 ms)
2025-04-15T08:24:53.1525542Z
PASS src/workflows/__tests__/workflow-execution.service.test.ts
WorkflowExecutionService
runWorkflow()
✓ should call `WorkflowRunner.run()` (5 ms)
executeManually()
✓ should call `WorkflowRunner.run()` with correct parameters with default partial execution logic (2 ms)
✓ removes runData if the destination node is a trigger (8 ms)
✓ should call WorkflowRunner.run() with pinned trigger with type trigger (1 ms)
✓ should call WorkflowRunner.run() with pinned trigger with type webhook (2 ms)
✓ should start from pinned trigger (1 ms)
✓ should ignore pinned trigger and start from unexecuted trigger (1 ms)
selectPinnedActivatorStarter()
✓ should return `null` if no pindata
✓ should return `null` if no starter nodes (1 ms)
✓ should select webhook node if only choice
✓ should return `null` if no choice
✓ should return ignore Respond to Webhook (1 ms)
✓ should select execute workflow trigger if only choice
✓ should favor webhook node over execute workflow trigger (1 ms)
✓ should favor first webhook node over second webhook node
offloading manual executions to workers
✓ when receiving no `runData`, should set `runData` to undefined in `executionData`
2025-04-15T08:24:56.8563904Z
PASS src/controllers/__tests__/me.controller.test.ts
MeController
updateCurrentUser
✓ should update the user in the DB, and issue a new cookie (16 ms)
✓ should throw BadRequestError if beforeUpdate hook throws BadRequestError (35 ms)
when mfa is enabled
✓ should throw BadRequestError if mfa code is missing (2 ms)
✓ should throw InvalidMfaCodeError if mfa code is invalid (1 ms)
✓ should update the user's email if mfa code is valid (2 ms)
updatePassword
✓ should throw if the user does not have a password set (2 ms)
✓ should throw if currentPassword does not match the user's password (113 ms)
✓ should update the password in the DB, and issue a new cookie (188 ms)
should throw if newPassword is not valid
✓ pass (92 ms)
✓ password (94 ms)
✓ password1 (96 ms)
mfa enabled
✓ should throw BadRequestError if mfa code is missing (133 ms)
✓ should throw InvalidMfaCodeError if invalid mfa code is given (101 ms)
✓ should succeed when mfa code is correct (179 ms)
storeSurveyAnswers
✓ should throw BadRequestError if answers are missing in the payload (1 ms)
✓ should not flag XSS attempt for `<` sign in company size (9 ms)
✓ should throw BadRequestError on XSS attempt for an array field automationGoalDevops (3 ms)
✓ should throw BadRequestError on XSS attempt for an array field companyIndustryExtended (2 ms)
✓ should throw BadRequestError on XSS attempt for an array field otherCompanyIndustryExtended (1 ms)
✓ should throw BadRequestError on XSS attempt for an array field automationGoalSm (1 ms)
✓ should throw BadRequestError on XSS attempt for an array field usageModes (1 ms)
✓ should throw BadRequestError on XSS attempt for a string field automationGoalDevopsOther (1 ms)
✓ should throw BadRequestError on XSS attempt for a string field companySize (1 ms)
✓ should throw BadRequestError on XSS attempt for a string field companyType (2 ms)
✓ should throw BadRequestError on XSS attempt for a string field automationGoalSmOther (1 ms)
✓ should throw BadRequestError on XSS attempt for a string field roleOther (1 ms)
✓ should throw BadRequestError on XSS attempt for a string field reportedSource (1 ms)
✓ should throw BadRequestError on XSS attempt for a string field reportedSourceOther (10 ms)
2025-04-15T08:24:58.2502106Z
PASS test/integration/mfa/mfa.api.test.ts (8.229 s)
Enable MFA setup
Step one
✓ GET /qr should fail due to unauthenticated user (65 ms)
✓ GET /qr should reuse secret and recovery codes until setup is complete (85 ms)
✓ GET /qr should return qr, secret and recovery codes (27 ms)
Step two
✓ POST /verify should fail due to unauthenticated user (22 ms)
✓ POST /verify should fail due to invalid MFA code (39 ms)
✓ POST /verify should fail due to missing mfaCode parameter (27 ms)
✓ POST /verify should validate MFA code (33 ms)
Step three
✓ POST /enable should fail due to unauthenticated user (10 ms)
✓ POST /verify should fail due to missing mfaCode parameter (16 ms)
✓ POST /enable should fail due to invalid MFA code (36 ms)
✓ POST /enable should fail due to empty secret and recovery codes (14 ms)
✓ POST /enable should enable MFA in account (43 ms)
✓ POST /enable should not enable MFA if pre check fails (40 ms)
Disable MFA setup
✓ POST /disable should disable login with MFA (42 ms)
✓ POST /disable should fail if invalid MFA recovery code is given (26 ms)
✓ POST /disable should fail if invalid MFA code is given (28 ms)
✓ POST /disable should fail if neither MFA code nor recovery code is sent (30 ms)
Change password with MFA enabled
✓ POST /change-password should fail due to missing MFA code (26 ms)
✓ POST /change-password should fail due to invalid MFA code (25 ms)
✓ POST /change-password should update password (227 ms)
MFA before enable checks
✓ POST /can-enable should throw error if mfa.beforeSetup returns error (11 ms)
✓ POST /can-enable should not throw error if mfa.beforeSetup does not exist (13 ms)
Login
✓ POST /login with email/password should succeed when mfa is disabled (21 ms)
✓ GET /login should not include mfaSecret and mfaRecoveryCodes property in response (11 ms)
✓ POST /login with email/password should fail when mfa is enabled (24 ms)
Login with MFA token
✓ POST /login should fail due to invalid MFA token (23 ms)
✓ POST /login should fail due two MFA step needed (21 ms)
✓ POST /login should succeed with MFA token (23 ms)
Login with recovery code
✓ POST /login should fail due to invalid MFA recovery code (26 ms)
✓ POST /login should succeed with MFA recovery code (31 ms)
2025-04-15T08:24:59.1137787Z
PASS src/__tests__/manual-execution.service.test.ts
ManualExecutionService
getExecutionStartNode
✓ Should return undefined (5 ms)
✓ Should return startNode (1 ms)
✓ Should return triggerToStartFrom trigger node
runManually
✓ should correctly process triggerToStartFrom data when data.triggerToStartFrom.data is present (5 ms)
✓ should correctly include destinationNode in executionData when provided (1 ms)
✓ should call workflowExecute.run for full execution when no runData or startNodes (1 ms)
✓ should use execution start node when available for full execution (2 ms)
✓ should handle partial execution with provided runData, startNodes and no destinationNode (1 ms)
✓ should handle partial execution with partialExecutionVersion=2 (2 ms)
✓ should validate nodes exist before execution (1 ms)
✓ should handle pinData correctly when provided (2 ms)
2025-04-15T08:25:00.1205408Z
PASS src/webhooks/__tests__/webhook-helpers.test.ts
autoDetectResponseMode
✓ should return undefined if start node is WAIT_NODE_TYPE with resume not equal to form (7 ms)
✓ should return responseNode when start node is FORM_NODE_TYPE and method is POST (2 ms)
✓ should return undefined when start node is FORM_NODE_TYPE with no other form child nodes (1 ms)
✓ should return undefined for non-matching node type and method (1 ms)
handleFormRedirectionCase
✓ should return data unchanged if start node is WAIT_NODE_TYPE with resume not equal to form (1 ms)
✓ should modify data if start node type matches and responseCode is a redirect (1 ms)
✓ should not modify data if location header is missing (1 ms)
getResponseOnReceived
✓ should return response with no data when responseData is "noData" (1 ms)
✓ should return response with responseData when it is defined (4 ms)
✓ should return response with webhookResponse when responseData is falsy but webhookResponse exists (1 ms)
✓ should return default response message when responseData and webhookResponse are falsy (1 ms)
setupResponseNodePromise
✓ should handle regular response object (12 ms)
✓ should handle binary data with ID (6 ms)
✓ should handle buffer response (2 ms)
✓ should handle errors properly (8 ms)
prepareExecutionData
✓ should create new execution data when not provided (8 ms)
✓ should update existing runExecutionData when executionId is defined (1 ms)
✓ should set destination node when provided (1 ms)
✓ should update execution data with execution data merge
✓ should set pinData when execution mode is manual (7 ms)
✓ should not set pinData when execution mode is not manual or evaluation (1 ms)
2025-04-15T08:25:04.0762159Z
PASS test/integration/me.api.test.ts (8.008 s)
Owner shell
✓ PATCH /me should succeed with valid inputs (110 ms)
✓ PATCH /me should fail with invalid inputs (110 ms)
✓ PATCH /me/password should fail for shell (151 ms)
✓ POST /me/survey should succeed with valid inputs (47 ms)
Member
✓ PATCH /me should succeed with valid inputs (61 ms)
✓ PATCH /me should fail with invalid inputs (104 ms)
✓ PATCH /me/password should succeed with valid inputs (163 ms)
✓ PATCH /me/password should fail with invalid inputs (92 ms)
✓ POST /me/survey should succeed with valid inputs (56 ms)
Owner
✓ PATCH /me should succeed with valid inputs (38 ms)
2025-04-15T08:25:06.4914693Z
(node:2876) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 uncaughtException listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
PASS test/integration/commands/ldap/reset.test.ts (8.312 s)
✓ fails if neither `--userId` nor `--projectId` nor `--deleteWorkflowsAndCredentials` is passed (49 ms)
✓ fails if more than one of `--userId`, `--projectId`, `--deleteWorkflowsAndCredentials` are passed (6 ms)
✓ fails if more than one of `--userId`, `--projectId`, `--deleteWorkflowsAndCredentials` are passed (4 ms)
✓ fails if more than one of `--userId`, `--projectId`, `--deleteWorkflowsAndCredentials` are passed (5 ms)
✓ fails if more than one of `--userId`, `--projectId`, `--deleteWorkflowsAndCredentials` are passed (4 ms)
--deleteWorkflowsAndCredentials
✓ deletes personal projects, workflows and credentials owned by LDAP managed users (136 ms)
✓ deletes the LDAP sync history (19 ms)
✓ resets LDAP settings (20 ms)
--userId
✓ fails if the user does not exist (9 ms)
✓ fails if the user to migrate to is also an LDAP user (17 ms)
✓ transfers all workflows and credentials to the user's personal project (89 ms)
--projectId
✓ fails if the project does not exist (7 ms)
✓ fails if the user to migrate to is also an LDAP user (14 ms)
✓ transfers all workflows and credentials to a personal project (72 ms)
✓ transfers all workflows and credentials to a team project (82 ms)
2025-04-15T08:25:08.6672603Z
PASS src/webhooks/__tests__/webhook.service.test.ts
WebhookService
findWebhook() - static case [cache enabled]
✓ should return the webhook if found (6 ms)
✓ should return null if not found (1 ms)
findWebhook() - dynamic case [cache enabled]
✓ should return the webhook if found (2 ms)
✓ should handle subset dynamic path case (1 ms)
✓ should handle single-segment dynamic path case (1 ms)
✓ should return null if not found (1 ms)
findWebhook() - static case [cache disabled]
✓ should return the webhook if found (1 ms)
✓ should return null if not found (1 ms)
findWebhook() - dynamic case [cache disabled]
✓ should return the webhook if found (1 ms)
✓ should handle subset dynamic path case (1 ms)
✓ should handle single-segment dynamic path case (1 ms)
✓ should return null if not found (1 ms)
getWebhookMethods()
✓ should return all methods for webhook (1 ms)
✓ should return empty array if no webhooks found (1 ms)
deleteWorkflowWebhooks()
✓ should delete all webhooks of the workflow (1 ms)
✓ should not delete any webhooks if none found (1 ms)
createWebhook()
✓ should store webhook in DB (1 ms)
getNodeWebhooks()
✓ should return empty array if node is disabled (1 ms)
✓ should return webhooks for node with webhook definitions (2 ms)
createWebhookIfNotExists()
✓ should create webhook if it does not exist (2 ms)
✓ should not create webhook if it already exists (1 ms)
✓ should handle case when webhook methods are not defined
deleteWebhook()
✓ should call runWebhookMethod with delete (1 ms)
runWebhook()
✓ should throw error if node does not have webhooks (25 ms)
✓ should execute webhook and return response data (2 ms)
2025-04-15T08:25:11.7337659Z
PASS test/integration/auth.api.test.ts (7.51 s)
POST /login
✓ should log user in (84 ms)
✓ should log user with MFA enabled (42 ms)
✓ should throw AuthError for non-owner if not within users limit quota (64 ms)
✓ should not throw AuthError for owner if not within users limit quota (29 ms)
✓ should fail with invalid email in the payload is the current authentication method is "email" (17 ms)
GET /login
✓ should return 401 Unauthorized if no cookie (9 ms)
✓ should return 401 Unauthorized if invalid cookie (6 ms)
✓ should return logged-in owner shell (14 ms)
✓ should return logged-in member shell (18 ms)
✓ should return logged-in owner (21 ms)
✓ should return logged-in member (26 ms)
GET /resolve-signup-token
✓ should validate invite token (27 ms)
✓ should return 403 if user quota reached (21 ms)
✓ should fail with invalid inputs (48 ms)
POST /logout
✓ should log user out (27 ms)
2025-04-15T08:25:11.7921031Z
PASS test/integration/environments/source-control-import.service.test.ts (6.701 s)
SourceControlImportService
importCredentialsFromWorkFolder()
if user email specified by `ownedBy` exists at target instance
✓ should assign credential ownership to original user (66 ms)
if user email specified by `ownedBy` is `null`
✓ should assign credential ownership to importing user (25 ms)
if user email specified by `ownedBy` does not exist at target instance
✓ should assign credential ownership to importing user (15 ms)
if owner specified by `ownedBy` does not exist at target instance
✓ should assign the credential ownership to the importing user if it was owned by a personal project in the source instance (15 ms)
✓ should create a new team project if the credential was owned by a team project in the source instance (21 ms)
if owner specified by `ownedBy` does exist at target instance
✓ should use the existing team project if credential owning project is found (15 ms)
✓ should not change the owner if the credential is owned by somebody else on the target instance (22 ms)
2025-04-15T08:25:13.4496638Z
PASS src/executions/pre-execution-checks/__tests__/subworkflow-policy-checker.test.ts
SubworkflowPolicyChecker
no caller policy
✓ should fall back to `N8N_WORKFLOW_CALLER_POLICY_DEFAULT_OPTION` (18 ms)
`workflows-from-list` caller policy
✓ should allow if caller list contains parent workflow ID (2 ms)
✓ should deny if caller list does not contain parent workflow ID (8 ms)
`any` caller policy
✓ should not throw on a regular subworkflow call (1 ms)
`workflows-from-same-owner` caller policy
✓ should deny if the two workflows are owned by different projects (2 ms)
✓ should allow if both workflows are owned by the same project (1 ms)
error details
✓ should contain description for accessible case (1 ms)
✓ should contain description for inaccessible personal project case (1 ms)
✓ should contain description for inaccessible team project case (1 ms)
✓ should contain description for default (e.g. error workflow) case (1 ms)
2025-04-15T08:25:15.0265471Z
PASS src/__tests__/active-executions.test.ts
ActiveExecutions
✓ Should initialize activeExecutions with empty list (7 ms)
✓ Should add execution to active execution list (11 ms)
✓ Should update execution if add is called with execution ID (2 ms)
✓ Should attach and resolve response promise to existing execution (2 ms)
✓ Should copy over startedAt and responsePromise when resuming a waiting execution (2 ms)
attachWorkflowExecution
✓ Should fail attaching execution to invalid executionId (28 ms)
✓ Should successfully attach execution to valid executionId (1 ms)
finalizeExecution
✓ Should not remove a waiting execution (2 ms)
✓ Should remove an existing execution (2 ms)
✓ Should not try to resolve a post-execute promise for an inactive execution (1 ms)
✓ Should resolve post execute promise on removal (5 ms)
getPostExecutePromise
✓ Should throw error when trying to create a promise with invalid execution (1 ms)
stopExecution
✓ Should cancel ongoing executions (6 ms)
✓ Should cancel waiting executions (1 ms)
shutdown
✓ Should cancel only executions with response-promises by default (8 ms)
✓ Should cancel all executions when cancelAll is true (5 ms)
2025-04-15T08:25:17.4717568Z
PASS test/integration/public-api/credentials.test.ts (8.303 s)
POST /credentials
✓ should create credentials (247 ms)
✓ should fail with invalid inputs (47 ms)
DELETE /credentials/:id
✓ should delete owned cred for owner (28 ms)
✓ should delete non-owned cred for owner (18 ms)
✓ should delete owned cred for member (25 ms)
✓ should delete owned cred for member but leave others untouched (57 ms)
✓ should not delete non-owned cred for member (16 ms)
✓ should fail if cred not found (9 ms)
GET /credentials/schema/:credentialType
✓ should fail due to not found type (17 ms)
✓ should retrieve credential type (10 ms)
PUT /credentials/:id/transfer
✓ should transfer credential to project (54 ms)
✓ should transfer the right credential, not the first one it finds (35 ms)
✓ if no destination project, should reject (15 ms)
2025-04-15T08:25:20.2976102Z
PASS test/integration/eventbus.ee.test.ts (7.614 s)
✓ should have a running logwriter process (5 ms)
✓ should have logwriter log messages (33 ms)
✓ should anonymize audit message to syslog  (10 ms)
✓ should send message to webhook  (6 ms)
✓ should send message to sentry  (7 ms)
✓ DELETE /eventbus/destination delete all destinations by id (20 ms)
GET /eventbus/destination
✓ should fail due to missing authentication (23 ms)
✓ all returned destinations should exist in eventbus (13 ms)
POST /eventbus/destination
✓ create syslog destination (9 ms)
✓ create sentry destination (7 ms)
✓ create webhook destination (8 ms)
2025-04-15T08:25:22.9007770Z
PASS src/telemetry/__tests__/telemetry.test.ts
Telemetry
trackWorkflowExecution
✓ should count executions correctly (9 ms)
✓ should fire "Workflow execution errored" event for failed executions (14 ms)
✓ should track production executions count correctly (8 ms)
Rudderstack
✓ should call rudderStack.identify() with a fake IP address to instruct Rudderstack to not use the user's IP address (2 ms)
✓ should call rudderStack.track() with a fake IP address to instruct Rudderstack to not use the user's IP address (4 ms)
2025-04-15T08:25:24.0436590Z
PASS test/integration/external-secrets/external-secrets.api.test.ts (7.751 s)
GET /external-secrets/providers
✓ can retrieve providers as owner (47 ms)
✓ can not retrieve providers as non-owner (11 ms)
✓ does obscure passwords (12 ms)
GET /external-secrets/providers/:provider
✓ can retrieve provider as owner (11 ms)
✓ can not retrieve provider as non-owner (10 ms)
✓ does obscure passwords (11 ms)
POST /external-secrets/providers/:provider
✓ can update provider settings (18 ms)
✓ can update provider settings with blanking value (20 ms)
POST /external-secrets/providers/:provider/connect
✓ can change provider connected state (17 ms)
POST /external-secrets/providers/:provider/test
✓ can test provider (8 ms)
✓ can test provider fail (9 ms)
POST /external-secrets/providers/:provider/update
✓ can update provider (9 ms)
✓ can not update errored provider (21 ms)
✓ can not update provider without a valid license (9 ms)
GET /external-secrets/secrets
✓ can get secret names as owner (9 ms)
✓ can not get secret names as non-owner (9 ms)
2025-04-15T08:25:25.4688686Z
PASS test/integration/active-workflow-manager.test.ts (7.436 s)
init()
✓ should load workflows into memory (112 ms)
✓ should call external hook (18 ms)
✓ should check that workflow can be activated (33 ms)
isActive()
✓ should return `true` for active workflow in storage (22 ms)
✓ should return `false` for inactive workflow in storage (14 ms)
add()
✓ should count workflow triggers correctly when node has multiple webhooks (15 ms)
in single-main mode
✓ should add webhooks, triggers and pollers for workflow in 'activate' activation mode (19 ms)
✓ should add webhooks, triggers and pollers for workflow in 'update' activation mode (20 ms)
removeAll()
✓ should remove all active workflows from memory (30 ms)
remove()
in single-main mode
✓ should remove all webhooks of a workflow from database (21 ms)
✓ should remove all webhooks of a workflow from external service (16 ms)
✓ should stop running triggers and pollers (16 ms)
executeErrorWorkflow()
✓ should be called on failure to activate due to 401 (21 ms)
addWebhooks()
✓ should call `WebhookService.storeWebhook()` (23 ms)
2025-04-15T08:25:30.5900625Z
PASS test/integration/evaluation/test-runs.api.test.ts (7.878 s)
GET /evaluation/test-definitions/:testDefinitionId/runs
✓ should retrieve empty list of runs for a test definition (65 ms)
✓ should return 404 if test definition does not exist (52 ms)
✓ should return 404 if user does not have access to test definition (31 ms)
✓ should retrieve list of runs for a test definition (36 ms)
✓ should retrieve list of runs for a test definition with pagination (51 ms)
GET /evaluation/test-definitions/:testDefinitionId/runs/:id
✓ should retrieve test run for a test definition (32 ms)
✓ should return 404 if test run does not exist (27 ms)
✓ should return 404 if user does not have access to test definition (34 ms)
✓ should retrieve test run for a test definition of a shared workflow (68 ms)
DELETE /evaluation/test-definitions/:testDefinitionId/runs/:id
✓ should delete test run for a test definition (33 ms)
✓ should return 404 if test run does not exist (29 ms)
✓ should return 404 if user does not have access to test definition (25 ms)
POST /evaluation/test-definitions/:testDefinitionId/runs/:id/cancel
✓ should cancel test run (40 ms)
✓ should return 404 if test run does not exist (33 ms)
✓ should return 404 if test definition does not exist (31 ms)
✓ should return 404 if user does not have access to test definition (32 ms)
2025-04-15T08:25:32.1615171Z
PASS test/integration/prometheus-metrics.test.ts (7.341 s)
PrometheusMetricsService
✓ should return n8n version (32 ms)
✓ should return default metrics if enabled (14 ms)
✓ should not return default metrics if disabled (4 ms)
✓ should return cache metrics if enabled (4 ms)
✓ should not return cache metrics if disabled (4 ms)
✓ should return route metrics if enabled (15 ms)
✓ should include last activity metric with route metrics (30 ms)
✓ should return labels in route metrics if enabled (8 ms)
✓ should return queue metrics if enabled (4 ms)
✓ should set queue metrics in response to `job-counts-updated` event (3 ms)
✓ should return active workflow count (20 ms)
2025-04-15T08:25:33.0759871Z
PASS src/commands/__tests__/community-node.test.ts (5.631 s)
uninstallCredential
✓ should delete a credential (10 ms)
✓ should return if the user is not found (1 ms)
✓ should return if the credential is not found (2 ms)
✓ should delete multiple credentials (2 ms)
uninstallPackage
✓ should uninstall the package (3 ms)
✓ should uninstall all nodes from a package (2 ms)
✓ should return if a package is not found (1 ms)
✓ should return if nodes are not found (1 ms)
2025-04-15T08:25:38.0243991Z
PASS test/integration/public-api/projects.test.ts (8.218 s)
Projects in Public API
GET /projects
✓ if licensed, should return all projects with pagination (215 ms)
✓ if not authenticated, should reject (12 ms)
✓ if not licensed, should reject (21 ms)
✓ if missing scope, should reject (20 ms)
POST /projects
✓ if licensed, should create a new project (29 ms)
✓ if not authenticated, should reject (6 ms)
✓ if not licensed, should reject (17 ms)
✓ if missing scope, should reject (18 ms)
DELETE /projects/:id
✓ if licensed, should delete a project (82 ms)
✓ if not authenticated, should reject (8 ms)
✓ if not licensed, should reject (18 ms)
✓ if missing scope, should reject (18 ms)
PUT /projects/:id
✓ if licensed, should update a project (32 ms)
✓ if not authenticated, should reject (6 ms)
✓ if not licensed, should reject (15 ms)
✓ if missing scope, should reject (16 ms)
2025-04-15T08:25:38.9977800Z
PASS src/executions/__tests__/execution-recovery.service.test.ts (6.982 s)
ExecutionRecoveryService
recoverFromLogs
if follower
✓ should do nothing (29 ms)
if leader, with 0 messages
✓ should return `null` if no execution found (6 ms)
✓ should update `status` and `stoppedAt` (40 ms)
if leader, with 1+ messages
✓ for successful dataful execution, should return `null` (15 ms)
✓ should return `null` if no execution found (5 ms)
✓ for successful dataless execution, should update `status`, `stoppedAt` and `data` (55 ms)
✓ for running execution, should update `status`, `stoppedAt` and `data` if last node did not finish (18 ms)
✓ should update `status`, `stoppedAt` and `data` if last node finished (17 ms)
2025-04-15T08:25:40.2882445Z
PASS src/controllers/oauth/__tests__/oauth1-credential.controller.test.ts (5.246 s)
OAuth1CredentialController
getAuthUri
✓ should throw a BadRequestError when credentialId is missing in the query (32 ms)
✓ should throw a NotFoundError when no matching credential is found for the user (2 ms)
✓ should return a valid auth URI (87 ms)
handleCallback
✓ should render the error page when required query params are missing (1 ms)
✓ should render the error page when `state` query param is invalid (4 ms)
✓ should render the error page when credential is not found in DB (3 ms)
✓ should render the error page when state differs from the stored state in the credential (1 ms)
✓ should render the error page when state is older than 5 minutes (1 ms)
✓ should exchange the code for a valid token, and save it to DB (36 ms)
2025-04-15T08:25:44.4747319Z
PASS src/scaling/__tests__/scaling.service.test.ts
ScalingService
setupQueue
if leader main
✓ should set up queue + listeners + queue recovery (10 ms)
if follower main
✓ should set up queue + listeners (2 ms)
if worker
✓ should set up queue + listeners (1 ms)
webhook
✓ should set up a queue + listeners (2 ms)
setupWorker
✓ should set up a worker with concurrency (2 ms)
✓ should throw if called on a non-worker instance (27 ms)
✓ should throw if called before queue is ready (3 ms)
stop
if main
✓ should pause queue, stop queue recovery and queue metrics (2 ms)
if worker
✓ should pause queue and wait for running jobs to finish (2 ms)
pingQueue
✓ should ping the queue (1 ms)
addJob
✓ should add a job (2 ms)
getJob
✓ should get a job (2 ms)
findJobsByStatus
✓ should find jobs by status (1 ms)
✓ should filter out `null` in Redis response (1 ms)
stopJob
✓ should stop an active job (3 ms)
✓ should stop an inactive job (1 ms)
✓ should report failure to stop a job (2 ms)
2025-04-15T08:25:45.3377692Z
PASS test/integration/api-keys.api.test.ts (7.74 s)
When public API is disabled
✓ POST /api-keys should 404 (80 ms)
✓ GET /api-keys should 404 (27 ms)
✓ DELETE /api-key/:id should 404 (28 ms)
Owner shell
✓ POST /api-keys should create an api key with no expiration (29 ms)
✓ POST /api-keys should create an api key with expiration (25 ms)
✓ GET /api-keys should fetch the api key redacted (40 ms)
✓ DELETE /api-keys/:id should delete the api key (46 ms)
Member
✓ POST /api-keys should create an api key with no expiration (40 ms)
✓ POST /api-keys should create an api key with expiration (24 ms)
✓ POST /api-keys should fail if max number of API keys reached (26 ms)
✓ GET /api-keys should fetch the api key redacted (34 ms)
✓ DELETE /api-keys/:id should delete the api key (32 ms)
2025-04-15T08:25:46.0678170Z
PASS src/task-runners/task-managers/__tests__/data-request-response-stripper.test.ts
DataRequestResponseStripper
all data
✓ should build the runExecutionData as is when everything is requested (8 ms)
envProviderState
✓ should filter out envProviderState when it's not requested (1 ms)
input data
✓ drops input data from result (1 ms)
✓ returns only chunked data (1 ms)
nodes
✓ should return empty run data when only Code node is requested (1 ms)
✓ should return empty run data when only Code node is requested (1 ms)
✓ should return only DebugHelper's data when only DebugHelper node is requested (2 ms)
✓ should return DebugHelper's data when only prevNode node is requested (1 ms)
passthrough properties
✓ it doesn't change workflow
✓ it doesn't change connectionInputSource (1 ms)
✓ it doesn't change node (1 ms)
✓ it doesn't change runIndex
✓ it doesn't change itemIndex (1 ms)
✓ it doesn't change activeNodeName
✓ it doesn't change siblingParameters
✓ it doesn't change mode
✓ it doesn't change defaultReturnRunIndex
✓ it doesn't change selfData (1 ms)
✓ it doesn't change contextNodeName
✓ it doesn't change additionalData
2025-04-15T08:25:48.1518169Z
PASS test/integration/public-api/tags.test.ts (8.739 s)
GET /tags
✓ should fail due to missing API Key (38 ms)
✓ should fail due to invalid API Key (9 ms)
✓ should return all tags (253 ms)
✓ should return all tags with pagination (29 ms)
GET /tags/:id
✓ should fail due to missing API Key (8 ms)
✓ should fail due to invalid API Key (8 ms)
✓ should fail due to non-existing tag (20 ms)
✓ should retrieve tag (14 ms)
DELETE /tags/:id
✓ should fail due to missing API Key (6 ms)
✓ should fail due to invalid API Key (6 ms)
✓ should fail due to non-existing tag (19 ms)
✓ owner should delete the tag (14 ms)
✓ non-owner should not delete tag (11 ms)
POST /tags
✓ should fail due to missing API Key (5 ms)
✓ should fail due to invalid API Key (4 ms)
✓ should fail due to invalid body (23 ms)
✓ should create tag (13 ms)
✓ should not create tag if tag with same name exists (11 ms)
PUT /tags/:id
✓ should fail due to missing API Key (5 ms)
✓ should fail due to invalid API Key (4 ms)
✓ should fail due to non-existing tag (12 ms)
✓ should fail due to invalid body (5 ms)
✓ should update tag (15 ms)
✓ should fail if there is already a tag with a the new name (20 ms)
2025-04-15T08:25:53.4748400Z
PASS test/integration/password-reset.api.test.ts (8.482 s)
POST /forgot-password
✓ should send password reset email (94 ms)
✓ should fail if emailing is not set up (58 ms)
✓ should fail if SAML is authentication method (41 ms)
✓ should succeed if SAML is authentication method and requestor is owner (41 ms)
✓ should fail with invalid inputs (40 ms)
✓ should fail if user is not found (25 ms)
GET /resolve-password-token
✓ should succeed with valid inputs (23 ms)
✓ should fail with invalid inputs (29 ms)
✓ should fail if user is not found (22 ms)
✓ should fail if token is expired (22 ms)
✓ should fail after password has changed (23 ms)
POST /change-password
✓ should succeed with valid inputs (238 ms)
✓ should fail with invalid inputs (46 ms)
✓ should fail when token has expired (28 ms)
✓ owner should be able to reset its password when quota:users = 1 (231 ms)
✓ member should not be able to reset its password when quota:users = 1 (122 ms)
2025-04-15T08:25:54.7878198Z
PASS test/integration/saml/saml.api.test.ts (8.849 s)
Instance owner
PATCH /me
✓ should succeed with valid inputs (71 ms)
✓ should throw BadRequestError if email is changed when SAML is enabled (31 ms)
PATCH /password
✓ should throw BadRequestError if password is changed when SAML is enabled (16 ms)
POST /sso/saml/config
✓ should post saml config (349 ms)
✓ should return 400 on invalid config (26 ms)
POST /sso/saml/config/toggle
✓ should toggle saml as default authentication method (71 ms)
✓ should fail enable saml if default authentication is not email (50 ms)
Check endpoint permissions
Owner
✓ should be able to access GET /sso/saml/metadata (18 ms)
✓ should be able to access GET /sso/saml/config (13 ms)
✓ should be able to access POST /sso/saml/config (29 ms)
✓ should be able to access POST /sso/saml/config/toggle (13 ms)
✓ should be able to access GET /sso/saml/acs (15 ms)
✓ should be able to access POST /sso/saml/acs (10 ms)
✓ should be able to access GET /sso/saml/initsso (16 ms)
✓ should be able to access GET /sso/saml/config/test (11 ms)
Authenticated Member
✓ should be able to access GET /sso/saml/metadata (6 ms)
✓ should be able to access GET /sso/saml/config (10 ms)
✓ should NOT be able to access POST /sso/saml/config (10 ms)
✓ should NOT be able to access POST /sso/saml/config/toggle (9 ms)
✓ should be able to access GET /sso/saml/acs (6 ms)
✓ should be able to access POST /sso/saml/acs (7 ms)
✓ should be able to access GET /sso/saml/initsso (16 ms)
✓ should NOT be able to access GET /sso/saml/config/test (9 ms)
Non-Authenticated User
✓ should be able to access /sso/saml/metadata (6 ms)
✓ should NOT be able to access GET /sso/saml/config (6 ms)
✓ should NOT be able to access POST /sso/saml/config (5 ms)
✓ should NOT be able to access POST /sso/saml/config/toggle (5 ms)
✓ should be able to access GET /sso/saml/acs (7 ms)
✓ should be able to access POST /sso/saml/acs (6 ms)
✓ should be able to access GET /sso/saml/initsso (7 ms)
✓ should NOT be able to access GET /sso/saml/config/test (12 ms)
2025-04-15T08:25:57.2598742Z
PASS src/executions/__tests__/execution.service.test.ts
ExecutionService
retry
✓ should error on retrying a execution that was aborted before starting (33 ms)
stop
✓ should throw when stopping a missing execution (1 ms)
✓ should throw when stopping a not-in-progress execution (1 ms)
regular mode
✓ should stop a `running` execution in regular mode (3 ms)
✓ should stop a `waiting` execution in regular mode (2 ms)
✓ should stop a concurrency-controlled `new` execution in regular mode (1 ms)
scaling mode
manual execution
✓ should stop a `running` execution in scaling mode (2 ms)
production execution
✓ should stop a `running` execution in scaling mode (2 ms)
✓ should stop a `waiting` execution in scaling mode (1 ms)
2025-04-15T08:25:58.2277106Z
PASS src/__tests__/node-types.test.ts
NodeTypes
getByName
✓ should return node type when it exists (6 ms)
getByNameAndVersion
✓ should throw an error if the package does not exist (20 ms)
✓ should throw an error if the node-type does not exist (2 ms)
✓ should return a regular node-type without version (1 ms)
✓ should return a regular node-type with version
✓ should throw when a node-type is requested as tool, but does not support being used as one (2 ms)
✓ should throw when a node-type is requested as tool, but the original node is already a tool (1 ms)
✓ should return the tool node-type when requested as tool (11 ms)
✓ should return a tool node-type from a community node,  when requested as tool (2 ms)
✓ should return a declarative node-type with an `.execute` method (2 ms)
✓ should return a declarative node-type as a tool with an `.execute` method (4 ms)
getWithSourcePath
✓ should return description and source path for existing node (1 ms)
✓ should throw error for non-existent node (2 ms)
getKnownTypes
✓ should return known node types
getNodeTypeDescriptions
✓ should return descriptions for valid node types
✓ should throw error for invalid node type (1 ms)
2025-04-15T08:26:01.1138711Z
PASS test/integration/pruning.service.test.ts (7.951 s)
softDeleteOnPruningCycle()
when EXECUTIONS_DATA_PRUNE_MAX_COUNT is set
✓ should mark as deleted based on EXECUTIONS_DATA_PRUNE_MAX_COUNT (39 ms)
✓ should not re-mark already marked executions (21 ms)
✓ should prune unknown executions (19 ms)
✓ should prune canceled executions (20 ms)
✓ should prune crashed executions (14 ms)
✓ should prune error executions (13 ms)
✓ should prune success executions (13 ms)
✓ should not prune new executions (17 ms)
✓ should not prune running executions (14 ms)
✓ should not prune waiting executions (13 ms)
✓ should not prune annotated executions (34 ms)
when EXECUTIONS_DATA_MAX_AGE is set
✓ should mark as deleted based on EXECUTIONS_DATA_MAX_AGE (17 ms)
✓ should not re-mark already marked executions (13 ms)
✓ should prune unknown executions (8 ms)
✓ should prune canceled executions (7 ms)
✓ should prune crashed executions (9 ms)
✓ should prune error executions (7 ms)
✓ should prune success executions (7 ms)
✓ should not prune new executions (16 ms)
✓ should not prune running executions (12 ms)
✓ should not prune waiting executions (12 ms)
✓ should not prune annotated executions (26 ms)
2025-04-15T08:26:02.9611768Z
PASS src/__tests__/license.test.ts
License
✓ initializes license manager (8 ms)
✓ initializes license manager for worker (3 ms)
✓ attempts to activate license with provided key (1 ms)
✓ renews license (2 ms)
✓ check if feature is enabled (1 ms)
✓ check if sharing feature is enabled (2 ms)
✓ check fetching entitlements (2 ms)
✓ check fetching feature values (1 ms)
✓ check management jwt (2 ms)
✓ getMainPlan() returns the latest main entitlement (1 ms)
✓ getMainPlan() returns undefined if there is no main plan (2 ms)
init
✓ when leader main with N8N_LICENSE_AUTO_RENEW_ENABLED=true, should enable renewal (9 ms)
✓ when leader main with N8N_LICENSE_AUTO_RENEW_ENABLED=false, should disable renewal (2 ms)
✓ when follower main with N8N_LICENSE_AUTO_RENEW_ENABLED=true, should disable renewal (2 ms)
✓ when follower main with N8N_LICENSE_AUTO_RENEW_ENABLED=false, should disable renewal (2 ms)
✓ when CLI command with N8N_LICENSE_AUTO_RENEW_ENABLED=true, should enable renewal (2 ms)
2025-04-15T08:26:04.6016325Z
PASS test/integration/commands/import.cmd.test.ts (8.316 s)
✓ import:workflow should import active workflow and deactivate it (99 ms)
✓ import:workflow should import active workflow from combined file and deactivate it (42 ms)
✓ import:workflow can import a single workflow object (30 ms)
✓ `import:workflow --userId ...` should fail if the workflow exists already and is owned by somebody else (87 ms)
✓ only update the workflow, don't create or update the owner if `--userId` is not passed (52 ms)
✓ `import:workflow --projectId ...` should fail if the credential already exists and is owned by another project (49 ms)
✓ `import:workflow --projectId ... --userId ...` fails explaining that only one of the options can be used at a time (6 ms)
2025-04-15T08:26:05.7978860Z
PASS src/middlewares/list-query/__tests__/list-query.test.ts
List query middleware
Query filter
✓ should not set filter on request if none sent (7 ms)
✓ should parse valid filter (6 ms)
✓ should ignore invalid filter (2 ms)
✓ should throw on invalid JSON (35 ms)
✓ should throw on valid filter with invalid type (2 ms)
Query select
✓ should not set select on request if none sent (1 ms)
✓ should parse valid select (1 ms)
✓ ignore invalid select
✓ throw on invalid JSON (1 ms)
✓ throw on non-string-array JSON for select (1 ms)
Query pagination
✓ should not set pagination options on request if none sent (1 ms)
✓ should parse valid pagination (1 ms)
✓ should throw on skip without take (6 ms)
✓ should default skip to 0 (1 ms)
✓ should cap take at 50
✓ should throw on non-numeric-integer take (2 ms)
✓ should throw on non-numeric-integer skip (1 ms)
Query sort by
✓ should succeed validation when sorting by name asc (1 ms)
✓ should succeed validation when sorting by name desc (1 ms)
✓ should succeed validation when sorting by createdAt asc (1 ms)
✓ should succeed validation when sorting by createdAt desc
✓ should succeed validation when sorting by updatedAt asc (2 ms)
✓ should succeed validation when sorting by updatedAt desc
✓ should fail validation when sorting by invalid column (2 ms)
✓ should fail validation when sorting by valid column without order (1 ms)
✓ should fail validation when sorting by valid column with invalid order (1 ms)
✓ should not pass sortBy to listQueryOptions if not provided (1 ms)
Combinations
✓ should combine filter with select (1 ms)
✓ should combine filter with pagination options (1 ms)
✓ should combine select with pagination options
2025-04-15T08:26:07.6384746Z
PASS src/environments.ee/source-control/__tests__/source-control.service.test.ts
SourceControlService
pushWorkfolder
✓ should throw an error if a file is given that is not in the workfolder (45 ms)
pullWorkfolder
✓ does not filter locally created credentials (2 ms)
✓ does not filter remotely deleted credentials (1 ms)
✓ should throw an error if a file is given that is not in the workfolder (1 ms)
getStatus
✓ conflict depends on the value of `direction` (5 ms)
2025-04-15T08:26:07.9450656Z
PASS src/environments.ee/source-control/__tests__/source-control-export.service.test.ts
SourceControlExportService
exportCredentialsToWorkFolder
✓ should export credentials to work folder (13 ms)
✓ should handle team project credentials (2 ms)
✓ should handle missing credentials (10 ms)
exportTagsToWorkFolder
✓ should export tags to work folder (2 ms)
✓ should not export empty tags (1 ms)
exportFoldersToWorkFolder
✓ should export folders to work folder (2 ms)
✓ should not export empty folders (1 ms)
exportVariablesToWorkFolder
✓ should export variables to work folder (1 ms)
✓ should not export empty variables (1 ms)
exportWorkflowsToWorkFolder
✓ should export workflows to work folder (7 ms)
✓ should throw an error if workflow has no owner (37 ms)
2025-04-15T08:26:09.4109588Z
PASS src/metrics/__tests__/prometheus-metrics.service.test.ts (5.04 s)
PrometheusMetricsService
constructor
✓ should enable metrics based on global config (10 ms)
init
✓ should set up `n8n_version_info` (1 ms)
✓ should set up default metrics collection with `prom-client` (2 ms)
✓ should set up `n8n_cache_hits_total` (2 ms)
✓ should set up `n8n_cache_misses_total` (2 ms)
✓ should set up `n8n_cache_updates_total` (2 ms)
✓ should set up route metrics with `express-prom-bundle` (3 ms)
✓ should set up event bus metrics (1 ms)
✓ should set up queue metrics if enabled (8 ms)
✓ should not set up queue metrics if enabled but not on scaling mode (2 ms)
✓ should not set up queue metrics if enabled and on scaling mode but instance is not main (1 ms)
✓ should setup active workflow count metric (2 ms)
2025-04-15T08:26:12.9499282Z
PASS src/__tests__/workflow-execute-additional-data.test.ts
WorkflowExecuteAdditionalData
✓ logAiEvent should call MessageEventBus (8 ms)
executeWorkflow
✓ should execute workflow, return data and execution id (6 ms)
✓ should execute workflow, skip waiting (2 ms)
✓ should set sub workflow execution as running (2 ms)
✓ should return waitTill property when workflow execution is waiting (3 ms)
getRunData
✓ should throw error to add trigger ndoe (22 ms)
✓ should return default data (2 ms)
✓ should return run data with input data and metadata (2 ms)
2025-04-15T08:26:14.2976071Z
PASS test/integration/community-packages.api.test.ts (7.413 s)
GET /community-packages
✓ should respond 200 if no nodes are installed (57 ms)
✓ should return list of one installed package and node (12 ms)
✓ should return list of multiple installed packages and nodes (12 ms)
✓ should not check for updates if no packages installed (26 ms)
✓ should check for updates if packages installed (11 ms)
✓ should report package updates if available (9 ms)
POST /community-packages
✓ should reject if package name is missing (9 ms)
✓ should reject if package is duplicate (9 ms)
✓ should allow installing packages that could not be loaded (8 ms)
✓ should not install a banned package (8 ms)
DELETE /community-packages
✓ should not delete if package name is empty (14 ms)
✓ should reject if package is not installed (9 ms)
✓ should uninstall package (8 ms)
PATCH /community-packages
✓ should reject if package name is empty (8 ms)
✓ should reject if package is not installed (7 ms)
✓ should update a package (24 ms)
2025-04-15T08:26:15.5705687Z
PASS src/services/__tests__/workflow-statistics.service.test.ts
WorkflowStatisticsService
workflowExecutionCompleted
✓ should create metrics for production successes (9 ms)
✓ should only create metrics for production successes (1 ms)
✓ should not send metrics for updated entries (1 ms)
nodeFetchedData
✓ should create metrics when the db is updated (1 ms)
✓ should emit event with no `userId` if workflow is owned by team project (1 ms)
✓ should create metrics with credentials when the db is updated (2 ms)
✓ should not send metrics for entries that already have the flag set (2 ms)
2025-04-15T08:26:18.9342203Z
PASS test/integration/workflow-history.api.test.ts (8.453 s)
GET /workflow-history/:workflowId
✓ should not work when license is not available (34 ms)
✓ should not return anything on an invalid workflow ID (48 ms)
✓ should not return anything if not shared with user (27 ms)
✓ should return any empty list if no versions (32 ms)
✓ should return versions for workflow (52 ms)
✓ should return versions only for workflow id provided (64 ms)
✓ should work with take parameter (38 ms)
✓ should work with skip parameter (36 ms)
GET /workflow-history/workflow/:workflowId/version/:versionId
✓ should not work when license is not available (8 ms)
✓ should not return anything on an invalid workflow ID (18 ms)
✓ should not return anything on an invalid version ID (24 ms)
✓ should return version (31 ms)
✓ should not return anything if not shared with user (31 ms)
✓ should not return anything if not shared with user and using workflow owned by unshared user (32 ms)
2025-04-15T08:26:21.6625440Z
PASS test/integration/commands/credentials.cmd.test.ts (8.411 s)
✓ import:credentials should import a credential (77 ms)
✓ import:credentials should import a credential from separated files (38 ms)
✓ `import:credentials --userId ...` should fail if the credential exists already and is owned by somebody else (91 ms)
✓ only update credential, don't create or update owner if neither `--userId` nor `--projectId` is passed (48 ms)
✓ `import:credential --projectId ...` should fail if the credential already exists and is owned by another project (53 ms)
✓ `import:credential --projectId ... --userId ...` fails explaining that only one of the options can be used at a time (9 ms)
2025-04-15T08:26:22.9829761Z
PASS src/__tests__/wait-tracker.test.ts
WaitTracker
init()
✓ should query DB for waiting executions if leader (9 ms)
✓ if follower, should do nothing (2 ms)
✓ if no executions to start, should do nothing (2 ms)
if execution to start
✓ if not enough time passed, should not start execution (3 ms)
✓ if enough time passed, should start execution (7 ms)
startExecution()
✓ should query for execution to start (3 ms)
✓ should also resume parent execution once sub-workflow finishes (7 ms)
single-main setup
✓ should start tracking (2 ms)
multi-main setup
✓ should start tracking if leader (1 ms)
✓ should not start tracking if follower (1 ms)
2025-04-15T08:26:23.5998607Z
PASS src/services/__tests__/ownership.service.test.ts
OwnershipService
getWorkflowProjectCached()
✓ should retrieve a workflow owner project (7 ms)
✓ should throw if no workflow owner project found (15 ms)
getPersonalProjectOwnerCached()
✓ should retrieve a project owner (1 ms)
✓ should not throw if no project owner found, should return null instead
✓ should not use the repository if the owner was found in the cache (2 ms)
getProjectOwnerCached()
✓ should retrieve a project owner
✓ should not throw if no project owner found, should return null instead (1 ms)
addOwnedByAndSharedWith()
✓ should add `ownedBy` and `sharedWith` to credential (2 ms)
✓ should add `ownedBy` and `sharedWith` to workflow (1 ms)
✓ should produce an empty sharedWith if no sharee (1 ms)
getInstanceOwner()
✓ should find owner using global owner role ID
2025-04-15T08:26:25.0335837Z
PASS src/services/cache/__tests__/cache.service.test.ts
memory
init
✓ should select backend based on config (7 ms)
✓ should honor max size when enough (2 ms)
✓ should honor max size when not enough (2 ms)
set
✓ should set a string value (4 ms)
✓ should set a number value (1 ms)
✓ should set an object value (3 ms)
✓ should not cache `null` or `undefined` values (1 ms)
✓ should disregard zero-length keys (1 ms)
✓ should honor ttl (202 ms)
get
✓ should fall back to fallback value (1 ms)
✓ should refresh value (2 ms)
✓ should handle non-ASCII key (1 ms)
delete
✓ should delete a key (1 ms)
✓ should handle non-ASCII key (2 ms)
setMany
✓ should set multiple string values (2 ms)
✓ should set multiple number values (1 ms)
✓ should disregard zero-length keys (1 ms)
getMany
✓ should return undefined on missing result (1 ms)
setHash
✓ should set a hash if non-existing (1 ms)
✓ should add to a hash value if existing (1 ms)
deleteFromHash
✓ should delete a hash field (1 ms)
getHashValue
✓ should return a hash field value
redis
init
✓ should select backend based on config (2 ms)
✓ with auto backend and queue mode, should select redis (2 ms)
set
✓ should set a string value (1 ms)
✓ should set a number value (1 ms)
✓ should set an object value (1 ms)
✓ should not cache `null` or `undefined` values
✓ should disregard zero-length keys (1 ms)
✓ should honor ttl (202 ms)
get
✓ should fall back to fallback value (1 ms)
✓ should refresh value
✓ should handle non-ASCII key (1 ms)
delete
✓ should delete a key (1 ms)
✓ should handle non-ASCII key (1 ms)
setMany
✓ should set multiple string values (2 ms)
✓ should set multiple number values (1 ms)
✓ should disregard zero-length keys (1 ms)
getMany
✓ should return undefined on missing result (1 ms)
setHash
✓ should set a hash if non-existing (1 ms)
✓ should add to a hash value if existing (1 ms)
deleteFromHash
✓ should delete a hash field (1 ms)
getHashValue
✓ should return a hash field value
2025-04-15T08:26:27.0072924Z
PASS test/integration/executions/pre-execution-checks/credentials-permission-checker.test.ts (6.003 s)
check()
✓ should allow if workflow has no creds (24 ms)
✓ should allow if workflow creds are valid subset (35 ms)
✓ should deny if workflow creds are not valid subset (39 ms)
✓ should allow all credentials if current user is instance owner (22 ms)
2025-04-15T08:26:31.2597462Z
PASS test/integration/public-api/users.ee.test.ts (8.308 s)
With license unlimited quota:users
GET /users
✓ should fail due to missing API Key (469 ms)
✓ should fail due to invalid API Key (13 ms)
✓ should fail due to member trying to access owner only endpoint (161 ms)
✓ should return all users (32 ms)
✓ should return users filtered by project ID (49 ms)
GET /users/:id
✓ should fail due to missing API Key (20 ms)
✓ should fail due to invalid API Key (18 ms)
✓ should fail due to member trying to access owner only endpoint (25 ms)
✓ should return 404 for non-existing id  (24 ms)
✓ should return a pending user (24 ms)
GET /users/:email
✓ with non-existing email should return 404 (23 ms)
✓ should return a user (22 ms)
With license without quota:users
✓ GET /users should fail due to invalid license (22 ms)
✓ GET /users/:id should fail due to invalid license (17 ms)
2025-04-15T08:26:31.6057892Z
PASS src/controllers/__tests__/binary-data.controller.test.ts
BinaryDataController
get
✓ should return 400 if binary data mode is missing (7 ms)
✓ should return 400 if binary data mode is invalid (1 ms)
✓ should return 404 if file is not found (2 ms)
✓ should set Content-Type and Content-Length from query if provided (1 ms)
✓ should set Content-Type and Content-Length from metadata if not provided (2 ms)
✓ should set Content-Disposition for download action (1 ms)
✓ should set Content-Security-Policy for HTML in view mode
✓ should not set Content-Security-Policy for HTML in download mode
✓ should return the file stream on success (1 ms)
getSigned
✓ should return 400 if binary data mode is missing (1 ms)
✓ should return 400 if binary data mode is invalid (2 ms)
✓ should return 400 if token is invalid (10 ms)
✓ should return 404 if file is not found (1 ms)
✓ should return the file stream on a valid signed token (1 ms)
2025-04-15T08:26:34.9477250Z
PASS src/environments.ee/source-control/__tests__/source-control-helper.ee.test.ts (7.971 s)
Source Control
✓ should generate an SSH key pair (104 ms)
✓ should generate an RSA key pair (4834 ms)
✓ should check for git and ssh folders and create them if required (2 ms)
✓ should get repo type from url (1 ms)
✓ should get tracking information from pre-push results (2 ms)
✓ should get tracking information from post-push results (1 ms)
✓ should get tracking information from pull results
2025-04-15T08:26:35.1986960Z
PASS test/integration/workflows/workflow.service.ee.test.ts (6.744 s)
EnterpriseWorkflowService
validateWorkflowCredentialUsage
✓ Should throw error saving a workflow using credential without access (38 ms)
✓ Should not throw error when saving a workflow using credential with access (2 ms)
✓ Should not throw error when saving a workflow removing node without credential access (2 ms)
✓ Should save fine when not making changes to workflow without access (3 ms)
✓ Should throw error saving a workflow adding node without credential access (2 ms)
getNodesWithInaccessibleCreds
✓ Should return an empty list for a workflow without nodes (2 ms)
✓ Should return an empty list for a workflow with nodes without credentials (2 ms)
✓ Should return an element for a node with a credential without access (2 ms)
✓ Should return an empty list for a node with a credential with access (2 ms)
✓ Should return an element for a node with two credentials and mixed access (2 ms)
✓ Should return one node for a workflow with two nodes and two credentials (1 ms)
✓ Should return one element for a workflows with two nodes and one credential (2 ms)
✓ Should return one element for a workflows with two nodes and partial credential access (2 ms)
✓ Should return two elements for a workflows with two nodes and partial credential access (1 ms)
✓ Should return two elements for a workflows with two nodes and no credential access (1 ms)
2025-04-15T08:26:38.2309934Z
PASS src/environments.ee/source-control/__tests__/source-control-import.service.ee.test.ts
SourceControlImportService
getRemoteVersionIdsFromFiles
✓ should parse workflow files correctly (9 ms)
✓ should filter out files without valid workflow data
getRemoteCredentialsFromFiles
✓ should parse credential files correctly (1 ms)
✓ should filter out files without valid credential data
getRemoteVariablesFromFile
✓ should parse variables file correctly (1 ms)
✓ should return empty array if no variables file found (1 ms)
getRemoteTagsAndMappingsFromFile
✓ should parse tags and mappings file correctly (1 ms)
✓ should return empty tags and mappings if no file found (1 ms)
getRemoteFoldersAndMappingsFromFile
✓ should parse folders and mappings file correctly (1 ms)
✓ should return empty folders and mappings if no file found (1 ms)
getLocalVersionIdsFromDb
✓ should replace invalid updatedAt with current timestamp (5 ms)
getLocalFoldersAndMappingsFromDb
✓ should return data from DB (2 ms)
2025-04-15T08:26:39.8594579Z
PASS src/controllers/__tests__/dynamic-node-parameters.controller.test.ts
DynamicNodeParametersController
getOptions
✓ should call getOptionsViaMethodName when methodName is provided (9 ms)
✓ should call getOptionsViaLoadOptions when loadOptions is provided (1 ms)
✓ should return empty array when no method or load options are provided (1 ms)
getResourceLocatorResults
✓ should call getResourceLocatorResults with correct parameters (2 ms)
getResourceMappingFields
✓ should call getResourceMappingFields with correct parameters (1 ms)
getLocalResourceMappingFields
✓ should call getLocalResourceMappingFields with correct parameters (3 ms)
getActionResult
✓ should call getActionResult with correct parameters (1 ms)
2025-04-15T08:26:40.1047481Z
PASS test/integration/security-audit/instance-risk-reporter.test.ts (18.136 s)
✓ should report webhook lacking authentication (518 ms)
✓ should not report webhooks having basic or header auth (17 ms)
✓ should not report webhooks validated by direct children (40 ms)
✓ should not report non-webhook node (15 ms)
✓ should report outdated instance when outdated (8 ms)
✓ should not report outdated instance when up to date (90 ms)
✓ should report security settings (9 ms)
2025-04-15T08:26:58.2511531Z
PASS test/integration/public-api/users.test.ts (19.787 s)
Users in Public API
POST /users
✓ if not authenticated, should reject (31 ms)
✓ if missing scope, should reject (173 ms)
✓ should create a user (79 ms)
DELETE /users/:id
✓ if not authenticated, should reject (15 ms)
✓ if missing scope, should reject (79 ms)
✓ should delete a user (99 ms)
PATCH /users/:id/role
✓ if not authenticated, should reject (13 ms)
✓ if not licensed, should reject (36 ms)
✓ if missing scope, should reject (26 ms)
✓ should return a 400 on invalid payload (27 ms)
✓ should change a user's role (36 ms)
2025-04-15T08:26:58.2703167Z
PASS test/integration/webhooks.api.test.ts (18.272 s)
Webhook API
Content-Type support
✓ should handle JSON (43 ms)
✓ should handle XML (16 ms)
✓ should handle form-urlencoded (11 ms)
✓ should handle plain text (10 ms)
✓ should handle multipart/form-data (25 ms)
Params support
✓ should handle params (42 ms)
2025-04-15T08:26:58.7298977Z
PASS src/webhooks/__tests__/webhook-request-handler.test.ts
WebhookRequestHandler
✓ should throw for unsupported methods (18 ms)
preflight requests
✓ should handle missing header for requested method (1 ms)
✓ should handle default origin and max-age (2 ms)
✓ should handle wildcard origin (1 ms)
✓ should handle custom origin (1 ms)
webhook requests
✓ should delegate the request to the webhook manager and send the response (1 ms)
✓ should send an error response if webhook execution throws (2 ms)
✓ should handle 'DELETE' method (1 ms)
✓ should handle 'GET' method (1 ms)
✓ should handle 'HEAD' method (1 ms)
✓ should handle 'PATCH' method (1 ms)
✓ should handle 'POST' method (1 ms)
✓ should handle 'PUT' method (1 ms)
2025-04-15T08:27:01.1068749Z
PASS src/webhooks/__tests__/test-webhooks.test.ts (5.042 s)
TestWebhooks
needsWebhook()
✓ if webhook is needed, should register then create webhook and return true (7 ms)
✓ if webhook activation fails, should deactivate workflow webhooks (16 ms)
✓ if no webhook is found to start workflow, should return false (1 ms)
✓ returns false if a triggerToStartFrom with triggerData is given
✓ returns true, registers and then creates webhook if triggerToStartFrom is given with no triggerData (2 ms)
executeWebhook()
✓ if webhook is not registered, should throw (11 ms)
✓ if webhook is registered but missing from workflow, should throw (5 ms)
deactivateWebhooks()
✓ should add additional data to workflow (2 ms)
2025-04-15T08:27:03.6553798Z
PASS src/__tests__/workflow-runner.test.ts (21.28 s)
processError
✓ processError should return early in Bull stalled edge case (75 ms)
✓ processError should return early if the error is `ExecutionNotFoundError` (49 ms)
✓ processError should process error (85 ms)
run
✓ uses recreateNodeExecutionStack to create a partial execution if a triggerToStartFrom with data is sent (29 ms)
✓ does not use recreateNodeExecutionStack to create a partial execution if a triggerToStartFrom without data is sent (6 ms)
2025-04-15T08:27:20.2357151Z
PASS test/integration/import.service.test.ts (19.462 s)
ImportService
✓ should import credless and tagless workflow (54 ms)
✓ should make user owner of imported workflow (14 ms)
✓ should not change the owner if it already exists (67 ms)
✓ should deactivate imported workflow if active (13 ms)
✓ should leave intact new-format credentials (16 ms)
✓ should set tag by identical match (22 ms)
✓ should set tag by name match (17 ms)
✓ should set tag by creating if no match (20 ms)
2025-04-15T08:27:20.7752165Z
PASS test/integration/security-audit/credentials-risk-reporter.test.ts (19.395 s)
✓ should report credentials not in any use (118 ms)
✓ should report credentials not in active use (13 ms)
✓ should report credential in not recently executed workflow (49 ms)
✓ should not report credentials in recently executed workflow (27 ms)
2025-04-15T08:27:23.3497945Z
PASS src/webhooks/__tests__/waiting-forms.test.ts
WaitingForms
findCompletionPage
✓ should return lastNodeExecuted if it is a non-disabled form completion node (20 ms)
✓ should return undefined if lastNodeExecuted is disabled (1 ms)
✓ should return undefined if lastNodeExecuted is not a form node
✓ should return undefined if lastNodeExecuted operation is not completion (4 ms)
✓ should find first valid completion form in parent nodes if lastNodeExecuted is not valid (2 ms)
✓ should return undefined if no valid completion form is found in parent nodes (1 ms)
✓ should skip parent nodes without runData (1 ms)
✓ should mark as test form webhook when execution mode is manual (3 ms)
✓ should return status of execution if suffix is WAITING_FORMS_EXECUTION_STATUS (2 ms)
2025-04-15T08:27:24.7762650Z
PASS src/push/__tests__/index.test.ts
Push
setupPushServer
sse backend
✓ should not create a WebSocket server (8 ms)
websocket backend
✓ should not upgrade non-push urls (3 ms)
✓ should upgrade push url, and route it to express (4 ms)
handleRequest
sse backend
✓ should throw if pushRef is invalid (2 ms)
✓ should add the connection if pushRef is valid (2 ms)
should throw on invalid origin
✓ https://subdomain.example.com (24 ms)
✓ https://123example.com (2 ms)
✓ undefined (2 ms)
websocket backend
✓ should throw if pushRef is invalid (1 ms)
✓ should add the connection if pushRef is valid (1 ms)
✓ should respond with 401 if request is not WebSocket (1 ms)
should throw on invalid origin
✓ https://subdomain.example.com (2 ms)
✓ https://123example.com (8 ms)
✓ undefined (2 ms)
2025-04-15T08:27:26.7275273Z
PASS src/services/pruning/__tests__/pruning.service.test.ts
PruningService
init
✓ should start pruning on main instance that is the leader (8 ms)
✓ should not start pruning on main instance that is a follower (1 ms)
✓ should register leadership events if main on multi-main setup (3 ms)
isEnabled
✓ should return `true` based on config if leader main (1 ms)
✓ should return `false` based on config if leader main
✓ should return `false` if non-main even if config is enabled
✓ should return `false` if follower main even if config is enabled (1 ms)
startPruning
✓ should not start pruning if service is disabled (1 ms)
✓ should start pruning if service is enabled and DB is migrated (1 ms)
2025-04-15T08:27:30.0889212Z
PASS test/integration/task-runners/js-task-runner-execution.integration.test.ts (6.126 s)
JS TaskRunner execution on internal mode
Basic code execution
✓ should execute a simple JS task (1270 ms)
Internal and external libs
✓ should allow importing allowed internal module (1394 ms)
✓ should not allow importing disallowed internal module (9 ms)
✓ should allow importing allowed external module (10 ms)
✓ should not allow importing disallowed external module (6 ms)
2025-04-15T08:27:31.2038120Z
PASS src/__tests__/credentials-helper.test.ts
CredentialsHelper
authenticate
✓ basicAuth, default property names (24 ms)
✓ headerAuth (2 ms)
✓ headerAuth, key and value expressions (1 ms)
✓ queryAuth (2 ms)
✓ custom authentication
2025-04-15T08:27:34.3426311Z
PASS src/commands/db/__tests__/revert.test.ts
✓ don't revert migrations if there is no migration (8 ms)
✓ don't revert the last migration if it had no down migration (1 ms)
✓ print migration name instead of class name in error message if the migration has a name (1 ms)
✓ don't revert the last migration if we cannot find the migration in the code (5 ms)
✓ revert the last migration if it has a down migration (1 ms)
✓ don't use transaction if the last migration has transaction = false
2025-04-15T08:27:37.6984914Z
PASS src/services/__tests__/public-api-key.service.test.ts (19.776 s)
PublicApiKeyService
getAuthMiddleware
✓ should return false if api key is invalid (14 ms)
✓ should return false if valid api key is not in database (5 ms)
✓ should return true if valid api key exist in the database (38 ms)
✓ should return false if expired JWT is used (39 ms)
✓ should work with non JWT (legacy) api keys (15 ms)
redactApiKey
✓ should redact api key (1 ms)
2025-04-15T08:27:40.7880112Z
PASS src/scaling/__tests__/worker-server.test.ts
WorkerServer
constructor
✓ should throw if non-worker instance type (22 ms)
✓ should exit if port taken (2 ms)
init
✓ should mount all endpoints when all are enabled (2 ms)
✓ should mount only health and overwrites endpoints if only those are enabled (1 ms)
✓ should throw if no endpoints are enabled (2 ms)
✓ should call `worker.ready` external hook
2025-04-15T08:27:42.6061114Z
PASS src/deprecation/__tests__/deprecation.service.test.ts
DeprecationService
✓ should detect when N8N_BINARY_DATA_TTL is `1` (1 ms)
✓ should detect when N8N_PERSISTED_BINARY_DATA_TTL is `1` (1 ms)
✓ should detect when EXECUTIONS_DATA_PRUNE_TIMEOUT is `1` (1 ms)
✓ should detect when N8N_CONFIG_FILES is `1` (1 ms)
✓ should detect when N8N_SKIP_WEBHOOK_DEREGISTRATION_SHUTDOWN is `1` (1 ms)
✓ should detect when N8N_PARTIAL_EXECUTION_VERSION_DEFAULT is `1`
✓ should detect when N8N_PARTIAL_EXECUTION_VERSION_DEFAULT is `2` (1 ms)
✓ should detect when N8N_PARTIAL_EXECUTION_VERSION_DEFAULT is `undefined` (1 ms)
✓ should handle N8N_BINARY_DATA_MODE as default (1 ms)
✓ should handle N8N_BINARY_DATA_MODE as filesystem
✓ should handle N8N_BINARY_DATA_MODE as s3
✓ should handle DB_TYPE as sqlite (1 ms)
✓ should handle DB_TYPE as postgresdb
✓ should handle DB_TYPE as mysqldb (1 ms)
✓ should handle DB_TYPE as mariadb (1 ms)
N8N_PARTIAL_EXECUTION_VERSION_DEFAULT
✓ supports multiple warnings for the same environment variable (10 ms)
N8N_RUNNERS_ENABLED
✓ should handle value: false
✓ should handle value:  (1 ms)
✓ should handle value: true
✓ should handle value: undefined
OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS
when executions.mode is queue
✓ should warn when OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS is false (1 ms)
✓ should warn when OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS is empty
✓ should not warn when OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS is true
✓ should warn when OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS is undefined (1 ms)
when executions.mode is not queue
✓ should not warn
2025-04-15T08:27:45.3897471Z
PASS src/__tests__/active-workflow-manager.test.ts
ActiveWorkflowManager
checkIfWorkflowCanBeActivated
✓ should skip disabled nodes (6 ms)
✓ should skip nodes marked as ignored (1 ms)
✓ should skip unknown nodes (1 ms)
✓ should skip nodes with no trigger method (1 ms)
✓ should activate if poll method exists (7 ms)
✓ should activate if trigger method exists (2 ms)
✓ should activate if webhook method exists (1 ms)
shouldAddWebhooks
if leader
✓ should return `true` for `init`
✓ should return `false` for `leadershipChange` (1 ms)
✓ should return `true` for `update` or `activate` (1 ms)
if follower
✓ should return `false` for `update` or `activate`
add
✓ should skip inactive workflow in `init` activation mode (1 ms)
✓ should skip inactive workflow in `leadershipChange` activation mode (1 ms)
2025-04-15T08:27:49.5194762Z
PASS test/integration/controllers/dynamic-node-parameters.controller.test.ts (21.522 s)
DynamicNodeParametersController
POST /dynamic-node-parameters/options
✓ should take params via body (50 ms)
✓ should take params with loadOptions (12 ms)
✓ should return empty array when no method or loadOptions provided (10 ms)
POST /dynamic-node-parameters/resource-locator-results
✓ should return resource locator results (8 ms)
✓ should handle resource locator results without pagination (8 ms)
✓ should return a 400 if methodName is not defined (9 ms)
POST /dynamic-node-parameters/resource-mapper-fields
✓ should return resource mapper fields (8 ms)
✓ should return a 400 if methodName is not defined (8 ms)
POST /dynamic-node-parameters/local-resource-mapper-fields
✓ should return local resource mapper fields (9 ms)
✓ should return a 400 if methodName is not defined (8 ms)
POST /dynamic-node-parameters/action-result
✓ should return action result with handler (8 ms)
✓ should return a 400 if handler is not defined (7 ms)
2025-04-15T08:27:51.8540248Z
PASS src/executions/__tests__/executions.controller.test.ts
ExecutionsController
getOne
✓ should 400 when execution is not a number (25 ms)
getMany
if either status or range provided
✓ should fetch executions per query (4 ms)
✓ should fetch executions per query (2 ms)
✓ should fetch executions per query (2 ms)
✓ should fetch executions per query (1 ms)
if neither status nor range provided
✓ should fetch executions per query (1 ms)
✓ should fetch executions per query (1 ms)
if both status and range provided
✓ should fetch executions per query (2 ms)
stop
✓ should 404 when execution is inaccessible for user (1 ms)
✓ should call ask for an execution to be stopped
2025-04-15T08:27:54.4209557Z
PASS src/metrics/__tests__/prometheus-metrics.service.unmocked.test.ts
workflow_success_total
✓ support workflow id labels (67 ms)
✓ support a custom prefix (3 ms)
Active workflow count
✓ should prioritize cached value (7 ms)
✓ should query value from database if cache misses (2 ms)
2025-04-15T08:27:56.7403695Z
PASS src/shutdown/__tests__/shutdown.service.test.ts
ShutdownService
shutdown
✓ should signal shutdown (5 ms)
✓ should signal shutdown in the priority order (2 ms)
✓ should throw error if shutdown is already in progress (12 ms)
✓ should report error if component shutdown fails (2 ms)
waitForShutdown
✓ should wait for shutdown (1 ms)
✓ should throw error if app is not shutting down (1 ms)
isShuttingDown
✓ should return true if app is shutting down
✓ should return false if app is not shutting down (1 ms)
validate
✓ should throw error if component is not registered with the DI container (1 ms)
✓ should throw error if component is missing the shutdown method (2 ms)
2025-04-15T08:27:59.1785528Z
PASS test/integration/collaboration/collaboration.service.test.ts (20.854 s)
CollaborationService
workflow opened message
✓ should emit collaboratorsChanged after workflowOpened (38 ms)
✓ should not emit collaboratorsChanged if user don't have access to the workflow (5 ms)
workflow closed message
✓ should not emit collaboratorsChanged after workflowClosed when there are no active users (15 ms)
✓ should emit collaboratorsChanged after workflowClosed when there are active users (26 ms)
✓ should not emit collaboratorsChanged if user don't have access to the workflow (12 ms)
2025-04-15T08:28:01.8448381Z
PASS src/services/__tests__/hooks.service.test.ts
HooksService
✓ hooksService.inviteUsers should call userService.inviteUsers (6 ms)
✓ hooksService.issueCookie should call authService.issueCookie (1 ms)
✓ hooksService.findOneUser should call authUserRepository.findOne (1 ms)
✓ hooksService.saveUser should call userRepository.save
✓ hooksService.updateSettings should call settingRepository.update (1 ms)
✓ hooksService.workflowsCount should call workflowRepository.count
✓ hooksService.credentialsCount should call credentialRepository.count
✓ hooksService.settingsCount should call settingsRepository.count
✓ hooksService.authMiddleware should call authService.authMiddleware
✓ hooksService.dbCollections should return valid repositories (2 ms)
✓ hooksService.getRudderStackClient (1 ms)
2025-04-15T08:28:04.7993821Z
PASS src/execution-lifecycle/__tests__/restore-binary-data-id.test.ts
on filesystem-v2 mode
✓ should restore if binary data ID is missing execution ID (8 ms)
✓ should do nothing if binary data ID is not missing execution ID (1 ms)
✓ should do nothing if no binary data ID (1 ms)
✓ should do nothing on itemless case (1 ms)
✓ should do nothing if data is undefined (1 ms)
✓ should do nothing if workflow execution mode is not `webhook` (1 ms)
✓ should ignore error thrown on renaming (2 ms)
on s3 mode
✓ should restore if binary data ID is missing execution ID (1 ms)
✓ should do nothing if binary data ID is not missing execution ID
✓ should do nothing if no binary data ID
✓ should do nothing on itemless case (1 ms)
✓ should do nothing if data is undefined (2 ms)
✓ should do nothing if workflow execution mode is not `webhook`
✓ should ignore error thrown on renaming (1 ms)
on default mode
✓ should do nothing (1 ms)
2025-04-15T08:28:04.8007799Z
PASS src/executions/__tests__/parse-range-query.middleware.test.ts
`parseRangeQuery` middleware
errors
✓ should fail on invalid JSON (22 ms)
✓ should fail on invalid schema (7 ms)
filter
✓ should parse status and mode fields (2 ms)
✓ should parse date-related fields (6 ms)
✓ should parse ID-related fields (2 ms)
✓ should parse `projectId` field (1 ms)
✓ should delete invalid fields (2 ms)
range
✓ should parse first and last IDs (1 ms)
✓ should parse limit (1 ms)
✓ should default limit to 20 if absent (1 ms)
2025-04-15T08:28:08.9076810Z
PASS test/integration/services/project.service.test.ts (20.571 s)
ProjectService
addUser
✓ creates a relation between the user and the project using the role project:viewer (35 ms)
✓ creates a relation between the user and the project using the role project:admin (15 ms)
✓ creates a relation between the user and the project using the role project:editor (14 ms)
✓ creates a relation between the user and the project using the role project:personalOwner (13 ms)
✓ changes the role the user has in the project if the user is already part of the project, instead of creating a new relationship (24 ms)
getProjectWithScope
✓ should return the project if the user has the role project:admin and wants the scope workflow:list (18 ms)
✓ should return the project if the user has the role project:admin and wants the scope workflow:create (14 ms)
✓ should return the project if the user has the role project:viewer and wants the scope workflow:create (13 ms)
✓ should return the project if the user has the role project:viewer and wants the scope credential:create (12 ms)
✓ should not return the project if the user is not part of it (9 ms)
2025-04-15T08:28:15.2470711Z
PASS src/__tests__/credentials-overwrites.test.ts
CredentialsOverwrites
constructor
✓ should parse and set overwrite data from config (10 ms)
setData
✓ should reset resolvedTypes when setting new data (1 ms)
applyOverwrite
✓ should apply overwrites only for empty fields (1 ms)
✓ should return original data if no overwrites exist (1 ms)
getOverwrites
✓ should return undefined for unrecognized credential type (1 ms)
✓ should cache resolved types (1 ms)
✓ should merge overwrites from parent types (2 ms)
2025-04-15T08:28:17.3387846Z
PASS src/controllers/__tests__/owner.controller.test.ts
OwnerController
setupOwner
✓ should throw a BadRequestError if the instance owner is already setup (29 ms)
✓ should setup the instance owner successfully (5 ms)
dismissBanner
✓ should not call dismissBanner if no banner is provided (1 ms)
✓ should call dismissBanner with the correct banner name
2025-04-15T08:28:20.4335184Z
PASS test/integration/credentials-helper.test.ts (20.759 s)
CredentialsHelper
credentialOwnedBySuperUsers
✓ owners are super users (31 ms)
✓ admins are super users (13 ms)
✓ owners need to own the credential (11 ms)
✓ admins need to own the credential (12 ms)
✓ members are no super users (10 ms)
✓ credential in team project with instance owner as an admin can use external secrets (21 ms)
✓ credential in team project with instance admin as an admin can use external secrets (16 ms)
✓ credential in team project with instance owner as an editor cannot use external secrets (15 ms)
✓ credential in team project with instance admin as an editor cannot use external secrets (13 ms)
✓ credential in team project with no instance admin or owner as part of the project cannot use external secrets (10 ms)
2025-04-15T08:28:22.8409756Z
PASS src/execution-lifecycle/__tests__/save-execution-progress.test.ts
saveExecutionProgress
✓ should not try to update non-existent executions (7 ms)
✓ should handle DB errors on execution lookup (2 ms)
✓ should handle DB errors when updating the execution (1 ms)
✓ should not try to update finished executions
✓ should populate `.data` when it is missing (2 ms)
✓ should augment `.data` if it already exists (1 ms)
✓ should set last executed node correctly
2025-04-15T08:28:23.5551231Z
PASS test/integration/security-audit/database-risk-reporter.test.ts (21.36 s)
✓ should report expressions in queries (108 ms)
✓ should report expressions in query params (14 ms)
✓ should report unused query params (11 ms)
✓ should not report non-database node (5 ms)
2025-04-15T08:28:30.5038718Z
PASS test/integration/binary-data.api.test.ts (23.813 s)
GET /binary-data
should reject on missing or invalid binary data ID
✓ on request to view (58 ms)
✓ on request to download (15 ms)
should return binary data [filesystem]
✓ on request to view (11 ms)
✓ on request to download (8 ms)
should handle non-ASCII filename [filesystem]
✓ on request to download (8 ms)
should return 404 on file not found [filesystem]
✓ on request to view (7 ms)
✓ on request to download (9 ms)
should return binary data [s3]
✓ on request to view (7 ms)
✓ on request to download (7 ms)
should return 404 on file not found [s3]
✓ on request to view (8 ms)
✓ on request to download (6 ms)
2025-04-15T08:28:46.8380554Z
PASS test/integration/role.api.test.ts (23.858 s)
GET /roles/
✓ should return all role categories (38 ms)
✓ should return fixed global roles (11 ms)
✓ should return fixed project roles (10 ms)
✓ should return fixed credential sharing roles (8 ms)
✓ should return fixed workflow sharing roles (9 ms)
2025-04-15T08:28:47.6523352Z
PASS src/push/__tests__/websocket.push.test.ts
WebSocketPush
✓ can add a connection (8 ms)
✓ closes a connection (1 ms)
✓ sends data to one connection (2 ms)
✓ sends data to all connections (1 ms)
✓ pings all connections (2 ms)
✓ sends data to all users connections (1 ms)
✓ emits message event when connection receives data (3 ms)
✓ emits doesn' emit message for client heartbeat (1 ms)
2025-04-15T08:28:49.7018364Z
PASS src/external-secrets.ee/__tests__/external-secrets-manager.ee.test.ts
External Secrets Manager
✓ should get secret (8 ms)
✓ should not throw errors during init (3 ms)
✓ should not throw errors during shutdown (2 ms)
✓ should save provider settings (3 ms)
✓ should call provider update functions on a timer (4 ms)
✓ should not call provider update functions if the not licensed (1 ms)
✓ should not call provider update functions if the provider has an error (1 ms)
✓ should reinitialize a provider when save provider settings (2 ms)
2025-04-15T08:28:51.0433627Z
PASS src/execution-lifecycle/__tests__/to-save-settings.test.ts
failed production executions
✓ should favor workflow settings over defaults (7 ms)
✓ should fall back to default if no workflow setting (7 ms)
successful production executions
✓ should favor workflow settings over defaults (1 ms)
✓ should fall back to default if no workflow setting (1 ms)
manual executions
✓ should favor workflow setting over default (1 ms)
✓ should favor fall back to default if workflow setting is explicit default (1 ms)
✓ should fall back to default if no workflow setting (1 ms)
execution progress
✓ should favor workflow setting over default (1 ms)
✓ should favor fall back to default if workflow setting is explicit default (1 ms)
✓ should fall back to default if no workflow setting
2025-04-15T08:28:52.5642151Z
PASS test/integration/database/repositories/project.repository.test.ts (21.956 s)
ProjectRepository
getPersonalProjectForUser
✓ returns the personal project (46 ms)
✓ does not return non personal projects (19 ms)
getPersonalProjectForUserOrFail
✓ returns the personal project (16 ms)
✓ does not return non personal projects (45 ms)
update personal project name
✓ do not pass a User instance with circular references into `UserRepository.create` (43 ms)
2025-04-15T08:28:52.6734029Z
PASS src/webhooks/__tests__/webhook-form-data.test.ts
webhook-form-data
createMultiFormDataParser
✓ should parse fields from the multipart form data (66 ms)
✓ should parse text/plain file from the multipart form data (15 ms)
✓ should parse multiple files and fields from the multipart form data (11 ms)
✓ should ignore file that is too large (8 ms)
2025-04-15T08:28:55.6506803Z
PASS test/integration/license.api.test.ts (25.876 s)
GET /license
✓ should return license information to the instance owner (57 ms)
✓ should return license information to a regular user (14 ms)
POST /license/enterprise/request_trial
✓ should work for instance owner (41 ms)
✓ does not work for regular users (12 ms)
POST /license/activate
✓ should work for instance owner (14 ms)
✓ does not work for regular users (13 ms)
✓ errors out properly (30 ms)
POST /license/renew
✓ should work for instance owner (12 ms)
✓ does not work for regular users (11 ms)
✓ errors out properly (12 ms)
2025-04-15T08:29:17.1730155Z
PASS test/integration/controllers/oauth/oauth2.api.test.ts (25.496 s)
OAuth2 API
✓ should return a valid auth URL when the auth flow is initiated (132 ms)
✓ should fail on auth when callback is called as another user (60 ms)
✓ should handle a valid callback without auth (99 ms)
2025-04-15T08:29:18.4095510Z
PASS src/task-runners/__tests__/task-runner-process.test.ts
TaskRunnerProcess
constructor
✓ should throw if runner mode is external (21 ms)
✓ should register listener for `runner:failed-heartbeat-check` event (2 ms)
✓ should register listener for `runner:timed-out-during-task` event
start
✓ should propagate PATH from env as is (2 ms)
✓ should propagate NODE_FUNCTION_ALLOW_BUILTIN from env as is (1 ms)
✓ should propagate NODE_FUNCTION_ALLOW_EXTERNAL from env as is (1 ms)
✓ should propagate N8N_SENTRY_DSN from env as is (1 ms)
✓ should propagate N8N_VERSION from env as is (1 ms)
✓ should propagate ENVIRONMENT from env as is (3 ms)
✓ should propagate DEPLOYMENT_NAME from env as is (2 ms)
✓ should propagate NODE_PATH from env as is (1 ms)
✓ should propagate GENERIC_TIMEZONE from env as is (1 ms)
✓ should pass NODE_OPTIONS env if maxOldSpaceSize is configured (1 ms)
✓ should not pass NODE_OPTIONS env if maxOldSpaceSize is not configured (10 ms)
✓ should use --disallow-code-generation-from-strings and --disable-proto=delete flags (2 ms)
2025-04-15T08:29:20.0216348Z
PASS test/integration/credentials/credentials.service.test.ts (25.194 s)
credentials service
replaceCredentialContentsForSharee
✓ should replace the contents of the credential for sharee (25 ms)
✓ should replace the contents of the credential for project viewer (42 ms)
✓ should not replace the contents of the credential for project editor (27 ms)
2025-04-15T08:29:21.1176709Z
PASS src/sso.ee/saml/__tests__/saml.service.ee.test.ts
SamlService
getAttributesFromLoginResponse
✓ throws when any attribute is missing (150 ms)
init
✓ calls `reset` if an InvalidSamlMetadataError is thrown (2 ms)
✓ calls `reset` if a SyntaxError is thrown (1 ms)
✓ does not call reset and rethrows if another error is thrown (2 ms)
✓ does not call reset if no error is thrown (1 ms)
reset
✓ disables saml login and deletes the saml `features.saml` key in the db (2 ms)
2025-04-15T08:29:21.7241471Z
PASS src/__tests__/external-hooks.test.ts
ExternalHooks
init()
✓ should not load hooks if no external hook files are configured (6 ms)
✓ should throw an error if hook file cannot be loaded (13 ms)
✓ should successfully load hooks from valid hook file (3 ms)
run()
✓ should not throw if no hooks are registered (1 ms)
✓ should execute registered hooks (1 ms)
✓ should report error if hook execution fails (2 ms)
2025-04-15T08:29:23.3221827Z
PASS src/credentials/__tests__/credentials.service.test.ts
CredentialsService
redact
✓ should redact sensitive values (5 ms)
decrypt
✓ should redact sensitive values by default (2 ms)
✓ should return sensitive values if `includeRawData` is true (1 ms)
✓ should return return an empty object if decryption fails (2 ms)
2025-04-15T08:29:26.6197083Z
PASS test/integration/workflows/workflow-sharing.service.test.ts (23.741 s)
WorkflowSharingService
getSharedWorkflowIds
✓ should show all workflows to owners (40 ms)
✓ should show shared workflows to users (38 ms)
✓ should show workflows that the user has access to through a team project they are part of (17 ms)
✓ should show workflows that the user has update access to (29 ms)
2025-04-15T08:29:45.1033915Z
PASS test/integration/public-api/variables.test.ts (26.191 s)
Variables in Public API
GET /variables
✓ if licensed, should return all variables with pagination (426 ms)
✓ if not licensed, should reject (28 ms)
POST /variables
✓ if licensed, should create a new variable (39 ms)
✓ if not licensed, should reject (21 ms)
DELETE /variables/:id
✓ if licensed, should delete a variable (64 ms)
✓ if not licensed, should reject (22 ms)
2025-04-15T08:29:49.7639254Z
PASS src/services/__tests__/ai.service.test.ts
AiService
init
✓ should not initialize client if AI assistant is not enabled (8 ms)
✓ should initialize client when AI assistant is enabled (2 ms)
chat
✓ should call client chat method after initialization (2 ms)
✓ should throw error if client is not initialized (13 ms)
applySuggestion
✓ should call client applySuggestion (2 ms)
✓ should throw error if client is not initialized (1 ms)
askAi
✓ should call client askAi method after initialization (9 ms)
✓ should throw error if client is not initialized (1 ms)
2025-04-15T08:29:53.2233361Z
PASS test/integration/executions.controller.test.ts (26.434 s)
GET /executions
✓ only returns executions of shared workflows if sharing is enabled (193 ms)
✓ should return a scopes array for each execution (50 ms)
GET /executions/:id
✓ project viewers can view executions for workflows in the project (93 ms)
✓ only returns executions of shared workflows if sharing is enabled (68 ms)
POST /executions/delete
✓ should hard-delete an execution (58 ms)
2025-04-15T08:29:53.3096393Z
PASS src/executions/pre-execution-checks/__tests__/credentials-permission-checker.test.ts
CredentialsPermissionChecker
✓ should throw if a node has a credential without an id (15 ms)
✓ should throw if a credential is not accessible (2 ms)
✓ should not throw an error if the workflow has no credentials (1 ms)
✓ should not throw an error if all credentials are accessible (1 ms)
✓ should skip credential checks if the home project owner has global scope (1 ms)
2025-04-15T08:29:56.3224315Z
PASS src/decorators/__tests__/controller.registry.test.ts
ControllerRegistry
Rate limiting
✓ should not rate-limit by default (83 ms)
✓ should rate-limit when configured (26 ms)
Authorization
✓ should not require auth if configured to skip (7 ms)
✓ should require auth by default (12 ms)
License checks
✓ should disallow when feature is missing (5 ms)
✓ should allow when feature is available (5 ms)
Args
✓ should pass in correct args to the route handler (6 ms)
2025-04-15T08:29:59.0396826Z
PASS src/__tests__/credential-types.test.ts
CredentialTypes
getByName
✓ Should throw error when calling invalid credential name (18 ms)
✓ Should return correct credential type for valid name (1 ms)
recognizes
✓ Should recognize credential type that exists in knownCredentials (1 ms)
✓ Should recognize credential type that exists in loadedCredentials (1 ms)
✓ Should not recognize unknown credential type
getSupportedNodes
✓ Should return supported nodes for known credential type (2 ms)
✓ Should return empty array for unknown credential type supported nodes (1 ms)
getParentTypes
✓ Should return parent types for credential type with extends (2 ms)
✓ Should return empty array for credential type without extends (1 ms)
✓ Should return empty array for unknown credential type parent types
2025-04-15T08:29:59.0480288Z
PASS test/integration/webhooks.test.ts
WebhookServer
CORS
for webhook
✓ should handle preflight requests (181 ms)
✓ should handle regular requests (9 ms)
for webhookTest
✓ should handle preflight requests (6 ms)
✓ should handle regular requests (6 ms)
Routing for Waiting Webhooks
✓ should handle URLs without suffix (5 ms)
✓ should handle URLs with suffix (4 ms)
2025-04-15T08:30:02.0555299Z
PASS src/controllers/__tests__/user-settings.controller.test.ts
UserSettingsController
NPS Survey
✓ updates user settings, setting response state to done (5 ms)
✓ updates user settings, setting response state to done, ignoring other keys like waitForResponse
✓ updates user settings, setting response state to done, ignoring other keys like ignoredCount (1 ms)
✓ updates user settings, setting response state to done, ignoring other unknown keys (1 ms)
✓ updates user settings, updating ignore count
✓ updates user settings, resetting to waiting state (1 ms)
✓ updates user settings, updating ignore count, ignoring unknown keys (1 ms)
✓ updates user settings, setting response state to done
✓ updates user settings, updating ignore count (1 ms)
✓ throws error when request payload is is missing (9 ms)
✓ throws error when request payload is is undefined (1 ms)
✓ throws error when request payload is is responded but missing lastShownAt (1 ms)
✓ throws error when request payload is is waitingForResponse but missing lastShownAt (1 ms)
✓ throws error when request payload is is waitingForResponse but missing ignoredCount (1 ms)
2025-04-15T08:30:02.4930110Z
PASS src/scaling/__tests__/publisher.service.test.ts
Publisher
constructor
✓ should init Redis client in scaling mode (5 ms)
✓ should not init Redis client in regular mode (1 ms)
shutdown
✓ should disconnect Redis client
publishCommand
✓ should do nothing if not in scaling mode (1 ms)
✓ should publish command into `n8n.commands` pubsub channel (1 ms)
✓ should not debounce `add-webhooks-triggers-and-pollers` (1 ms)
✓ should not debounce `remove-triggers-and-pollers`
publishWorkerResponse
✓ should publish worker response into `n8n.worker-response` pubsub channel
2025-04-15T08:30:05.4284320Z
PASS src/license/__tests__/license.service.test.ts
LicenseService
getLicenseData
✓ should return usage and license data (8 ms)
activateLicense
✓ should handle SCHEMA_VALIDATION error (20 ms)
✓ should handle RESERVATION_EXHAUSTED error (1 ms)
✓ should handle RESERVATION_EXPIRED error (1 ms)
✓ should handle NOT_FOUND error (1 ms)
✓ should handle RESERVATION_CONFLICT error (1 ms)
✓ should handle RESERVATION_DUPLICATE error (1 ms)
renewLicense
✓ on success (1 ms)
✓ on failure (2 ms)
registerCommunityEdition
✓ on success (1 ms)
✓ on failure (2 ms)
2025-04-15T08:30:08.1876081Z
PASS test/integration/owner.api.test.ts (25.89 s)
POST /owner/setup
✓ should create owner and enable isInstanceOwnerSetUp (321 ms)
✓ should create owner with lowercased email (122 ms)
✓ should fail with invalid inputs (31 ms)
2025-04-15T08:30:11.2806452Z
PASS src/task-runners/task-managers/__tests__/task-manager.test.ts
TaskRequester
handleRpc
✓ should handle logNodeOutput rpc call (10 ms)
✓ should handle helpers.assertBinaryData rpc call (1 ms)
✓ should handle helpers.getBinaryDataBuffer rpc call (1 ms)
✓ should handle helpers.prepareBinaryData rpc call (1 ms)
✓ should handle helpers.setBinaryDataBuffer rpc call (1 ms)
✓ should handle helpers.binaryToString rpc call (1 ms)
✓ should handle helpers.httpRequest rpc call (1 ms)
✓ converts any serialized buffer arguments into buffers (1 ms)
errors
✓ sends method not allowed error if method is not in the allow list
✓ sends error if method throws (1 ms)
2025-04-15T08:30:13.8358495Z
PASS src/databases/repositories/__tests__/execution.repository.test.ts
ExecutionRepository
getWaitingExecutions()
✓ on sqlite, should be called with expected args (9 ms)
✓ on postgresdb, should be called with expected args (1 ms)
deleteExecutionsByFilter
✓ should delete binary data (2 ms)
updateExistingExecution
✓ should update execution and data in transaction on sqlite (2 ms)
✓ should update execution and data in transaction on postgresdb (1 ms)
✓ should update execution and data in transaction on mysqldb (2 ms)
2025-04-15T08:30:16.8519048Z
PASS test/integration/workflow-history-manager.test.ts (24.324 s)
Workflow History Manager
✓ should prune on interval (14 ms)
✓ should not prune when not licensed (75 ms)
✓ should not prune when licensed but disabled (25 ms)
✓ should not prune when both prune times are -1 (infinite) (19 ms)
✓ should prune when config prune time is not -1 (infinite) (20 ms)
✓ should prune when license prune time is not -1 (infinite) (18 ms)
✓ should only prune versions older than prune time (39 ms)
2025-04-15T08:30:26.6426220Z
PASS src/environments.ee/source-control/__tests__/source-control.controller.ee.test.ts
SourceControlController
pushWorkfolder
✓ should push workfolder with expected parameters (9 ms)
pullWorkfolder
✓ should pull workfolder with expected parameters (1 ms)
getStatus
✓ should call getStatus with expected parameters (2 ms)
status
✓ should call getStatus with expected parameters (2 ms)
2025-04-15T08:30:31.6975347Z
PASS src/modules/insights/__tests__/insights.controller.test.ts (24.179 s)
InsightsController
getInsightsSummary
✓ should return default insights if no data (8 ms)
✓ should return the insights summary with null deviation if insights exist only for current period (1 ms)
✓ should return the insights summary if insights exist for both periods (1 ms)
2025-04-15T08:30:32.5953082Z
PASS src/push/__tests__/sse.push.test.ts
SSEPush
✓ pings all connections (3 ms)
✓ closes all connections (2 ms)
add
✓ adds a connection (13 ms)
closes a connection
✓ on "end" event (4 ms)
✓ on "close" event (4 ms)
✓ on "finish" event (1 ms)
sends data
✓ to one connection (5 ms)
✓ to all connections (2 ms)
✓ to a specific user (2 ms)
2025-04-15T08:30:34.1203809Z
PASS src/services/__tests__/active-workflows.service.test.ts
ActiveWorkflowsService
getAllActiveIdsInStorage
✓ should filter out any workflow ids that have activation errors (8 ms)
getAllActiveIdsFor
✓ should return all workflow ids when user has full access (2 ms)
✓ should filter out workflow ids that the user does not have access to (2 ms)
getActivationError
✓ should throw a BadRequestError a user does not have access to the workflow id (13 ms)
✓ should return the error when the user has access (1 ms)
2025-04-15T08:30:35.7852997Z
PASS src/workflows/workflow-history.ee/__tests__/workflow-history.service.ee.test.ts
WorkflowHistoryService
saveVersion
✓ should save a new version when workflow history is enabled and nodes and connections are present (6 ms)
✓ should not save a new version when workflow history is disabled (1 ms)
✓ should not save a new version when nodes or connections are missing (1 ms)
✓ should log an error when failed to save workflow history version (1 ms)
2025-04-15T08:30:39.1988513Z
PASS test/integration/commands/reset.cmd.test.ts (26.259 s)
✓ user-management:reset should reset DB to default user state (113 ms)
2025-04-15T08:30:43.3333318Z
PASS src/task-runners/task-broker/auth/__tests__/task-broker-auth.controller.test.ts
TaskBrokerAuthController
createGrantToken
✓ should throw BadRequestError when auth token is missing (13 ms)
✓ should throw ForbiddenError when auth token is invalid (1 ms)
✓ should return rant token when auth token is valid (3 ms)
authMiddleware
✓ should respond with 401 when grant token is missing (2 ms)
✓ should respond with 403 when grant token is invalid (1 ms)
✓ should call next() when grant token is valid (1 ms)
2025-04-15T08:30:45.9307047Z
PASS src/task-runners/task-managers/__tests__/data-request-response-builder.test.ts
DataRequestResponseBuilder
✓ picks only specific properties for additional data (9 ms)
✓ picks only specific properties for workflow (3 ms)
✓ clears nodeExecutionStack, waitingExecution and waitingExecutionSource from runExecutionData (2 ms)
2025-04-15T08:30:48.1613790Z
PASS test/integration/task-runners/task-runner-process.test.ts (9.303 s)
TaskRunnerProcess
✓ should start and connect the task runner (1255 ms)
✓ should stop an disconnect the task runner (1631 ms)
✓ should restart the task runner if it exits (2680 ms)
✓ should work together with restart loop detector (1036 ms)
2025-04-15T08:30:48.6769946Z
PASS src/controllers/__tests__/ai.controller.test.ts
AiController
chat
✓ should handle chat request successfully (10 ms)
✓ should throw InternalServerError if chat fails (11 ms)
applySuggestion
✓ should apply suggestion successfully (2 ms)
✓ should throw InternalServerError if applying suggestion fails (1 ms)
askAi method
✓ should ask AI successfully (2 ms)
✓ should throw InternalServerError if asking AI fails (1 ms)
2025-04-15T08:30:53.2548401Z
PASS src/databases/repositories/__tests__/shared-credentials.repository.test.ts
SharedCredentialsRepository
findCredentialForUser
✓ should allow instance owner access to all credentials (9 ms)
✓ should allow members (2 ms)
✓ should return null when no shared credential is found (1 ms)
2025-04-15T08:30:56.5228227Z
PASS src/task-runners/__tests__/forward-to-logger.test.ts
forwardToLogger
✓ should forward stdout data to logger.info (7 ms)
✓ should forward stderr data to logger.error (1 ms)
✓ should remove trailing newline from stdout (2 ms)
✓ should remove trailing newline from stderr (1 ms)
✓ should forward stderr data to logger.error
✓ should include prefix if provided for stdout (1 ms)
✓ should include prefix if provided for stderr (1 ms)
✓ should make sure there is no duplicate space after prefix for stdout
✓ should make sure there is no duplicate space after prefix for stderr (5 ms)
2025-04-15T08:30:58.8293729Z
PASS test/integration/security-audit/nodes-risk-reporter.test.ts (25.158 s)
✓ should report risky official nodes (103 ms)
✓ should not report non-risky official nodes (20 ms)
✓ should report community nodes (12 ms)
2025-04-15T08:30:59.5228483Z
PASS src/services/__tests__/user.service.test.ts
UserService
toPublic
✓ should remove sensitive properties (7 ms)
✓ should add scopes if requested (2 ms)
✓ should add invite URL if requested (2 ms)
update
✓ should use `save` instead of `update` (3 ms)
2025-04-15T08:31:01.8069503Z
PASS src/controllers/__tests__/api-keys.controller.test.ts
ApiKeysController
createAPIKey
✓ should create and save an API key (10 ms)
getAPIKeys
✓ should return the users api keys redacted (2 ms)
deleteAPIKey
✓ should delete the API key (5 ms)
2025-04-15T08:31:02.8558344Z
PASS src/validators/__tests__/no-xss.validator.test.ts
NoXss
Scripts
✓ should block <script src/> (6 ms)
✓ should block <script>alert('xss')</script> (1 ms)
✓ should block <a href="#">Jack</a>
Names
✓ should allow Johann Strauß (1 ms)
✓ should allow Вагиф Сәмәдоғлу
✓ should allow René Magritte
✓ should allow সুকুমার রায়
✓ should allow མགོན་པོ་རྡོ་རྗེ། (1 ms)
✓ should allow عبدالحليم حافظ
ISO-8601 timestamps
✓ should allow 2022-01-01T00:00:00.000Z (1 ms)
✓ should allow 2022-01-01T00:00:00.000+02:00
Semver versions
✓ should allow 1.0.0
✓ should allow 1.0.0-alpha.1
Miscellaneous strings
✓ should allow CI/CD
Array of strings
✓ should allow array: ["cloud-infrastructure-orchestration","ci-cd","reporting"]
✓ should allow array: ["automationGoalDevops","cloudComputing","containerization"] (1 ms)
✓ should reject array containing invalid string: ["valid-string","<script>alert(\"xss\")</script>","another-valid-string"] (1 ms)
✓ should reject array containing invalid string: ["<img src=\"x\" onerror=\"alert('XSS')\">","valid-string"]
2025-04-15T08:31:05.6274097Z
PASS test/integration/project.service.integration.test.ts (25.646 s)
ProjectService
findRolesInProjects
when user has roles in projects where workflow is accessible
✓ should return roles and project IDs (50 ms)
when user has no roles in projects where workflow is accessible
✓ should return project IDs but no roles (30 ms)
when user has roles in projects where workflow is inaccessible
✓ should return project IDs but no roles (44 ms)
2025-04-15T08:31:14.6151406Z
PASS test/integration/ai/ai.api.test.ts (28.349 s)
POST /ai/free-credits
✓ should create OpenAI managed credential (109 ms)
2025-04-15T08:31:30.4059403Z
PASS test/integration/activation-errors.service.test.ts
ActivationErrorsService
register
✓ should register an activation error for a workflow (7 ms)
deregister
✓ should deregister an activation error for a workflow (1 ms)
get
✓ should retrieve an activation error for a workflow (1 ms)
✓ should return `null` if no activation error found for a workflow
getAll
✓ should retrieve all activation errors (2 ms)
✓ should return an empty object if no activation errors
clearAll()
✓ should clear activation errors (1 ms)
2025-04-15T08:31:32.7785729Z
PASS test/integration/tags.api.test.ts (28.479 s)
POST /tags
✓ should create tag (44 ms)
✓ should not create duplicate tag (79 ms)
✓ should delete tag (13 ms)
✓ should update tag name (28 ms)
✓ should retrieve all tags (15 ms)
✓ should retrieve all tags with with usage count (16 ms)
2025-04-15T08:31:34.3286468Z
PASS src/webhooks/__tests__/test-webhook-registrations.service.test.ts
TestWebhookRegistrationsService
register()
✓ should register a test webhook registration (8 ms)
✓ should skip setting TTL in single-main setup (6 ms)
deregister()
✓ should deregister a test webhook registration (1 ms)
get()
✓ should retrieve a test webhook registration (1 ms)
✓ should return undefined if no such test webhook registration was found (1 ms)
getAllKeys()
✓ should retrieve all test webhook registration keys
getAllRegistrations()
✓ should retrieve all test webhook registrations
deregisterAll()
✓ should deregister all test webhook registrations (1 ms)
toKey()
✓ should convert a test webhook registration to a key
2025-04-15T08:31:35.1776943Z
PASS src/services/__tests__/naming.service.test.ts
NamingService
getUniqueWorkflowName()
✓ should return requested name if already unique (8 ms)
✓ should return requested name suffixed if already existing once
✓ should return requested name with incremented suffix if already suffixed (1 ms)
getUniqueCredentialName()
✓ should return requested name if already unique (1 ms)
✓ should return requested name suffixed if already existing once (1 ms)
✓ should return requested name with incremented suffix if already suffixed (1 ms)
2025-04-15T08:31:38.6777385Z
PASS test/integration/commands/worker.cmd.test.ts (28.739 s)
✓ worker initializes all its components (166 ms)
2025-04-15T08:31:43.5321349Z
PASS src/user-management/email/__tests__/user-management-mailer.test.ts
UserManagementMailer
when SMTP is not configured
✓ should not setup email transport (5 ms)
✓ should not send emails (1 ms)
when SMTP is configured
✓ should setup email transport (1 ms)
✓ should send invitation emails (22 ms)
✓ should send password reset emails (3 ms)
2025-04-15T08:31:46.6936384Z
PASS test/integration/insights/insights.api.test.ts (29.209 s)
GET /insights routes work for owner and admins for server with dashboard license
✓ Call should work and return empty summary for user owner (51 ms)
✓ Call should work and return empty summary for user admin (20 ms)
✓ Call should work and return empty summary for user member (13 ms)
GET /insights routes return 403 for dashboard routes when summary license only
✓ Call should work and return empty summary for user owner (15 ms)
✓ Call should work and return empty summary for user admin (13 ms)
✓ Call should work and return empty summary for user member (13 ms)
GET /insights/by-workflow
✓ Call should work with valid query parameters (9 ms)
✓ Call should return internal server error with invalid pagination query parameters (24 ms)
✓ Call should return internal server error with invalid pagination query parameters (5 ms)
✓ Call should return bad request with invalid sortby query parameters (5 ms)
2025-04-15T08:32:03.7955663Z
PASS test/integration/database/repositories/execution.repository.test.ts (26.646 s)
ExecutionRepository
createNewExecution
✓ should save execution data (38 ms)
✓ should not create execution if execution data insert fails (18 ms)
2025-04-15T08:32:05.5245112Z
PASS src/webhooks/__tests__/waiting-webhooks.test.ts
WaitingWebhooks
✓ should throw NotFoundError if there is no execution to resume (31 ms)
✓ should throw ConflictError if the execution to resume is already running (2 ms)
✓ should throw ConflictError if the execution to resume already finished (3 ms)
✓ should mark as test webhook when execution mode is manual (5 ms)
2025-04-15T08:32:10.5092422Z
PASS src/modules/insights/__tests__/insights.module.test.ts
InsightsModule
backgroundProcess
✓ should start background process if instance is main and leader (9 ms)
✓ should not start background process if instance is main but not leader (1 ms)
✓ should start background process on leader takeover (1 ms)
✓ should stop background process on leader stepdown (2 ms)
2025-04-15T08:32:13.8989296Z
PASS test/integration/license-metrics.repository.test.ts (27.565 s)
LicenseMetricsRepository
getLicenseRenewalMetrics
✓ should return license renewal metrics (111 ms)
✓ should handle zero execution statistics correctly (22 ms)
2025-04-15T08:32:14.4856477Z
PASS src/evaluation.ee/test-runner/__tests__/create-pin-data.ee.test.ts
createPinData
✓ should create pin data from past execution data (7 ms)
✓ should not create pin data for non-existing mocked nodes (1 ms)
✓ should create pin data for all mocked nodes (1 ms)
✓ should return empty object if no mocked nodes are provided
✓ should create pin data for all mocked nodes with renamed nodes
2025-04-15T08:32:17.1536065Z
PASS src/controllers/__tests__/auth.controller.test.ts
AuthController
login
✓ should not validate email in "emailOrLdapLoginId" if LDAP is enabled (7 ms)
2025-04-15T08:32:21.2121908Z
PASS src/concurrency/__tests__/concurrency-queue.test.ts
ConcurrencyQueue
✓ should limit concurrency (10 ms)
✓ should debounce emitting of the `concurrency-check` event (1 ms)
2025-04-15T08:32:23.5741018Z
PASS test/integration/workflows/workflow.service.test.ts (30.029 s)
update()
✓ should remove and re-add to active workflows on `active: true` payload (77 ms)
✓ should remove from active workflows on `active: false` payload (29 ms)
2025-04-15T08:32:34.0119409Z
PASS src/task-runners/task-broker/auth/__tests__/task-broker-auth.service.test.ts
TaskBrokerAuthService
isValidAuthToken
✓ should be valid for the configured token (5 ms)
✓ should be invalid for anything else (1 ms)
createGrantToken
✓ should generate a random token (2 ms)
✓ should store the generated token in cache (1 ms)
tryConsumeGrantToken
✓ should return false for an invalid grant token (1 ms)
✓ should return true for a valid grant token (1 ms)
✓ should return false for a already used grant token (1 ms)
✓ should return false for an expired grant token (310 ms)
2025-04-15T08:32:37.1077476Z
PASS test/integration/commands/update/workflow.test.ts (30.685 s)
✓ update:workflow can activate all workflows (64 ms)
✓ update:workflow can deactivate all workflows (17 ms)
✓ update:workflow can activate a specific workflow (29 ms)
✓ update:workflow can deactivate a specific workflow (14 ms)
2025-04-15T08:32:44.8142038Z
PASS src/external-secrets.ee/providers/__tests__/gcp-secrets-manager.test.ts
GCP Secrets Manager
✓ should update cached secrets (9 ms)
2025-04-15T08:32:47.6379938Z
PASS src/credentials/__tests__/credentials.controller.test.ts
CredentialsController
createCredentials
✓ should create new credentials and emit "credentials-created" (6 ms)
2025-04-15T08:32:52.2105168Z
PASS test/integration/environments/source-control.api.test.ts (31.243 s)
GET /sourceControl/preferences
✓ should return Source Control preferences (35 ms)
✓ should return repo sync status (15 ms)
✓ refreshing key pairsshould return new rsa key (1420 ms)
2025-04-15T08:32:54.9991525Z
PASS src/scaling/__tests__/job-processor.service.test.ts
JobProcessor
✓ should refrain from processing a crashed execution (7 ms)
✓ should use manualExecutionService to process a job in "manual" mode (13 ms)
✓ should use manualExecutionService to process a job in "evaluation" mode (2 ms)
2025-04-15T08:32:56.2883675Z
PASS src/collaboration/__tests__/collaboration.state.test.ts
CollaborationState
addCollaborator
✓ should add workflow user with correct cache key and value (9 ms)
removeCollaborator
✓ should remove workflow user with correct cache key (1 ms)
getCollaborators
✓ should get workflows with correct cache key (1 ms)
✓ should get workflow users that are not expired (9 ms)
2025-04-15T08:32:57.8166555Z
PASS src/decorators/__tests__/on-shutdown.test.ts
OnShutdown
✓ should register a methods that is decorated with OnShutdown (8 ms)
✓ should register multiple methods in the same class (10 ms)
✓ should use the given priority (1 ms)
✓ should throw an error if the decorated member is not a function (14 ms)
✓ should throw if the priority is invalid (6 ms)
2025-04-15T08:32:59.2315978Z
PASS src/evaluation.ee/test-runner/__tests__/evaluation-metrics.ee.test.ts
EvaluationMetrics
✓ should aggregate metrics correctly (7 ms)
✓ should throw when metric value is not number (14 ms)
✓ should handle empty metrics
✓ should handle empty testMetrics (1 ms)
✓ should ignore non-relevant values
✓ should report info on added metrics (2 ms)
2025-04-15T08:33:00.3335802Z
PASS test/integration/database/repositories/workflow.repository.test.ts (27.702 s)
WorkflowRepository
activateAll
✓ should activate all workflows (107 ms)
deactivateAll
✓ should deactivate all workflows (20 ms)
getActiveIds
✓ should return all active workflow IDs when invoked without maxResults (29 ms)
✓ should return a capped number of active workflow IDs when invoked with maxResults (18 ms)
2025-04-15T08:33:05.0460866Z
PASS src/workflows/__tests__/workflows.controller.test.ts
WorkflowsController
getFromUrl
should return workflow data
✓ when the URL points to a valid JSON file (7 ms)
should throw a BadRequestError
✓ when the URL does not point to a valid JSON file (37 ms)
✓ when the data is not a valid n8n workflow JSON (1 ms)
✓ when the data is missing required fields (8 ms)
2025-04-15T08:33:05.2191021Z
PASS src/task-runners/task-broker/__tests__/task-broker-ws-server.test.ts
TaskBrokerWsServer
removeConnection
✓ should close with 1000 status code by default (6 ms)
heartbeat timer
✓ should set up heartbeat timer on server start (1 ms)
✓ should clear heartbeat timer on server stop (1 ms)
sendMessage
✓ should work with a message containing circular references (1 ms)
2025-04-15T08:33:07.6575804Z
PASS src/metrics/__tests__/license-metrics.service.test.ts
LicenseMetricsService
collectPassthroughData
✓ should return an object with active workflow IDs (7 ms)
collectUsageMetrics
✓ should return an array of expected usage metrics (1 ms)
2025-04-15T08:33:10.3849431Z
PASS test/integration/workflow-tag-mapping.repository.integration.test.ts (29.664 s)
WorkflowTagMappingRepository
overwriteTaggings
✓ should overwrite taggings in a workflow (44 ms)
✓ should delete taggings if no tags are provided (14 ms)
2025-04-15T08:33:29.1519030Z
PASS src/evaluation.ee/test-runner/__tests__/format-test-case-execution-input-data.ee.test.ts
formatTestCaseExecutionInputData
✓ should format the test case execution input data correctly (12 ms)
2025-04-15T08:33:31.5053329Z
PASS src/posthog/__tests__/posthog.test.ts
PostHog
✓ inits PostHog correctly (9 ms)
✓ does not initialize or track if diagnostics are not enabled (1 ms)
✓ captures PostHog events (2 ms)
✓ gets feature flags (8 ms)
2025-04-15T08:33:34.4380088Z
PASS test/integration/debug.controller.test.ts (31.324 s)
DebugController
GET /debug/multi-main-setup
✓ should return multi-main setup details (33 ms)
2025-04-15T08:33:36.8285462Z
PASS src/task-runners/__tests__/task-runner-process-restart-loop-detector.test.ts
TaskRunnerProcessRestartLoopDetector
✓ should detect a restart loop if process exits 5 times within 5s (7 ms)
✓ should not detect a restart loop if process exits less than 5 times within 5s (3 ms)
2025-04-15T08:33:39.2454426Z
PASS test/integration/eventbus.test.ts (32.092 s)
GET /eventbus/destination
✓ should fail due to missing authentication (28 ms)
✓ should fail due to missing license when authenticated (16 ms)
POST /eventbus/destination
✓ should fail due to missing authentication (4 ms)
✓ should fail due to missing license when authenticated (9 ms)
DELETE /eventbus/destination
✓ should fail due to missing authentication (4 ms)
✓ should fail due to missing license when authenticated (11 ms)
2025-04-15T08:33:42.7496372Z
PASS src/sso.ee/saml/routes/__tests__/saml.controller.ee.test.ts
Test views
✓ Should render success with template (6 ms)
✓ Should render failure with template (1 ms)
✓ Should render error with template
2025-04-15T08:33:45.8535760Z
PASS src/environments.ee/source-control/__tests__/source-control-git.service.test.ts
SourceControlGitService
getBranches
✓ should support branch names containing slashes (5 ms)
initRepository
when local repo is set up after remote is ready
✓ should track remote (2 ms)
2025-04-15T08:33:48.3796575Z
PASS src/task-runners/__tests__/sliding-window-signal.test.ts
SlidingWindowSignal
✓ should return the last signal if within window size (7 ms)
✓ should return null if there is no signal within the window (3 ms)
✓ should return null if "exit" event is not emitted before timeout (1 ms)
✓ should return the signal emitted on "exit" event before timeout (1 ms)
2025-04-15T08:33:50.5872661Z
PASS src/services/cache/__tests__/cache-mock.service.test.ts
CacheService (Mock)
should prevent use of empty keys
✓ get (8 ms)
✓ getMany (1 ms)
✓ set (2 ms)
✓ setMany (2 ms)
✓ delete
✓ deleteMany
2025-04-15T08:33:52.9661913Z
PASS src/modules/insights/database/entities/__tests__/insights-raw.test.ts (29.817 s)
Insights Raw Entity
✓ `success` can be serialized and deserialized correctly (9 ms)
✓ `failure` can be serialized and deserialized correctly (1 ms)
✓ `runtime_ms` can be serialized and deserialized correctly (1 ms)
✓ `time_saved_min` can be serialized and deserialized correctly (1 ms)
✓ `timestamp` can be serialized and deserialized correctly (2 ms)
✓ timestamp uses the correct default value (67 ms)
2025-04-15T08:34:04.4830023Z
PASS src/services/__tests__/jwt.service.test.ts
JwtService
secret initialization
✓ should read the secret from config, when set (7 ms)
✓ should derive the secret from encryption key when not set in config (1 ms)
with a secret set
✓ should sign (3 ms)
✓ should decode and verify payload (2 ms)
✓ should throw an error on verify if the token is expired (9 ms)
2025-04-15T08:34:06.9581025Z
PASS test/integration/security-audit/filesystem-risk-reporter.test.ts (29.437 s)
✓ should report filesystem interaction nodes (90 ms)
✓ should not report non-filesystem-interaction node (12 ms)
2025-04-15T08:34:08.9091997Z
PASS src/external-secrets.ee/providers/__tests__/azure-key-vault.test.ts
AzureKeyVault
✓ should update cached secrets (121 ms)
2025-04-15T08:34:09.1865999Z
PASS src/executions/__tests__/execution-data.service.test.ts
ExecutionDataService
generateFailedExecutionFromError
✓ should generate a failed execution with error details (17 ms)
✓ should generate a failed execution without node details if node is undefined (1 ms)
2025-04-15T08:34:11.7151781Z
PASS src/task-runners/task-broker/__tests__/task-broker-server.test.ts
TaskBrokerServer
handleUpgradeRequest
✓ should close WebSocket when response status code is > 200 (11 ms)
✓ should not close WebSocket when response status code is 200 (2 ms)
2025-04-15T08:34:11.9905394Z
PASS src/task-runners/errors/__tests__/task-runner-disconnected-error.test.ts
TaskRunnerDisconnectedError
✓ should have the correct default error message (6 ms)
✓ should have the error level set to "error"
✓ should set the correct description for non-cloud deployments (1 ms)
✓ should set the correct description for cloud deployments (1 ms)
2025-04-15T08:34:14.3435824Z
PASS src/databases/repositories/__tests__/workflow-statistics.test.ts
insertWorkflowStatistics
✓ Successfully inserts data when it is not yet present (8 ms)
✓ Does not insert when data is present (1 ms)
✓ throws an error when insertion fails (1 ms)
2025-04-15T08:34:15.0335060Z
PASS src/modules/__tests__/modules.config.test.ts
ModulesConfig
✓ should initialize with insights modules if no environment variable is set (8 ms)
✓ should parse valid module names from environment variable (1 ms)
✓ should disable valid module names from environment variable (1 ms)
✓ should throw UnexpectedError for invalid module names (29 ms)
✓ should throw UnexpectedError if any module is both enabled and disabled (1 ms)
✓ should throw UnexpectedError if any enabled module name is invalid (1 ms)
✓ should throw UnexpectedError if any disabled module name is invalid (1 ms)
2025-04-15T08:34:16.8556664Z
PASS src/__tests__/utils.test.ts
shouldAssignExecuteMethod
✓ should return true when node has no execute, poll, trigger, webhook (unless declarative), or methods (6 ms)
✓ should return false when node has execute (1 ms)
✓ should return false when node has poll
✓ should return false when node has trigger
✓ should return false when node has webhook and is not declarative
✓ should return true when node has webhook but is declarative (1 ms)
✓ should return false when node has methods
2025-04-15T08:34:17.6091020Z
PASS src/sso.ee/saml/__tests__/saml-helpers.test.ts
sso/saml/samlHelpers
updateUserFromSamlAttributes
✓ does not user `Repository.update`, but `Repository.save` instead (6 ms)
2025-04-15T08:34:19.9768294Z
PASS test/integration/task-runners/task-runner-module.external.test.ts
TaskRunnerModule in external mode
start
✓ should throw if the task runner is disabled (18 ms)
✓ should throw if auth token is missing (11 ms)
✓ should start the task runner (398 ms)
✓ should use DefaultTaskRunnerDisconnectAnalyzer (1 ms)
2025-04-15T08:34:23.2534986Z
PASS test/integration/services/workflow-static-data.service.test.ts (30.358 s)
WorkflowStaticDataService
✓ should not change workflow updatedAt when calling saveStaticData (26 ms)
✓ should not change workflow updatedAt when calling saveStaticDataById (5 ms)
2025-04-15T08:34:23.5457594Z
PASS src/modules/insights/__tests__/insights.pre-init.test.ts
InsightsModulePreInit
✓ should return false if instance type is not "main" (5 ms)
✓ should return false if database type is "sqlite" and poolSize is < 1 (1 ms)
✓ should return true if instance type is "main" and database is not sqlite
✓ should return true if instance type is "main" and database is not sqlite
✓ should return true if instance type is "main" and database is not sqlite (1 ms)
✓ should return true if instance type is "main" and sqlite poolSize is >= 1
2025-04-15T08:34:25.7871407Z
PASS src/controllers/__tests__/translation.controller.test.ts
TranslationController
getCredentialTranslation
✓ should throw 400 on invalid credential types (20 ms)
✓ should return translation json on valid credential types (2 ms)
2025-04-15T08:34:26.8047968Z
PASS src/errors/response-errors/__tests__/webhook-not-found.error.test.ts
utils test webhookNotFoundErrorMessage
✓ should return a message with path and method (7 ms)
✓ should return a message with path
✓ should return a message with method with tip (1 ms)
✓ should return a message with method with tip (1 ms)
✓ should return a message with method with tip (1 ms)
2025-04-15T08:34:29.3846813Z
PASS test/integration/auth.mw.test.ts (33.678 s)
Auth Middleware
Routes requiring Authentication
✓ patch /me should return 401 Unauthorized if no cookie (26 ms)
✓ patch /me/password should return 401 Unauthorized if no cookie (4 ms)
✓ post /me/survey should return 401 Unauthorized if no cookie (3 ms)
✓ post /invitations should return 401 Unauthorized if no cookie (4 ms)
✓ delete /users/123 should return 401 Unauthorized if no cookie (4 ms)
Routes requiring Authorization
✓ post /invitations should return 403 Forbidden for member (14 ms)
✓ delete /users/123 should return 403 Forbidden for member (8 ms)
2025-04-15T08:34:51.4743908Z
PASS src/scaling/__tests__/subscriber.service.test.ts
Subscriber
constructor
✓ should init Redis client in scaling mode (9 ms)
✓ should not init Redis client in regular mode
shutdown
✓ should disconnect Redis client (2 ms)
subscribe
✓ should subscribe to pubsub channel (1 ms)
2025-04-15T08:34:54.1062077Z
PASS src/databases/repositories/__tests__/credentials.repository.test.ts
findMany
✓ return `data` property if `includeData:true` and select is using the record syntax (5 ms)
✓ return `data` property if `includeData:true` and select is using the record syntax
2025-04-15T08:34:57.0042020Z
PASS test/integration/user.repository.test.ts (31.63 s)
UserRepository
countUsersByRole()
✓ should return the number of users in each role (68 ms)
createUserWithProject()
✓ should create personal project for a user (16 ms)
2025-04-15T08:34:57.6523359Z
PASS src/services/__tests__/url.service.test.ts
UrlService
getInstanceBaseUrl
✓ should set URL from N8N_EDITOR_BASE_URL (8 ms)
✓ should set URL from WEBHOOK_URL (2 ms)
✓ should trim quotes when setting URL from N8N_EDITOR_BASE_URL (1 ms)
✓ should trim quotes when setting URL from WEBHOOK_URL (1 ms)
2025-04-15T08:34:59.1663332Z
PASS test/integration/task-runners/task-runner-server.test.ts
TaskBrokerServer
/healthz
✓ should return 200 (32 ms)
/runners/_ws
✓ should return 429 when too many requests are made (29 ms)
/runners/auth
✓ should return 429 when too many requests are made (36 ms)
2025-04-15T08:35:01.1043981Z
PASS test/integration/task-runners/task-broker-server.test.ts
TaskBrokerServer
/healthz
✓ should return 200 (24 ms)
/runners/_ws
✓ should return 429 when too many requests are made (26 ms)
/runners/auth
✓ should return 429 when too many requests are made (23 ms)
2025-04-15T08:35:02.0918704Z
PASS test/integration/services/execution-metadata.service.test.ts (33.408 s)
ProjectService
save
✓ should deduplicate entries by exeuctionId and key, keeping the latest one (44 ms)
2025-04-15T08:35:02.9845196Z
PASS src/workflows/workflow-history.ee/__tests__/workflow-history-helper.ee.test.ts
getWorkflowHistoryPruneTime
✓ should return -1 (infinite) if config and license are -1 (6 ms)
✓ should return config time if license is infinite and config is not (1 ms)
✓ should return license time if config is infinite and license is not (1 ms)
✓ should return lowest of config and license time if both are not -1
2025-04-15T08:35:06.3469384Z
PASS src/controllers/__tests__/users.controller.test.ts
UsersController
changeGlobalRole
✓ should emit event user-changed-role (6 ms)
2025-04-15T08:35:06.7611339Z
PASS src/services/__tests__/password.utility.test.ts
PasswordUtility
hash()
✓ should hash a plaintext password (134 ms)
compare()
✓ should return true on match (204 ms)
✓ should return false on mismatch (200 ms)
2025-04-15T08:35:09.7504137Z
PASS src/services/__tests__/orchestration.service.test.ts
Orchestration Service
✓ should initialize (5 ms)
2025-04-15T08:35:14.0419093Z
PASS src/ldap.ee/__tests__/helpers.test.ts
Ldap/helpers
updateLdapUserOnLocalDb
✓ does not use `Repository.update`, but `Repository.save` instead (7 ms)
2025-04-15T08:35:17.2559327Z
PASS src/evaluation.ee/test-runner/__tests__/get-test-run-final-result.ee.test.ts
getTestRunFinalResult
✓ should return success if all test cases are successful (7 ms)
✓ should return error if at least one test case is errored (1 ms)
✓ should return warning if at least one test case is warned (1 ms)
✓ should return error if there are errors and warnings
2025-04-15T08:35:19.5096090Z
PASS src/evaluation.ee/test-runner/__tests__/get-start-node.ee.test.ts
getPastExecutionStartNode
✓ should return the start node of the past execution (12 ms)
✓ should return the start node of the past execution with multiple triggers
✓ should return the start node of the past execution with multiple triggers - chat trigger (1 ms)
2025-04-15T08:35:21.8566888Z
PASS test/integration/cta.service.test.ts (31.973 s)
CtaService
getBecomeCreatorCta()
✓ should return false if user has 0 active workflows with 0 successful production executions (21 ms)
✓ should return false if user has 2 active workflows with 5 successful production executions (31 ms)
✓ should return false if user has 3 active workflows with 4 successful production executions (25 ms)
✓ should return true if user has 3 active workflows with 5 successful production executions (23 ms)
2025-04-15T08:35:33.3323246Z
PASS test/integration/middlewares/body-parser.test.ts
bodyParser
✓ should handle uncompressed data (38 ms)
✓ should handle gzip data (8 ms)
✓ should handle deflate data (6 ms)
2025-04-15T08:35:36.0615289Z
PASS src/databases/entities/__tests__/user.entity.test.ts
User Entity
JSON.stringify
✓ should not serialize sensitive data (6 ms)
createPersonalProjectName
✓ given fistName: Nathan, lastName: Nathaniel and email: nathan@nathaniel.n8n this gives the projectName: "Nathan Nathaniel <nathan@nathaniel.n8n>" (1 ms)
✓ given fistName: undefined, lastName: Nathaniel and email: nathan@nathaniel.n8n this gives the projectName: "<nathan@nathaniel.n8n>"
✓ given fistName: Nathan, lastName: undefined and email: nathan@nathaniel.n8n this gives the projectName: "<nathan@nathaniel.n8n>"
✓ given fistName: undefined, lastName: undefined and email: nathan@nathaniel.n8n this gives the projectName: "<nathan@nathaniel.n8n>"
✓ given fistName: undefined, lastName: undefined and email: undefined this gives the projectName: "Unnamed Project" (1 ms)
✓ given fistName: Nathan, lastName: Nathaniel and email: undefined this gives the projectName: "Unnamed Project"
2025-04-15T08:35:38.5393840Z
PASS test/integration/workflows/workflows.controller-with-active-workflow-manager.ee.test.ts (33.236 s)
PUT /:workflowId/transfer
✓ can transfer an active workflow (118 ms)
2025-04-15T08:35:39.7800912Z
PASS test/integration/task-runners/task-runner-module.internal.test.ts
TaskRunnerModule in internal mode
start
✓ should throw if the task runner is disabled (15 ms)
✓ should start the task runner (463 ms)
✓ should use InternalTaskRunnerDisconnectAnalyzer (1 ms)
2025-04-15T08:35:41.4156004Z
PASS src/utils/__tests__/object-to-error.test.ts
objectToError
node error handling
✓ should create `NodeOperationError` when node is found (11 ms)
✓ should create `Error` when node is not found (2 ms)
2025-04-15T08:35:42.3557901Z
PASS src/services/__tests__/credentials-tester.service.test.ts
CredentialsTester
✓ should find the OAuth2 credential test for a generic OAuth2 API credential (4 ms)
2025-04-15T08:35:45.9177623Z
PASS src/task-runners/__tests__/node-process-oom-detector.test.ts
NodeProcessOomDetector
✓ should detect an out-of-memory error in a monitored process (1404 ms)
✓ should not detect an out-of-memory error in a process that exits normally (45 ms)
2025-04-15T08:35:50.0681658Z
PASS src/execution-lifecycle/shared/__tests__/shared-hook-functions.test.ts
determineFinalExecutionStatus
✓ should return "error" when resultData.error exists (2 ms)
✓ should return "waiting" when waitTill is defined (1 ms)
When waitTill is not set
✓ should return "canceled" (6 ms)
✓ should return "crashed"
✓ should return "error" (1 ms)
✓ should return "success"
2025-04-15T08:35:53.2648906Z
console.log
Migration "RenameAnalyticsToInsights1741167584277" failed, error: Can't add new command when connection is in closed state
2025-04-15T08:35:54.9367408Z
at Function.log (../../node_modules/.pnpm/@n8n+typeorm@0.3.20-12_@sentry+node@8.52.1_ioredis@5.3.2_mssql@10.0.2_mysql2@3.11.0_pg@_d8e1d9c1918afe722aa00ab5be03d957/node_modules/src/platform/PlatformTools.ts:230:17)
2025-04-15T08:35:54.9369923Z
FAIL src/modules/insights/database/entities/__tests__/insights-by-period.test.ts (32.879 s)
Insights By Period
✕ `time_saved_min` can be serialized and deserialized correctly (5 ms)
✕ `runtime_ms` can be serialized and deserialized correctly (1 ms)
✕ `failure` can be serialized and deserialized correctly
✕ `success` can be serialized and deserialized correctly (1 ms)
✕ `hour` can be serialized and deserialized correctly
✕ `day` can be serialized and deserialized correctly
✕ `week` can be serialized and deserialized correctly
2025-04-15T08:35:54.9697903Z
● Insights By Period › `time_saved_min` can be serialized and deserialized correctly
2025-04-15T08:35:54.9700903Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9703452Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9717781Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9719216Z
● Insights By Period › `runtime_ms` can be serialized and deserialized correctly
2025-04-15T08:35:54.9720428Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9723036Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9729683Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9731480Z
● Insights By Period › `failure` can be serialized and deserialized correctly
2025-04-15T08:35:54.9732653Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9735211Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9742331Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9744264Z
● Insights By Period › `success` can be serialized and deserialized correctly
2025-04-15T08:35:54.9745418Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9747721Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9754505Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9755889Z
● Insights By Period › `hour` can be serialized and deserialized correctly
2025-04-15T08:35:54.9756975Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9759283Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9765950Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9767357Z
● Insights By Period › `day` can be serialized and deserialized correctly
2025-04-15T08:35:54.9768701Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9771077Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9777971Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9779636Z
● Insights By Period › `week` can be serialized and deserialized correctly
2025-04-15T08:35:54.9780793Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:35:54.9783348Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:35:54.9789991Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:35:54.9791399Z
PASS src/utils/__tests__/path-util.test.ts
isContainedWithin
✓ should return true when parent and child paths are the same (4 ms)
✓ should return true for parent /some/parent/folder and child /some/parent/folder/subfolder/file.txt
✓ should return true for parent /some/parent/folder and child /some/parent/folder/../folder/subfolder/file.txt
✓ should return true for parent /some/parent/folder/ and child /some/parent/folder/subfolder/file.txt (1 ms)
✓ should return true for parent /some/parent/folder and child /some/parent/folder/subfolder/
✓ should return false for parent /some/parent/folder and child /some/other/folder/file.txt
✓ should return false for parent /some/parent/folder and child /some/parent/folder_but_not_really (1 ms)
✓ should return false for parent /one/path and child /another/path
2025-04-15T08:35:57.5409469Z
PASS src/services/__tests__/execution-metadata.service.test.ts
ExecutionMetadataService
✓ Execution metadata is saved in a batch (9 ms)
2025-04-15T08:36:00.5534874Z
PASS src/decorators/__tests__/module.test.ts
registerLifecycleHooks
✓ is called when ModuleRegistry.registerLifecycleHooks is called (7 ms)
2025-04-15T08:36:02.9406357Z
PASS src/environments.ee/source-control/__tests__/source-control-preferences.service.ee.test.ts
SourceControlPreferencesService
✓ should class validate correct preferences (9 ms)
2025-04-15T08:36:06.1855398Z
PASS test/integration/commands/license.cmd.test.ts (34.472 s)
✓ license:clear invokes clear() to release any floating entitlements and deletes the license cert from the DB (29 ms)
2025-04-15T08:36:17.0270109Z
PASS src/validators/__tests__/no-url.validator.test.ts
NoUrl
URLs
✓ should block http://google.com (7 ms)
✓ should block www.domain.tld (1 ms)
✓ should block n8n.io (1 ms)
2025-04-15T08:36:19.5028645Z
PASS src/config/__tests__/index.test.ts
userManagement.jwtRefreshTimeoutHours
✓ resets jwtRefreshTimeoutHours to 0 if it's greater than or equal to jwtSessionDurationHours (7 ms)
2025-04-15T08:36:21.6569799Z
PASS test/integration/saml/saml-helpers.test.ts (31.948 s)
sso/saml/samlHelpers
createUserFromSamlAttributes
✓ Creates personal project for user (127 ms)
2025-04-15T08:36:25.4304923Z
PASS test/integration/healthcheck.controller.test.ts (29.66 s)
HealthcheckController
✓ should return ok when DB is connected and migrated (17 ms)
✓ should return error when DB is not connected (4 ms)
2025-04-15T08:36:36.0817555Z
Summary of all failing tests
FAIL src/modules/insights/__tests__/insights.service.test.ts
● Test suite failed to run
2025-04-15T08:36:36.2176936Z
Jest worker encountered 4 child process exceptions, exceeding retry limit
2025-04-15T08:36:36.2178135Z
at ChildProcessWorker.initialize (../../node_modules/.pnpm/jest-worker@29.6.2/node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)
2025-04-15T08:36:36.2180239Z
FAIL src/modules/insights/database/entities/__tests__/insights-by-period.test.ts (32.879 s)
● Insights By Period › `time_saved_min` can be serialized and deserialized correctly
2025-04-15T08:36:36.2265836Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2268002Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2274545Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2276381Z
● Insights By Period › `runtime_ms` can be serialized and deserialized correctly
2025-04-15T08:36:36.2277503Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2279726Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2286101Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2287414Z
● Insights By Period › `failure` can be serialized and deserialized correctly
2025-04-15T08:36:36.2288415Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2290616Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2321101Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2323104Z
● Insights By Period › `success` can be serialized and deserialized correctly
2025-04-15T08:36:36.2324575Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2353340Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2390322Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2392219Z
● Insights By Period › `hour` can be serialized and deserialized correctly
2025-04-15T08:36:36.2393484Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2396101Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2402064Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2403852Z
● Insights By Period › `day` can be serialized and deserialized correctly
2025-04-15T08:36:36.2404816Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2407205Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2422387Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2423950Z
● Insights By Period › `week` can be serialized and deserialized correctly
2025-04-15T08:36:36.2424984Z
thrown: "Exceeded timeout of 30000 ms for a hook.
Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."
2025-04-15T08:36:36.2427179Z
[0m [90m  9 |[39m [36mlet[39m insightsRawRepository[33m:[39m [33mInsightsRawRepository[39m[33m;[39m
[90m 10 |[39m
[31m[1m>[22m[39m[90m 11 |[39m beforeAll([36masync[39m () [33m=>[39m {
[90m    |[39m [31m[1m^[22m[39m
[90m 12 |[39m 	[36mawait[39m testDb[33m.[39minit()[33m;[39m
[90m 13 |[39m 	insightsRawRepository [33m=[39m [33mContainer[39m[33m.[39m[36mget[39m([33mInsightsRawRepository[39m)[33m;[39m
[90m 14 |[39m })[33m;[39m[0m
2025-04-15T08:36:36.2435258Z
at Object.<anonymous> (src/modules/insights/database/entities/__tests__/insights-by-period.test.ts:11:1)
2025-04-15T08:36:36.2436846Z
2025-04-15T08:36:36.2436867Z
Test Suites: 2 failed, 248 passed, 250 total
Tests:       7 failed, 2751 passed, 2758 total
Snapshots:   3 passed, 3 total
Time:        789.678 s
Ran all test suites.
ELIFECYCLE  Command failed with exit code 1.
##[error]Process completed with exit code 1.
Post job cleanup.
ok
mariadb-1  | 2025-04-15 08:23:24+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.5.28+maria~ubu2004 started.
mariadb-1  | 2025-04-15 08:23:24+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
mariadb-1  | 2025-04-15 08:23:24+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.5.28+maria~ubu2004 started.
mariadb-1  | 2025-04-15 08:23:24+00:00 [Note] [Entrypoint]: Initializing database files
mariadb-1  | 2025-04-15 08:23:25+00:00 [Note] [Entrypoint]: Database files initialized
mariadb-1  | 2025-04-15 08:23:25+00:00 [Note] [Entrypoint]: Starting temporary server
mariadb-1  | 2025-04-15 08:23:25+00:00 [Note] [Entrypoint]: Waiting for server startup
mariadb-1  | 2025-04-15  8:23:25 0 [Note] Starting MariaDB 10.5.28-MariaDB-ubu2004 source revision 7eded23be6597b4c485e8cad1538f2ae14541f91 server_uid 72+4ASMvYxproTQgRqIDplDA1XA= as process 101
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Uses event mutexes
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Number of pools: 1
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Using crc32 + pclmulqdq instructions
mariadb-1  | 2025-04-15  8:23:25 0 [Note] mysqld: O_TMPFILE is not supported on /tmp (disabling future attempts)
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Using Linux native AIO
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Initializing buffer pool, total size = 134217728, chunk size = 134217728
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Completed initialization of buffer pool
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: 128 rollback segments are active.
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Creating shared tablespace for temporary tables
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
mariadb-1  | 2025-04-15  8:23:25 0 [Note] InnoDB: 10.5.28 started; log sequence number 45051; transaction id 20
mariadb-1  | 2025-04-15  8:23:25 0 [Note] Plugin 'FEEDBACK' is disabled.
mariadb-1  | 2025-04-15  8:23:25 0 [Note] Reading of all Master_info entries succeeded
mariadb-1  | 2025-04-15  8:23:25 0 [Note] Added new Master_info '' to hash table
mariadb-1  | 2025-04-15  8:23:25 0 [Note] mysqld: ready for connections.
mariadb-1  | Version: '10.5.28-MariaDB-ubu2004'  socket: '/run/mysqld/mysqld.sock'  port: 0  mariadb.org binary distribution
mariadb-1  | 2025-04-15 08:23:26+00:00 [Note] [Entrypoint]: Temporary server started.
mariadb-1  | 2025-04-15 08:23:28+00:00 [Note] [Entrypoint]: Creating database n8n
mariadb-1  | 2025-04-15 08:23:28+00:00 [Note] [Entrypoint]: Securing system users (equivalent to running mysql_secure_installation)
mariadb-1  |
mariadb-1  | 2025-04-15 08:23:28+00:00 [Note] [Entrypoint]: Stopping temporary server
mariadb-1  | 2025-04-15  8:23:28 0 [Note] mysqld (initiated by: unknown): Normal shutdown
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: FTS optimize thread exiting.
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Starting shutdown...
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Buffer pool(s) dump completed at 250415  8:23:28
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Removed temporary tablespace data file: "ibtmp1"
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Shutdown completed; log sequence number 45079; transaction id 21
mariadb-1  | 2025-04-15  8:23:28 0 [Note] Event Scheduler: Purging the queue. 0 events
mariadb-1  | 2025-04-15  8:23:28 0 [Note] mysqld: Shutdown complete
mariadb-1  | 2025-04-15 08:23:28+00:00 [Note] [Entrypoint]: Temporary server stopped
mariadb-1  |
mariadb-1  | 2025-04-15 08:23:28+00:00 [Note] [Entrypoint]: MariaDB init process done. Ready for start up.
mariadb-1  |
mariadb-1  | 2025-04-15  8:23:28 0 [Note] Starting MariaDB 10.5.28-MariaDB-ubu2004 source revision 7eded23be6597b4c485e8cad1538f2ae14541f91 server_uid 72+4ASMvYxproTQgRqIDplDA1XA= as process 1
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Uses event mutexes
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Number of pools: 1
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Using crc32 + pclmulqdq instructions
mariadb-1  | 2025-04-15  8:23:28 0 [Note] mysqld: O_TMPFILE is not supported on /tmp (disabling future attempts)
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Using Linux native AIO
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Initializing buffer pool, total size = 134217728, chunk size = 134217728
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Completed initialization of buffer pool
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: 128 rollback segments are active.
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Creating shared tablespace for temporary tables
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: 10.5.28 started; log sequence number 45079; transaction id 20
mariadb-1  | 2025-04-15  8:23:28 0 [Note] Plugin 'FEEDBACK' is disabled.
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool
mariadb-1  | 2025-04-15  8:23:28 0 [Note] InnoDB: Buffer pool(s) load completed at 250415  8:23:28
mariadb-1  | 2025-04-15  8:23:28 0 [Note] Server socket created on IP: '::'.
mariadb-1  | 2025-04-15  8:23:28 0 [Note] Reading of all Master_info entries succeeded
mariadb-1  | 2025-04-15  8:23:28 0 [Note] Added new Master_info '' to hash table
mariadb-1  | 2025-04-15  8:23:28 0 [Note] mysqld: ready for connections.
mariadb-1  | Version: '10.5.28-MariaDB-ubu2004'  socket: '/run/mysqld/mysqld.sock'  port: 3306  mariadb.org binary distribution
mariadb-1  | 2025-04-15  8:28:01 192 [Warning] Aborted connection 192 to db: 'n8n_test_4kfypczjd9_1744705664868' user: 'root' host: '172.18.0.1' (Got an error reading communication packets)
mariadb-1  | 2025-04-15  8:28:01 188 [Warning] Aborted connection 188 to db: 'n8n_test_4kfypczjd9_1744705664868' user: 'root' host: '172.18.0.1' (Got an error reading communication packets)
mariadb-1  | 2025-04-15  8:28:01 191 [Warning] Aborted connection 191 to db: 'n8n_test_4kfypczjd9_1744705664868' user: 'root' host: '172.18.0.1' (Got an error reading communication packets)
mariadb-1  | 2025-04-15  8:29:21 215 [Warning] Aborted connection 215 to db: 'n8n_test_0y627b7t3n_1744705740334' user: 'root' host: '172.18.0.1' (Got an error reading communication packets)
mariadb-1  | 2025-04-15  8:29:21 214 [Warning] Aborted connection 214 to db: 'n8n_test_0y627b7t3n_1744705740334' user: 'root' host: '172.18.0.1' (Got an error reading communication packets)
mariadb-1  | 2025-04-15  8:32:34 266 [Warning] Aborted connection 266 to db: 'n8n_test_dorllodd1_1744705928769' user: 'root' host: '172.18.0.1' (Got an error reading communication packets)
Container github-mariadb-1  Stopping
Container github-mariadb-1  Stopped
Container github-mariadb-1  Removing
Container github-mariadb-1  Removed
Network github_default  Removing
Network github_default  Removed
docker-compose is down
Post job cleanup.
{"level":30,"time":1744705391619,"pid":1976,"hostname":"fv-az1784-6","msg":"Server listening at http://[::1]:41230"}
{"level":30,"time":1744705391621,"pid":1976,"hostname":"fv-az1784-6","msg":"Server listening at http://127.0.0.1:41230"}
{"level":30,"time":1744705391798,"pid":1976,"hostname":"fv-az1784-6","reqId":"req-1","req":{"method":"GET","url":"/","hostname":"localhost:41230","remoteAddress":"::1","remotePort":51754},"msg":"incoming request"}
{"level":30,"time":1744705391806,"pid":1976,"hostname":"fv-az1784-6","reqId":"req-1","res":{"statusCode":200},"responseTime":7.166209999995772,"msg":"request completed"}
{"level":30,"time":1744706199433,"pid":1976,"hostname":"fv-az1784-6","reqId":"req-2","req":{"method":"DELETE","url":"/shutdown","hostname":"localhost:41230","remoteAddress":"::1","remotePort":38580},"msg":"incoming request"}
{"level":30,"time":1744706199433,"pid":1976,"hostname":"fv-az1784-6","reqId":"req-2","res":{"statusCode":200},"responseTime":0.570295000099577,"msg":"request completed"}
2025-04-15T08:36:39.4428151Z
Post job cleanup.
[command]/usr/bin/git version
git version <:NUM:>.<:NUM:>.<:NUM:>
Temporarily overriding HOME='/home/runner/work/_temp/e7bdf16f-bd60-427c-85a4-065cc02c2df4' before making global git config changes
Adding repository directory to the temporary git global config as a safe directory
[command]/usr/bin/git config --global --add safe.directory /home/runner/work/n8n/n8n
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
http.https://github.com/.extraheader
[command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
Cleaning up orphan processes
