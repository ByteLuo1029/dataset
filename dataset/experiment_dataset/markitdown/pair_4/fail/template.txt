Requested labels: ubuntu-latest
Job defined at: microsoft/markitdown/.github/workflows/tests.yml@refs/pull/1161/merge
Waiting for a runner to pick up this job...
Job is waiting for a hosted runner to come online.
Job is about to start running on the hosted runner: GitHub Actions 961 (hosted)
Current runner version: '2.323.0'
##[group]Operating System
Ubuntu
24.04.2
LTS
##[endgroup]
##[group]Runner Image
Image: ubuntu-24.04
Version: 20250323.1.0
Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250323.1/images/ubuntu/Ubuntu2404-Readme.md
Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250323.1
##[endgroup]
##[group]Runner Image Provisioner
2.0.422.1
##[endgroup]
##[group]GITHUB_TOKEN Permissions
Contents: <:*:>
Metadata: read
Packages: <:*:>
##[endgroup]
Secret source: <:*:>
Prepare workflow directory
Prepare all required actions
Getting action download info
##[group]Download immutable action package <:*:>
Version: 4.2.2
Digest: sha256:<:SEQ:>
Source commit SHA: <:SEQ:>
##[endgroup]
##[group]Download immutable action package <:*:>
Version: 5.5.0
Digest: sha256:<:SEQ:>
Source commit SHA: <:SEQ:>
##[endgroup]
Complete job name: <:*:>
##[group]Run <:*:>
with:
repository: <:*:>
token: ***
ssh-strict: true
ssh-user: git
persist-credentials: <:*:>
clean: true
sparse-checkout-cone-mode: true
fetch-depth: <:NUM:>
fetch-tags: false
show-progress: true
lfs: false
submodules: <:*:>
set-safe-directory: true
##[endgroup]
Syncing repository: <:*:>
##[group]Getting Git version info
Working directory is <:*:>
[command]/usr/bin/git version
git version <:NUM:>.<:NUM:>.<:NUM:>
##[endgroup]
Temporarily overriding HOME='/home/runner/work/_temp/56970e23-6f99-4169-88ff-3675fac30df5' before making global git config changes
Adding repository directory to the temporary git global config as a safe directory
[command]/usr/bin/git config --global --add safe.directory /home/runner/work/markitdown/markitdown
Deleting the contents of <:*:>
##[group]Initializing the repository
[command]/usr/bin/git init <:*:>
hint: Using 'master' as the name for the initial branch. This default branch name
hint: is subject to change. To configure the initial branch name to use in all
hint: of your new repositories, which will suppress this warning, call:
hint:
hint: git config --global init.defaultBranch <name>
hint:
hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
hint: 'development'. The just-created branch can be renamed via this command:
hint:
hint: git branch -m <name>
Initialized empty Git repository in <:*:>
[command]/usr/bin/git remote add origin <:*:>
##[endgroup]
##[group]Disabling automatic garbage collection
[command]/usr/bin/git config --local gc.auto 0
##[endgroup]
##[group]Setting up auth
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
[command]/usr/bin/git config <:*:> http.https://github.com/.extraheader AUTHORIZATION: basic ***
##[endgroup]
##[group]Fetching the repository
[command]/usr/bin/git -c protocol.version=<:NUM:> fetch <:*:> <:*:> <:*:> <:*:> <:*:> <:*:>
From <:*:>
* [new ref] <:SEQ:>-> <:*:>
##[endgroup]
##[group]Determining the checkout info
##[endgroup]
[command]/usr/bin/git sparse-checkout disable
[command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
##[group]Checking out the ref
[command]/usr/bin/git checkout --progress --force refs/remotes/pull/<:NUM:>/merge
Note: switching to 'refs/remotes/pull/<:NUM:>/merge'.
2025-03-29T04:50:22.1689010Z
You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.
2025-03-29T04:50:22.1693240Z
If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:
2025-03-29T04:50:22.1697211Z
git switch -c <new-branch-name>
2025-03-29T04:50:22.1698331Z
Or undo this operation with:
2025-03-29T04:50:22.1699313Z
git switch -
2025-03-29T04:50:22.1700142Z
Turn off this advice by setting config variable advice.detachedHead to false
2025-03-29T04:50:22.1702114Z
HEAD is now at <:*:> Merge <:SEQ:> into <:SEQ:>
##[endgroup]
[command]/usr/bin/git log <:NUM:> <:*:>
<:SEQ:>
##[group]Run <:*:>
with:
python-version: <:*:>
3.11
3.12
check-latest: false
token: ***
<:*:> true
<:*:> false
<:*:> false
##[endgroup]
##[group]Installed versions
Successfully set up CPython (<:NUM:>.<:NUM:>.<:NUM:>)
Successfully set up CPython (<:NUM:>.<:NUM:>.<:NUM:>)
Successfully set up CPython (<:NUM:>.<:NUM:>.<:NUM:>)
##[endgroup]
##[group]Run pipx install hatch
[36;1mpipx install hatch[0m
shell: /usr/bin/bash -e {<:NUM:>}
env:
pythonLocation: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
PKG CONFIG PATH: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64/lib/pkgconfig
Python ROOT DIR: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
<:*:> ROOT DIR: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
<:*:> ROOT DIR: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.9/x64/lib:/opt/hostedtoolcache/Python/3.11.11/x64/lib:/opt/hostedtoolcache/Python/3.10.16/x64/lib
##[endgroup]
creating virtual environment...
installing hatch...
done! âœ¨ ðŸŒŸ âœ¨
installed package hatch 1.14.0, installed using Python 3.12.3
These apps are now globally available
- hatch
##[group]Run cd packages/markitdown; hatch test
[36;1mcd packages/markitdown; hatch test[0m
shell: /usr/bin/bash -e {<:NUM:>}
env:
pythonLocation: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
PKG CONFIG PATH: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64/lib/pkgconfig
Python ROOT DIR: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
<:*:> ROOT DIR: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
<:*:> ROOT DIR: /opt/hostedtoolcache/Python/<:NUM:>.<:NUM:>.<:NUM:>/x64
LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.9/x64/lib:/opt/hostedtoolcache/Python/3.11.11/x64/lib:/opt/hostedtoolcache/Python/3.10.16/x64/lib
##[endgroup]
Creating environment: hatch-test.py3.12
Installing project in development mode
Checking dependencies
Syncing dependencies
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.3.5, pluggy-1.5.0
rootdir: /home/runner/work/markitdown/markitdown/packages/markitdown
configfile: pyproject.toml
plugins: rerunfailures-14.0, anyio-4.9.0, xdist-3.6.1, mock-3.14.0
collected 172 items
2025-03-29T04:50:34.7528377Z
tests/test_cli_misc.py ..                                                [  1%]
tests/test_cli_vectors.py ...F...........F...........F........ssssssssss [ 27%]
ss.F                                                                     [ 30%]
tests/test_module_misc.py ......ss.ss                                    [ 36%]
tests/test_module_vectors.py ..................F..............F......... [ 61%]
.....F...........sssssssssssssss...F..............F............F.F       [100%]
2025-03-29T04:51:40.3167839Z
=================================== FAILURES ===================================
_____________________ test_output_to_stdout[test_vector3] ______________________
2025-03-29T04:51:40.3169025Z
shared_tmp_dir = PosixPath('/tmp/pytest-of-runner/pytest-0/pytest_tmp0')
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3173057Z
@pytest.mark.parametrize("test_vector", CLI_TEST_VECTORS)
def test_output_to_stdout(shared_tmp_dir, test_vector) -> None:
"""Test that the CLI outputs to stdout correctly."""
2025-03-29T04:51:40.3178770Z
result = subprocess.run(
[
"python",
"-m",
"markitdown",
os.path.join(TEST_FILES_DIR, test_vector.filename),
],
capture_output=True,
text=True,
)
2025-03-29T04:51:40.3183597Z
>       assert result.returncode == 0, f"CLI exited with error: {result.stderr}"
E       AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
E           warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
E         Traceback (most recent call last):
E           File "<frozen runpy>", line 198, in _run_module_as_main
E           File "<frozen runpy>", line 88, in _run_code
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
E             main()
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
E             result = markitdown.convert(
E                      ^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
E             return self.convert_local(source, stream_info=stream_info, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
E             return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
E             raise FileConversionException(attempts=failed_attempts)
E         markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E          - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
E
E
E       assert 1 == 0
E        +  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '/home/runner/work/markitdown/markitdown/packages/markitdown/test...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
2025-03-29T04:51:40.3210817Z
tests/test_cli_vectors.py:65: AssertionError
______________________ test_output_to_file[test_vector3] _______________________
2025-03-29T04:51:40.3212124Z
shared_tmp_dir = PosixPath('/tmp/pytest-of-runner/pytest-0/pytest_tmp0')
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3215846Z
@pytest.mark.parametrize("test_vector", CLI_TEST_VECTORS)
def test_output_to_file(shared_tmp_dir, test_vector) -> None:
"""Test that the CLI outputs to a file correctly."""
2025-03-29T04:51:40.3218126Z
output_file = os.path.join(shared_tmp_dir, test_vector.filename + ".output")
result = subprocess.run(
[
"python",
"-m",
"markitdown",
"-o",
output_file,
os.path.join(TEST_FILES_DIR, test_vector.filename),
],
capture_output=True,
text=True,
)
2025-03-29T04:51:40.3224099Z
>       assert result.returncode == 0, f"CLI exited with error: {result.stderr}"
E       AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
E           warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
E         Traceback (most recent call last):
E           File "<frozen runpy>", line 198, in _run_module_as_main
E           File "<frozen runpy>", line 88, in _run_code
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
E             main()
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
E             result = markitdown.convert(
E                      ^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
E             return self.convert_local(source, stream_info=stream_info, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
E             return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
E             raise FileConversionException(attempts=failed_attempts)
E         markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E          - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
E
E
E       assert 1 == 0
E        +  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '-o', '/tmp/pytest-of-runner/pytest-0/pytest_tmp0/test.pptx.outpu...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
2025-03-29T04:51:40.3246045Z
tests/test_cli_vectors.py:90: AssertionError
______________ test_input_from_stdin_without_hints[test_vector3] _______________
2025-03-29T04:51:40.3247318Z
shared_tmp_dir = PosixPath('/tmp/pytest-of-runner/pytest-0/pytest_tmp0')
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3250795Z
@pytest.mark.parametrize("test_vector", CLI_TEST_VECTORS)
def test_input_from_stdin_without_hints(shared_tmp_dir, test_vector) -> None:
"""Test that the CLI readds from stdin correctly."""
2025-03-29T04:51:40.3252675Z
test_input = b""
with open(os.path.join(TEST_FILES_DIR, test_vector.filename), "rb") as stream:
test_input = stream.read()
2025-03-29T04:51:40.3254303Z
result = subprocess.run(
[
"python",
"-m",
"markitdown",
os.path.join(TEST_FILES_DIR, test_vector.filename),
],
input=test_input,
capture_output=True,
text=False,
)
2025-03-29T04:51:40.3258201Z
stdout = result.stdout.decode(locale.getpreferredencoding())
>       assert (
result.returncode == 0
), f"CLI exited with error: {result.stderr.decode('utf-8')}"
E       AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
E           warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
E         Traceback (most recent call last):
E           File "<frozen runpy>", line 198, in _run_module_as_main
E           File "<frozen runpy>", line 88, in _run_code
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
E             main()
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
E             result = markitdown.convert(
E                      ^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
E             return self.convert_local(source, stream_info=stream_info, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
E             return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
E             raise FileConversionException(attempts=failed_attempts)
E         markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E          - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
E
E
E       assert 1 == 0
E        +  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '/home/runner/work/markitdown/markitdown/packages/markitdown/test...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
2025-03-29T04:51:40.3281332Z
tests/test_cli_vectors.py:125: AssertionError
_______________ test_output_to_file_with_data_uris[test_vector1] _______________
2025-03-29T04:51:40.3282459Z
shared_tmp_dir = PosixPath('/tmp/pytest-of-runner/pytest-0/pytest_tmp0')
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati.../jpeg;base64,/9j/4AAQSkZJRgABAQE'], must_not_include=['![This phrase of the caption is Human-written.](Picture4.jpg)'])
2025-03-29T04:51:40.3285791Z
@pytest.mark.parametrize("test_vector", DATA_URI_TEST_VECTORS)
def test_output_to_file_with_data_uris(shared_tmp_dir, test_vector) -> None:
"""Test CLI functionality when keep_data_uris is enabled"""
2025-03-29T04:51:40.3288001Z
output_file = os.path.join(shared_tmp_dir, test_vector.filename + ".output")
result = subprocess.run(
[
"python",
"-m",
"markitdown",
"--keep-data-uris",
"-o",
output_file,
os.path.join(TEST_FILES_DIR, test_vector.filename),
],
capture_output=True,
text=True,
)
2025-03-29T04:51:40.3293182Z
>       assert result.returncode == 0, f"CLI exited with error: {result.stderr}"
E       AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
E           warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
E         Traceback (most recent call last):
E           File "<frozen runpy>", line 198, in _run_module_as_main
E           File "<frozen runpy>", line 88, in _run_code
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
E             main()
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
E             result = markitdown.convert(
E                      ^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
E             return self.convert_local(source, stream_info=stream_info, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
E             return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
E                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
E             raise FileConversionException(attempts=failed_attempts)
E         markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E          - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
E
E
E       assert 1 == 0
E        +  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '--keep-data-uris', '-o', '/tmp/pytest-of-runner/pytest-0/pytest_...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
2025-03-29T04:51:40.3314341Z
tests/test_cli_vectors.py:179: AssertionError
_______________________ test_convert_local[test_vector3] _______________________
2025-03-29T04:51:40.3315398Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3318251Z
@pytest.mark.parametrize("test_vector", GENERAL_TEST_VECTORS)
def test_convert_local(test_vector):
"""Test the conversion of a local file."""
markitdown = MarkItDown()
2025-03-29T04:51:40.3320155Z
>       result = markitdown.convert(
os.path.join(TEST_FILES_DIR, test_vector.filename), url=test_vector.url
)
2025-03-29T04:51:40.3321540Z
tests/test_module_vectors.py:65:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:271: in convert
return self.convert_local(source, stream_info=stream_info, **kwargs)
src/markitdown/_markitdown.py:325: in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3325074Z
self = <markitdown._markitdown.MarkItDown object at 0x7f42859f16d0>
file_stream = <_io.BufferedReader name='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx'>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', c....pptx', local_path='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx', url=None)]
kwargs = {}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f42859081d0>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f4286bebef0>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f4286beb8f0>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3365840Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3368033Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3369277Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3372551Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3373765Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3377880Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3378556Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3380199Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3381402Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3382603Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3383912Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3385086Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3387123Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3388372Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3391183Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3393413Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3398506Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3401654Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3405007Z
src/markitdown/_markitdown.py:611: FileConversionException
_________________ test_convert_stream_with_hints[test_vector3] _________________
2025-03-29T04:51:40.3406178Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3408771Z
@pytest.mark.parametrize("test_vector", GENERAL_TEST_VECTORS)
def test_convert_stream_with_hints(test_vector):
"""Test the conversion of a stream with full stream info."""
markitdown = MarkItDown()
2025-03-29T04:51:40.3410830Z
stream_info = StreamInfo(
extension=os.path.splitext(test_vector.filename)[1],
mimetype=test_vector.mimetype,
charset=test_vector.charset,
)
2025-03-29T04:51:40.3413175Z
with open(os.path.join(TEST_FILES_DIR, test_vector.filename), "rb") as stream:
>           result = markitdown.convert(
stream, stream_info=stream_info, url=test_vector.url
)
2025-03-29T04:51:40.3415198Z
tests/test_module_vectors.py:86:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:284: in convert
return self.convert_stream(source, stream_info=stream_info, **kwargs)
src/markitdown/_markitdown.py:372: in convert_stream
return self._convert(file_stream=stream, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3418929Z
self = <markitdown._markitdown.MarkItDown object at 0x7f427ff89580>
file_stream = <_io.BufferedReader name='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx'>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', charset=None, filename=None, local_path=None, url=None)]
kwargs = {}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f4284072ff0>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f42841e0260>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f427ff5be60>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3428368Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3430287Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3431521Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3434812Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3436015Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3439990Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3440655Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3442311Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3443515Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3444694Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3446036Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3447353Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3449404Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3450434Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3453227Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3455432Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3460507Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3463603Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3467148Z
src/markitdown/_markitdown.py:611: FileConversionException
_______________ test_convert_stream_without_hints[test_vector3] ________________
2025-03-29T04:51:40.3468362Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3470818Z
@pytest.mark.parametrize("test_vector", GENERAL_TEST_VECTORS)
def test_convert_stream_without_hints(test_vector):
"""Test the conversion of a stream with no stream info."""
markitdown = MarkItDown()
2025-03-29T04:51:40.3473045Z
with open(os.path.join(TEST_FILES_DIR, test_vector.filename), "rb") as stream:
>           result = markitdown.convert(stream, url=test_vector.url)
2025-03-29T04:51:40.3474421Z
tests/test_module_vectors.py:101:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:284: in convert
return self.convert_stream(source, stream_info=stream_info, **kwargs)
src/markitdown/_markitdown.py:372: in convert_stream
return self._convert(file_stream=stream, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3478154Z
self = <markitdown._markitdown.MarkItDown object at 0x7f42859856d0>
file_stream = <_io.BufferedReader name='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx'>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', charset=None, filename=None, local_path=None, url=None)]
kwargs = {}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f42859deb10>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f42859dc8c0>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f42859f0470>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3487574Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3489483Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3490669Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3493951Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3495143Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3499027Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3499693Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3501297Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3502481Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3503680Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3505052Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3506252Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3508313Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3509355Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3512359Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3514522Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3519431Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3522740Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3526048Z
src/markitdown/_markitdown.py:611: FileConversionException
_____________________ test_convert_file_uri[test_vector3] ______________________
2025-03-29T04:51:40.3527385Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3529872Z
@pytest.mark.parametrize("test_vector", GENERAL_TEST_VECTORS)
def test_convert_file_uri(test_vector):
"""Test the conversion of a file:// URI."""
markitdown = MarkItDown()
2025-03-29T04:51:40.3531759Z
>       result = markitdown.convert(
Path(os.path.join(TEST_FILES_DIR, test_vector.filename)).as_uri(),
url=test_vector.url,
)
2025-03-29T04:51:40.3533491Z
tests/test_module_vectors.py:134:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:269: in convert
return self.convert_uri(source, stream_info=stream_info, **_kwargs)
src/markitdown/_markitdown.py:413: in convert_uri
return self.convert_local(
src/markitdown/_markitdown.py:325: in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3538197Z
self = <markitdown._markitdown.MarkItDown object at 0x7f4284001970>
file_stream = <_io.BufferedReader name='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx'>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', c....pptx', local_path='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx', url=None)]
kwargs = {}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f427ff46540>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f42847e2150>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f42859b6bd0>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3548218Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3550149Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3551366Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3554646Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3555862Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3559634Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3560291Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3562117Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3563305Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3564515Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3565855Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3567186Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3569088Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3570128Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3573145Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3575344Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3580223Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3583531Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3587251Z
src/markitdown/_markitdown.py:611: FileConversionException
_____________________ test_convert_data_uri[test_vector3] ______________________
2025-03-29T04:51:40.3588474Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati...ase of the caption is Human-written.](Picture4.jpg)'], must_not_include=['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQE'])
2025-03-29T04:51:40.3590698Z
@pytest.mark.parametrize("test_vector", GENERAL_TEST_VECTORS)
def test_convert_data_uri(test_vector):
"""Test the conversion of a data URI."""
markitdown = MarkItDown()
2025-03-29T04:51:40.3592363Z
data = ""
with open(os.path.join(TEST_FILES_DIR, test_vector.filename), "rb") as stream:
data = base64.b64encode(stream.read()).decode("utf-8")
mimetype = test_vector.mimetype
data_uri = f"data:{mimetype};base64,{data}"
2025-03-29T04:51:40.3594857Z
>       result = markitdown.convert(
data_uri,
url=test_vector.url,
)
2025-03-29T04:51:40.3596056Z
tests/test_module_vectors.py:155:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:269: in convert
return self.convert_uri(source, stream_info=stream_info, **_kwargs)
src/markitdown/_markitdown.py:431: in convert_uri
return self.convert_stream(
src/markitdown/_markitdown.py:372: in convert_stream
return self._convert(file_stream=stream, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3600287Z
self = <markitdown._markitdown.MarkItDown object at 0x7f4289181cd0>
file_stream = <_io.BytesIO object at 0x7f428922d850>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', charset=None, filename=None, local_path=None, url=None)]
kwargs = {}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f4289232690>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f4289232cf0>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f4289233500>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3607832Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3609513Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3610386Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3612592Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3613389Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3615908Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3616352Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3617559Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3618366Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3619155Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3620046Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3620831Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3622134Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3622820Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3624858Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3626318Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3629648Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3631862Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3634056Z
src/markitdown/_markitdown.py:611: FileConversionException
__________________ test_convert_keep_data_uris[test_vector1] ___________________
2025-03-29T04:51:40.3634859Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati.../jpeg;base64,/9j/4AAQSkZJRgABAQE'], must_not_include=['![This phrase of the caption is Human-written.](Picture4.jpg)'])
2025-03-29T04:51:40.3636503Z
@pytest.mark.parametrize("test_vector", DATA_URI_TEST_VECTORS)
def test_convert_keep_data_uris(test_vector):
"""Test API functionality when keep_data_uris is enabled"""
markitdown = MarkItDown()
2025-03-29T04:51:40.3637991Z
# Test local file conversion
>       result = markitdown.convert(
os.path.join(TEST_FILES_DIR, test_vector.filename),
keep_data_uris=True,
url=test_vector.url,
)
2025-03-29T04:51:40.3639519Z
tests/test_module_vectors.py:171:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:271: in convert
return self.convert_local(source, stream_info=stream_info, **kwargs)
src/markitdown/_markitdown.py:325: in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3641983Z
self = <markitdown._markitdown.MarkItDown object at 0x7f42840704d0>
file_stream = <_io.BufferedReader name='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx'>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', c....pptx', local_path='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx', url=None)]
kwargs = {'keep_data_uris': True}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f427ff44bf0>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f427ff47c50>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f427ff47620>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3648629Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3649931Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3650732Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3652887Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3653677Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3656077Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3656523Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3657829Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3658606Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3659388Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3660255Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3661044Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3662295Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3662987Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3665058Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3666509Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3669857Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3672046Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3674224Z
src/markitdown/_markitdown.py:611: FileConversionException
_______________ test_convert_stream_keep_data_uris[test_vector1] _______________
2025-03-29T04:51:40.3675033Z
test_vector = FileTestVector(filename='test.pptx', mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentati.../jpeg;base64,/9j/4AAQSkZJRgABAQE'], must_not_include=['![This phrase of the caption is Human-written.](Picture4.jpg)'])
2025-03-29T04:51:40.3676802Z
@pytest.mark.parametrize("test_vector", DATA_URI_TEST_VECTORS)
def test_convert_stream_keep_data_uris(test_vector):
"""Test the conversion of a stream with no stream info."""
markitdown = MarkItDown()
2025-03-29T04:51:40.3678188Z
stream_info = StreamInfo(
extension=os.path.splitext(test_vector.filename)[1],
mimetype=test_vector.mimetype,
charset=test_vector.charset,
)
2025-03-29T04:51:40.3679739Z
with open(os.path.join(TEST_FILES_DIR, test_vector.filename), "rb") as stream:
>           result = markitdown.convert(
stream, stream_info=stream_info, keep_data_uris=True, url=test_vector.url
)
2025-03-29T04:51:40.3681166Z
tests/test_module_vectors.py:195:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/markitdown/_markitdown.py:284: in convert
return self.convert_stream(source, stream_info=stream_info, **kwargs)
src/markitdown/_markitdown.py:372: in convert_stream
return self._convert(file_stream=stream, stream_info_guesses=guesses, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
2025-03-29T04:51:40.3684288Z
self = <markitdown._markitdown.MarkItDown object at 0x7f427f888b90>
file_stream = <_io.BufferedReader name='/home/runner/work/markitdown/markitdown/packages/markitdown/tests/test_files/test.pptx'>
stream_info_guesses = [StreamInfo(mimetype='application/vnd.openxmlformats-officedocument.presentationml.presentation', extension='.pptx', charset=None, filename=None, local_path=None, url=None)]
kwargs = {'keep_data_uris': True}, res = None
failed_attempts = [<markitdown._exceptions.FailedConversionAttempt object at 0x7f42892b06e0>]
sorted_registrations = [ConverterRegistration(converter=<markitdown.converters._epub_converter.EpubConverter object at 0x7f428927c830>, prior...tration(converter=<markitdown.converters._audio_converter.AudioConverter object at 0x7f428927d8b0>, priority=0.0), ...]
cur_pos = 0
stream_info = StreamInfo(mimetype=None, extension=None, charset=None, filename=None, local_path=None, url=None)
2025-03-29T04:51:40.3691608Z
def _convert(
self, *, file_stream: BinaryIO, stream_info_guesses: List[StreamInfo], **kwargs
) -> DocumentConverterResult:
res: Union[None, DocumentConverterResult] = None
2025-03-29T04:51:40.3693487Z
# Keep track of which converters throw exceptions
failed_attempts: List[FailedConversionAttempt] = []
2025-03-29T04:51:40.3694725Z
# Create a copy of the page_converters list, sorted by priority.
# We do this with each call to _convert because the priority of converters may change between calls.
# The sort is guaranteed to be stable, so converters with the same priority will remain in the same order.
sorted_registrations = sorted(self._converters, key=lambda x: x.priority)
2025-03-29T04:51:40.3709773Z
# Remember the initial stream position so that we can return to it
cur_pos = file_stream.tell()
2025-03-29T04:51:40.3710632Z
for stream_info in stream_info_guesses + [StreamInfo()]:
for converter_registration in sorted_registrations:
converter = converter_registration.converter
# Sanity check -- make sure the cur_pos is still the same
assert (
cur_pos == file_stream.tell()
), f"File stream position should NOT change between guess iterations"
2025-03-29T04:51:40.3713321Z
_kwargs = {k: v for k, v in kwargs.items()}
2025-03-29T04:51:40.3713787Z
# Copy any additional global options
if "llm_client" not in _kwargs and self._llm_client is not None:
_kwargs["llm_client"] = self._llm_client
2025-03-29T04:51:40.3714896Z
if "llm_model" not in _kwargs and self._llm_model is not None:
_kwargs["llm_model"] = self._llm_model
2025-03-29T04:51:40.3715728Z
if "style_map" not in _kwargs and self._style_map is not None:
_kwargs["style_map"] = self._style_map
2025-03-29T04:51:40.3716524Z
if "exiftool_path" not in _kwargs and self._exiftool_path is not None:
_kwargs["exiftool_path"] = self._exiftool_path
2025-03-29T04:51:40.3717543Z
# Add the list of converters for nested processing
_kwargs["_parent_converters"] = self._converters
2025-03-29T04:51:40.3718338Z
# Add legaxy kwargs
if stream_info is not None:
if stream_info.extension is not None:
_kwargs["file_extension"] = stream_info.extension
2025-03-29T04:51:40.3719601Z
if stream_info.url is not None:
_kwargs["url"] = stream_info.url
2025-03-29T04:51:40.3720307Z
# Check if the converter will accept the file, and if so, try to convert it
_accepts = False
try:
_accepts = converter.accepts(file_stream, stream_info, **_kwargs)
except NotImplementedError:
pass
2025-03-29T04:51:40.3722376Z
# accept() should not have changed the file stream position
assert (
cur_pos == file_stream.tell()
), f"{type(converter).__name__}.accept() should NOT change the file_stream position"
2025-03-29T04:51:40.3723831Z
# Attempt the conversion
if _accepts:
try:
res = converter.convert(file_stream, stream_info, **_kwargs)
except Exception:
failed_attempts.append(
FailedConversionAttempt(
converter=converter, exc_info=sys.exc_info()
)
)
finally:
file_stream.seek(cur_pos)
2025-03-29T04:51:40.3727518Z
if res is not None:
# Normalize the content
res.text_content = "\n".join(
[line.rstrip() for line in re.split(r"\r?\n", res.text_content)]
)
res.text_content = re.sub(r"\n{3,}", "\n\n", res.text_content)
return res
2025-03-29T04:51:40.3729736Z
# If we got this far without success, report any exceptions
if len(failed_attempts) > 0:
>           raise FileConversionException(attempts=failed_attempts)
E           markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
E            - PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3731935Z
src/markitdown/_markitdown.py:611: FileConversionException
=============================== warnings summary ===============================
../../../../../.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170
/home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
2025-03-29T04:51:40.3735932Z
-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_cli_vectors.py::test_output_to_stdout[test_vector3] - AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
Traceback (most recent call last):
File "<frozen runpy>", line 198, in _run_module_as_main
File "<frozen runpy>", line 88, in _run_code
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
main()
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
result = markitdown.convert(
^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
return self.convert_local(source, stream_info=stream_info, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
raise FileConversionException(attempts=failed_attempts)
markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3748155Z
2025-03-29T04:51:40.3748230Z
assert 1 == 0
+  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '/home/runner/work/markitdown/markitdown/packages/markitdown/test...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
FAILED tests/test_cli_vectors.py::test_output_to_file[test_vector3] - AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
Traceback (most recent call last):
File "<frozen runpy>", line 198, in _run_module_as_main
File "<frozen runpy>", line 88, in _run_code
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
main()
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
result = markitdown.convert(
^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
return self.convert_local(source, stream_info=stream_info, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
raise FileConversionException(attempts=failed_attempts)
markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3754431Z
2025-03-29T04:51:40.3754499Z
assert 1 == 0
+  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '-o', '/tmp/pytest-of-runner/pytest-0/pytest_tmp0/test.pptx.outpu...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
FAILED tests/test_cli_vectors.py::test_input_from_stdin_without_hints[test_vector3] - AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
Traceback (most recent call last):
File "<frozen runpy>", line 198, in _run_module_as_main
File "<frozen runpy>", line 88, in _run_code
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
main()
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
result = markitdown.convert(
^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
return self.convert_local(source, stream_info=stream_info, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
raise FileConversionException(attempts=failed_attempts)
markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3760764Z
2025-03-29T04:51:40.3760835Z
assert 1 == 0
+  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '/home/runner/work/markitdown/markitdown/packages/markitdown/test...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
FAILED tests/test_cli_vectors.py::test_output_to_file_with_data_uris[test_vector1] - AssertionError: CLI exited with error: /home/runner/.local/share/hatch/env/virtual/markitdown/H_uUSwZ6/hatch-test.py3.12/lib/python3.12/site-packages/pydub/utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
Traceback (most recent call last):
File "<frozen runpy>", line 198, in _run_module_as_main
File "<frozen runpy>", line 88, in _run_code
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 224, in <module>
main()
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/__main__.py", line 197, in main
result = markitdown.convert(
^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 271, in convert
return self.convert_local(source, stream_info=stream_info, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 325, in convert_local
return self._convert(file_stream=fh, stream_info_guesses=guesses, **kwargs)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/work/markitdown/markitdown/packages/markitdown/src/markitdown/_markitdown.py", line 611, in _convert
raise FileConversionException(attempts=failed_attempts)
markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
2025-03-29T04:51:40.3767359Z
2025-03-29T04:51:40.3767423Z
assert 1 == 0
+  where 1 = CompletedProcess(args=['python', '-m', 'markitdown', '--keep-data-uris', '-o', '/tmp/pytest-of-runner/pytest-0/pytest_...on failed after 1 attempts:\n - PptxConverter threw RecursionError with message: maximum recursion depth exceeded\n\n').returncode
FAILED tests/test_module_vectors.py::test_convert_local[test_vector3] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
FAILED tests/test_module_vectors.py::test_convert_stream_with_hints[test_vector3] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
FAILED tests/test_module_vectors.py::test_convert_stream_without_hints[test_vector3] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
FAILED tests/test_module_vectors.py::test_convert_file_uri[test_vector3] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
FAILED tests/test_module_vectors.py::test_convert_data_uri[test_vector3] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
FAILED tests/test_module_vectors.py::test_convert_keep_data_uris[test_vector1] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
FAILED tests/test_module_vectors.py::test_convert_stream_keep_data_uris[test_vector1] - markitdown._exceptions.FileConversionException: File conversion failed after 1 attempts:
- PptxConverter threw RecursionError with message: maximum recursion depth exceeded
======= 11 failed, 130 passed, 31 skipped, 1 warning in 69.25s (0:01:09) =======
##[error]Process completed with exit code 1.
Post job cleanup.
[command]/usr/bin/git version
git version <:NUM:>.<:NUM:>.<:NUM:>
Temporarily overriding HOME='/home/runner/work/_temp/e9d92183-3a86-4bcb-8a34-b2a82404109b' before making global git config changes
Adding repository directory to the temporary git global config as a safe directory
[command]/usr/bin/git config --global --add safe.directory /home/runner/work/markitdown/markitdown
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
[command]/usr/bin/git config --local --name-only --get-regexp <:*:>
http.https://github.com/.extraheader
[command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
[command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp <:*:> && git config --local --unset-all <:*:> || :"
Cleaning up orphan processes
